<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>JavaScripté–¢æ•°ãƒ»ãƒ¡ã‚½ãƒƒãƒ‰ åŸºç¤ã‚¬ã‚¤ãƒ‰ - Node-RED Functionãƒãƒ¼ãƒ‰ã§ä½¿ã†</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.8;
            max-width: 1000px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
            color: #333;
        }
        
        h1 {
            color: #8f0000;
            border-bottom: 3px solid #8f0000;
            padding-bottom: 10px;
        }
        
        h2 {
            color: #c00000;
            margin-top: 30px;
            border-left: 5px solid #c00000;
            padding-left: 15px;
        }
        
        h3 {
            color: #555;
            margin-top: 25px;
        }
        
        h4 {
            color: #666;
            margin-top: 20px;
            padding-left: 10px;
            border-left: 3px solid #ddd;
        }
        
        .container {
            background-color: white;
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        
        .node-example {
            background-color: #2d3133;
            padding: 20px;
            border-radius: 5px;
            margin: 20px 0;
            color: white;
            font-family: 'Courier New', monospace;
        }
        
        .node {
            display: inline-block;
            padding: 8px 15px;
            border-radius: 4px;
            margin: 5px;
            font-weight: bold;
            font-size: 14px;
        }
        
        .node-inject {
            background-color: #3fadb5;
            color: white;
        }
        
        .node-function {
            background-color: #e8a658;
            color: white;
        }
        
        .node-debug {
            background-color: #87a48d;
            color: white;
        }
        
        .arrow {
            color: #999;
            font-size: 20px;
            margin: 0 10px;
        }
        
        .important {
            background-color: #fff3cd;
            border-left: 4px solid #ffc107;
            padding: 15px;
            margin: 15px 0;
            border-radius: 4px;
        }
        
        .tip {
            background-color: #d1ecf1;
            border-left: 4px solid #17a2b8;
            padding: 15px;
            margin: 15px 0;
            border-radius: 4px;
        }
        
        .warning {
            background-color: #f8d7da;
            border-left: 4px solid #dc3545;
            padding: 15px;
            margin: 15px 0;
            border-radius: 4px;
        }
        
        .code-block {
            background-color: #f8f9fa;
            border: 1px solid #ddd;
            border-radius: 4px;
            padding: 15px;
            margin: 15px 0;
            overflow-x: auto;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            position: relative;
            white-space: pre-wrap;
        }
        
        .js-code {
            background-color: #1e1e1e;
            color: #d4d4d4;
            border: none;
            padding: 15px;
            padding-top: 40px;
            border-radius: 5px;
            position: relative;
            white-space: pre;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            overflow-x: auto;
        }
        
        .copy-button {
            position: absolute;
            top: 8px;
            right: 8px;
            padding: 6px 12px;
            background-color: #007bff;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
            font-family: 'Segoe UI', sans-serif;
            transition: background-color 0.2s;
            z-index: 10;
            display: flex;
            align-items: center;
            gap: 4px;
        }
        
        .copy-button:hover {
            background-color: #0056b3;
        }
        
        .copy-button.copied {
            background-color: #28a745;
        }
        
        .copy-button svg {
            width: 14px;
            height: 14px;
            fill: currentColor;
        }
        
        .exercise {
            background-color: #e8f5e9;
            border: 2px solid #4caf50;
            border-radius: 8px;
            padding: 20px;
            margin: 25px 0;
        }
        
        .exercise h3 {
            color: #2e7d32;
            margin-top: 0;
        }
        
        .difficulty {
            display: inline-block;
            padding: 5px 12px;
            border-radius: 15px;
            font-size: 12px;
            font-weight: bold;
            margin-left: 10px;
        }
        
        .difficulty-easy {
            background-color: #4caf50;
            color: white;
        }
        
        .difficulty-medium {
            background-color: #ff9800;
            color: white;
        }
        
        .difficulty-hard {
            background-color: #f44336;
            color: white;
        }
        
        ul, ol {
            padding-left: 25px;
        }
        
        li {
            margin: 8px 0;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
        }
        
        th, td {
            border: 1px solid #ddd;
            padding: 12px;
            text-align: left;
        }
        
        th {
            background-color: #e8a658;
            color: white;
        }
        
        tr:nth-child(even) {
            background-color: #f9f9f9;
        }
        
        .flow-json {
            background-color: #263238;
            color: #aed581;
            padding: 15px;
            padding-top: 40px;
            border-radius: 5px;
            overflow-x: auto;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            max-height: 400px;
            overflow-y: auto;
            position: relative;
        }
        
        details {
            margin: 15px 0;
        }
        
        summary {
            cursor: pointer;
            padding: 10px;
            background-color: #6c757d;
            color: white;
            border-radius: 4px;
            font-weight: bold;
        }
        
        summary:hover {
            background-color: #5a6268;
        }
        
        .feature-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }
        
        .feature-card {
            background-color: #f8f9fa;
            border: 2px solid #dee2e6;
            border-radius: 8px;
            padding: 15px;
        }
        
        .feature-card h4 {
            color: #d48c2e;
            margin-top: 0;
            border-left: none;
            padding-left: 0;
        }
        
        .method-badge {
            display: inline-block;
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: bold;
            font-family: 'Courier New', monospace;
            margin-right: 5px;
        }
        
        .badge-array {
            background-color: #28a745;
            color: white;
        }
        
        .badge-string {
            background-color: #17a2b8;
            color: white;
        }
        
        .badge-object {
            background-color: #6f42c1;
            color: white;
        }
        
        .badge-number {
            background-color: #fd7e14;
            color: white;
        }
        
        .badge-date {
            background-color: #e83e8c;
            color: white;
        }
        
        .badge-var {
            background-color: #6c757d;
            color: white;
        }
        
        .result-box {
            display: inline-block;
            background-color: #d4edda;
            border: 1px solid #c3e6cb;
            padding: 2px 8px;
            border-radius: 4px;
            font-family: 'Courier New', monospace;
            color: #155724;
        }
        
        .category-header {
            background-color: #343a40;
            color: white;
            padding: 10px 15px;
            border-radius: 5px 5px 0 0;
            margin-bottom: 0;
            font-weight: bold;
        }
        
        .category-content {
            border: 2px solid #343a40;
            border-top: none;
            border-radius: 0 0 5px 5px;
            padding: 15px;
            margin-top: 0;
            margin-bottom: 20px;
        }
        
        .syntax-box {
            background-color: #e9ecef;
            border-left: 4px solid #6c757d;
            padding: 10px 15px;
            margin: 10px 0;
            font-family: 'Courier New', monospace;
        }
        
        .comparison-table td:first-child {
            font-family: 'Courier New', monospace;
            font-weight: bold;
            background-color: #f8f9fa;
        }
        
        .use-case {
            background-color: #fff;
            border: 1px solid #dee2e6;
            border-radius: 8px;
            padding: 15px;
            margin: 10px 0;
        }
        
        .use-case-title {
            font-weight: bold;
            color: #495057;
            margin-bottom: 10px;
        }
        
        .inline-code {
            background-color: #f4f4f4;
            padding: 2px 6px;
            border-radius: 3px;
            font-family: 'Courier New', monospace;
            font-size: 0.9em;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ› ï¸ JavaScripté–¢æ•°ãƒ»ãƒ¡ã‚½ãƒƒãƒ‰ åŸºç¤ã‚¬ã‚¤ãƒ‰</h1>
        <p><strong>Node-RED Functionãƒãƒ¼ãƒ‰ã§ä½¿ã†å¿…é ˆãƒ†ã‚¯ãƒ‹ãƒƒã‚¯</strong></p>
        
        <p>ã“ã®ã‚¬ã‚¤ãƒ‰ã§ã¯ã€Node-REDã®åŸºæœ¬ãƒãƒ¼ãƒ‰ã§ã¯è¡¨ç¾ã—ã«ããã€<strong>Functionãƒãƒ¼ãƒ‰</strong>ã§è¨˜è¿°ã™ã‚‹ã“ã¨ã®å¤šã„JavaScriptã®é–¢æ•°ãƒ»ãƒ¡ã‚½ãƒƒãƒ‰ã‚’ç´¹ä»‹ã—ã¾ã™ã€‚</p>
        
        <div class="important">
            <p><strong>ğŸ“Œ ã“ã®ã‚¬ã‚¤ãƒ‰ã§å­¦ã¹ã‚‹ã“ã¨:</strong></p>
            <ul>
                <li>å¤‰æ•°ã®å®šç¾©æ–¹æ³•ï¼ˆlet, const, varï¼‰</li>
                <li>é…åˆ—æ“ä½œãƒ¡ã‚½ãƒƒãƒ‰ï¼ˆmap, filter, find, reduce ãªã©ï¼‰</li>
                <li>æ–‡å­—åˆ—æ“ä½œãƒ¡ã‚½ãƒƒãƒ‰ï¼ˆsplit, replace, trim ãªã©ï¼‰</li>
                <li>ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆæ“ä½œï¼ˆObject.keys, ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰æ§‹æ–‡ãªã©ï¼‰</li>
                <li>æ•°å€¤ãƒ»æ—¥ä»˜ã®å‡¦ç†</li>
                <li>ä¾¿åˆ©ãªæ§‹æ–‡ï¼ˆãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆãƒªãƒ†ãƒ©ãƒ«ã€ä¸‰é …æ¼”ç®—å­ãªã©ï¼‰</li>
            </ul>
        </div>
        
        <h2>ğŸ“¦ 1. å¤‰æ•°å®šç¾©ï¼ˆlet, const, varï¼‰</h2>
        
        <p>Functionãƒãƒ¼ãƒ‰ã§ã‚³ãƒ¼ãƒ‰ã‚’æ›¸ãéš›ã€æœ€åˆã«è¦šãˆã‚‹ã¹ãã¯<strong>å¤‰æ•°ã®å®šç¾©æ–¹æ³•</strong>ã§ã™ã€‚</p>
        
        <h3>ğŸ¤” ãªãœå¤‰æ•°ãŒå¿…è¦ãªã®?</h3>
        
        <p>å¤‰æ•°ã¨ã¯ã€<strong>ãƒ‡ãƒ¼ã‚¿ã«åå‰ã‚’ä»˜ã‘ã¦ä¸€æ™‚çš„ã«ä¿ç®¡ã—ã¦ãŠãç®±</strong>ã®ã‚ˆã†ãªã‚‚ã®ã§ã™ã€‚
        æ–™ç†ã«ä¾‹ãˆã‚‹ã¨ã€<strong>ææ–™ã‚’å…¥ã‚Œã¦ãŠãã€Œãƒ©ãƒ™ãƒ«ä»˜ãã®ãƒœã‚¦ãƒ«ã€</strong>ã¨åŒã˜å½¹å‰²ã‚’æœãŸã—ã¾ã™ã€‚</p>
        
        <div class="important">
            <p><strong>ğŸ³ æ–™ç†ã®ä¸‹ã”ã—ã‚‰ãˆã«ä¾‹ãˆã‚‹ã¨:</strong></p>
            <ul>
                <li>ğŸ¥• <strong>ææ–™ã‚’åˆ‡ã‚‹</strong> = ãƒ‡ãƒ¼ã‚¿ã‚’å—ã‘å–ã‚‹ï¼ˆmsg.payloadï¼‰</li>
                <li>ğŸ¥£ <strong>ãƒœã‚¦ãƒ«ã«å…¥ã‚Œã¦åå‰ã‚’ä»˜ã‘ã‚‹</strong> = å¤‰æ•°ã«ä»£å…¥ã™ã‚‹ï¼ˆconst temperature = 25ï¼‰</li>
                <li>ğŸ“ <strong>ã€Œäººå‚ã®ãƒœã‚¦ãƒ«ã€ã€Œç‰ã­ãã®ãƒœã‚¦ãƒ«ã€</strong> = å¤‰æ•°åã§åŒºåˆ¥ã§ãã‚‹</li>
                <li>ğŸ‘¨â€ğŸ³ <strong>ãƒ¬ã‚·ãƒ”é€šã‚Šã«ä½¿ã†</strong> = å¤‰æ•°åã§å‘¼ã³å‡ºã—ã¦è¨ˆç®—ã‚„å‡¦ç†ã«ä½¿ã†</li>
            </ul>
            <p>ã‚‚ã—ãƒœã‚¦ãƒ«ï¼ˆå¤‰æ•°ï¼‰ãŒãªã‹ã£ãŸã‚‰ã€åˆ‡ã£ãŸææ–™ãŒãƒãƒ©ãƒãƒ©ã«ãªã£ã¦ã€Œã©ã‚ŒãŒä½•ã ã£ã‘ï¼Ÿã€ã¨æ··ä¹±ã—ã¦ã—ã¾ã„ã¾ã™ã€‚
            å¤‰æ•°ã‚’ä½¿ã†ã“ã¨ã§ã€<strong>ãƒ‡ãƒ¼ã‚¿ã‚’æ•´ç†ã—ã¦ã€å¾Œã‹ã‚‰åå‰ã§å‘¼ã³å‡ºã›ã‚‹</strong>ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚</p>
        </div>
        
        <div class="code-block">// å¤‰æ•°ãŒãªã„ã¨...
msg.payload.sensors[0].temperature * 9 / 5 + 32  // ä½•ã‚’è¨ˆç®—ã—ã¦ã‚‹ã‹åˆ†ã‹ã‚Šã«ãã„

// å¤‰æ•°ã‚’ä½¿ã†ã¨...
const celsius = msg.payload.sensors[0].temperature;  // æ‘‚æ°æ¸©åº¦ã‚’å–ã‚Šå‡ºã™
const fahrenheit = celsius * 9 / 5 + 32;             // è¯æ°ã«å¤‰æ›
// å‡¦ç†ã®æ„å›³ãŒæ˜ç¢ºã«ãªã‚‹ï¼</div>
        
        <div class="tip">
            <p><strong>ğŸ“Œ å¤‰æ•°ã‚’ä½¿ã†ãƒ¡ãƒªãƒƒãƒˆ:</strong></p>
            <ul>
                <li><strong>å¯èª­æ€§</strong>: ã‚³ãƒ¼ãƒ‰ãŒèª­ã¿ã‚„ã™ããªã‚‹ï¼ˆä½•ã®ãƒ‡ãƒ¼ã‚¿ã‹åå‰ã§åˆ†ã‹ã‚‹ï¼‰</li>
                <li><strong>å†åˆ©ç”¨</strong>: åŒã˜ãƒ‡ãƒ¼ã‚¿ã‚’ä½•åº¦ã‚‚ä½¿ãˆã‚‹ï¼ˆæ¯å› msg.payload.xxx ã¨æ›¸ã‹ãªãã¦æ¸ˆã‚€ï¼‰</li>
                <li><strong>ãƒ‡ãƒãƒƒã‚°</strong>: é€”ä¸­ã®å€¤ã‚’ç¢ºèªã—ã‚„ã™ã„</li>
                <li><strong>ä¿å®ˆæ€§</strong>: å¾Œã‹ã‚‰ä¿®æ­£ã—ã‚„ã™ã„</li>
            </ul>
        </div>
        
        <h3>ğŸ“ å¤‰æ•°å®šç¾©ã®3ã¤ã®ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰</h3>
        
        <div class="category-header">ğŸ“ å¤‰æ•°å®šç¾©ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰</div>
        <div class="category-content">
            <table class="comparison-table">
                <tr>
                    <th>ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰</th>
                    <th>å†ä»£å…¥</th>
                    <th>å†å®£è¨€</th>
                    <th>ã‚¹ã‚³ãƒ¼ãƒ—</th>
                    <th>æ¨å¥¨åº¦</th>
                </tr>
                <tr>
                    <td>const</td>
                    <td>âŒ ä¸å¯</td>
                    <td>âŒ ä¸å¯</td>
                    <td>ãƒ–ãƒ­ãƒƒã‚¯</td>
                    <td>â­â­â­ æœ€æ¨å¥¨</td>
                </tr>
                <tr>
                    <td>let</td>
                    <td>âœ… å¯èƒ½</td>
                    <td>âŒ ä¸å¯</td>
                    <td>ãƒ–ãƒ­ãƒƒã‚¯</td>
                    <td>â­â­ æ¨å¥¨</td>
                </tr>
                <tr>
                    <td>var</td>
                    <td>âœ… å¯èƒ½</td>
                    <td>âœ… å¯èƒ½</td>
                    <td>é–¢æ•°</td>
                    <td>â­ éæ¨å¥¨</td>
                </tr>
            </table>
        </div>
        
        <div class="js-code" data-copy="true">// ===== const: å†ä»£å…¥ä¸å¯ï¼ˆæœ€ã‚‚æ¨å¥¨ï¼‰=====
const PI = 3.14159;           // å®šæ•°
const sensorId = "sensor_A";  // å¤‰æ›´ã—ãªã„å€¤
const config = { timeout: 5000, retry: 3 };  // ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ

// PI = 3.14;  // ã‚¨ãƒ©ãƒ¼ï¼å†ä»£å…¥ã§ããªã„

// ãŸã ã—ã€ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®ä¸­èº«ã¯å¤‰æ›´å¯èƒ½
config.timeout = 10000;  // OK


// ===== let: å†ä»£å…¥å¯èƒ½ï¼ˆå€¤ãŒå¤‰ã‚ã‚‹å ´åˆï¼‰=====
let count = 0;
count++;              // OK: 1ã«ãªã‚‹

let temperature = 25.5;
temperature = 26.0;   // OK: å†ä»£å…¥å¯èƒ½

let message;          // å¾Œã§ä»£å…¥ã™ã‚‹ã“ã¨ã‚‚å¯èƒ½
message = "Hello";


// ===== var: å¤ã„æ›¸ãæ–¹ï¼ˆä½¿ã‚ãªã„ï¼‰=====
// var ã¯äºˆæœŸã—ãªã„å‹•ä½œã‚’å¼•ãèµ·ã“ã™ã“ã¨ãŒã‚ã‚‹ãŸã‚éæ¨å¥¨
var oldStyle = "é¿ã‘ã‚‹ã¹ã";</div>
        
        <div class="tip">
            <p><strong>ğŸ“Œ å®Ÿè·µçš„ãªãƒ«ãƒ¼ãƒ«:</strong></p>
            <ul>
                <li><strong>åŸºæœ¬ã¯ const</strong> ã‚’ä½¿ã†ï¼ˆå¤‰æ›´ã—ãªã„å€¤ãŒã»ã¨ã‚“ã©ï¼‰</li>
                <li><strong>å€¤ãŒå¤‰ã‚ã‚‹å ´åˆã ã‘ let</strong> ã‚’ä½¿ã†ï¼ˆã‚«ã‚¦ãƒ³ã‚¿ãƒ¼ã€ãƒ«ãƒ¼ãƒ—å¤‰æ•°ãªã©ï¼‰</li>
                <li><strong>var ã¯ä½¿ã‚ãªã„</strong>ï¼ˆãƒ¬ã‚¬ã‚·ãƒ¼ã‚³ãƒ¼ãƒ‰ã®èª­è§£æ™‚ã®ã¿ç†è§£ãŒå¿…è¦ï¼‰</li>
            </ul>
        </div>
        
        <h3>ğŸ”§ Node-REDã§ã®å¤‰æ•°å®šç¾©ä¾‹</h3>
        
        <div class="js-code" data-copy="true">// Functionãƒãƒ¼ãƒ‰ã§ã®å…¸å‹çš„ãªå¤‰æ•°å®šç¾©

// å…¥åŠ›ãƒ‡ãƒ¼ã‚¿ã®å–å¾—ï¼ˆconstæ¨å¥¨ï¼šé€šå¸¸å¤‰æ›´ã—ãªã„ï¼‰
const payload = msg.payload;
const topic = msg.topic;
const sensors = msg.payload.sensors;  // é…åˆ—

// è¨­å®šå€¤ï¼ˆconstæ¨å¥¨ï¼‰
const THRESHOLD = 30;
const MAX_RETRY = 3;

// è¨ˆç®—çµæœã‚’æ ¼ç´ï¼ˆletï¼šå€¤ãŒå¤‰ã‚ã‚‹å ´åˆï¼‰
let total = 0;
let status = "unknown";

// ãƒ«ãƒ¼ãƒ—å‡¦ç†
for (let i = 0; i < sensors.length; i++) {
    total += sensors[i].value;
}

// æ¡ä»¶åˆ†å²ã§å€¤ãŒå¤‰ã‚ã‚‹
if (total > THRESHOLD) {
    status = "warning";
} else {
    status = "normal";
}

msg.payload = { total, status };
return msg;</div>
        
        <h2>ğŸ“š 2. é…åˆ—æ“ä½œãƒ¡ã‚½ãƒƒãƒ‰</h2>
        
        <p>IoTãƒ‡ãƒ¼ã‚¿å‡¦ç†ã§ã¯ã€ã‚»ãƒ³ã‚µãƒ¼ãƒ‡ãƒ¼ã‚¿ã®é…åˆ—ã‚’æ“ä½œã™ã‚‹ã“ã¨ãŒéå¸¸ã«å¤šã„ã§ã™ã€‚
        Node-REDã®åŸºæœ¬ãƒãƒ¼ãƒ‰ã§ã¯é›£ã—ã„ã€æŸ”è»Ÿãªé…åˆ—å‡¦ç†ã‚’Functionãƒãƒ¼ãƒ‰ã§å®Ÿç¾ã§ãã¾ã™ã€‚</p>
        
        <div class="feature-grid">
            <div class="feature-card">
                <h4><span class="method-badge badge-array">map()</span></h4>
                <p>å„è¦ç´ ã‚’å¤‰æ›ã—ã¦æ–°ã—ã„é…åˆ—ã‚’ä½œæˆ</p>
                <div class="code-block">[1,2,3].map(x => x * 2)
â†’ [2, 4, 6]</div>
            </div>
            
            <div class="feature-card">
                <h4><span class="method-badge badge-array">filter()</span></h4>
                <p>æ¡ä»¶ã«åˆã†è¦ç´ ã ã‘ã‚’æŠ½å‡º</p>
                <div class="code-block">[1,2,3,4].filter(x => x > 2)
â†’ [3, 4]</div>
            </div>
            
            <div class="feature-card">
                <h4><span class="method-badge badge-array">find()</span></h4>
                <p>æ¡ä»¶ã«åˆã†æœ€åˆã®è¦ç´ ã‚’å–å¾—</p>
                <div class="code-block">[1,2,3].find(x => x > 1)
â†’ 2</div>
            </div>
            
            <div class="feature-card">
                <h4><span class="method-badge badge-array">reduce()</span></h4>
                <p>é…åˆ—ã‚’1ã¤ã®å€¤ã«é›†ç´„</p>
                <div class="code-block">[1,2,3].reduce((a,b) => a+b, 0)
â†’ 6</div>
            </div>
        </div>
        
        <h3>ğŸ¯ map() - é…åˆ—ã®å„è¦ç´ ã‚’å¤‰æ›</h3>
        
        <div class="syntax-box">
            é…åˆ—.map(è¦ç´  => å¤‰æ›å‡¦ç†)
        </div>
        
        <div class="js-code" data-copy="true">// map(): å„è¦ç´ ã‚’å¤‰æ›ã—ãŸæ–°ã—ã„é…åˆ—ã‚’ä½œæˆ

// ä¾‹1: æ•°å€¤ã‚’2å€ã«ã™ã‚‹
const numbers = [1, 2, 3, 4, 5];
const doubled = numbers.map(n => n * 2);
// çµæœ: [2, 4, 6, 8, 10]


// ä¾‹2: ã‚»ãƒ³ã‚µãƒ¼ãƒ‡ãƒ¼ã‚¿ã‹ã‚‰æ¸©åº¦ã ã‘ã‚’æŠ½å‡º
const sensors = [
    { id: "A", temperature: 25, humidity: 60 },
    { id: "B", temperature: 28, humidity: 55 },
    { id: "C", temperature: 22, humidity: 70 }
];

const temperatures = sensors.map(s => s.temperature);
// çµæœ: [25, 28, 22]


// ä¾‹3: ãƒ‡ãƒ¼ã‚¿å½¢å¼ã‚’å¤‰æ›
const converted = sensors.map(s => ({
    name: s.id,
    temp: s.temperature,
    status: s.temperature > 25 ? "é«˜æ¸©" : "æ­£å¸¸"
}));
// çµæœ: [{name:"A", temp:25, status:"æ­£å¸¸"}, ...]


// ä¾‹4: ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã‚‚ä½¿ç”¨
const withIndex = sensors.map((s, index) => ({
    ...s,
    order: index + 1
}));
// çµæœ: [{id:"A", temperature:25, humidity:60, order:1}, ...]</div>
        
        <h3>ğŸ¯ filter() - æ¡ä»¶ã«åˆã†è¦ç´ ã‚’æŠ½å‡º</h3>
        
        <div class="syntax-box">
            é…åˆ—.filter(è¦ç´  => æ¡ä»¶)
        </div>
        
        <div class="js-code" data-copy="true">// filter(): æ¡ä»¶ã‚’æº€ãŸã™è¦ç´ ã ã‘ã®é…åˆ—ã‚’ä½œæˆ

// ä¾‹1: å¶æ•°ã ã‘ã‚’æŠ½å‡º
const numbers = [1, 2, 3, 4, 5, 6];
const evens = numbers.filter(n => n % 2 === 0);
// çµæœ: [2, 4, 6]


// ä¾‹2: é«˜æ¸©ã‚»ãƒ³ã‚µãƒ¼ã ã‘ã‚’æŠ½å‡º
const sensors = [
    { id: "A", temperature: 25 },
    { id: "B", temperature: 35 },
    { id: "C", temperature: 28 },
    { id: "D", temperature: 32 }
];

const hotSensors = sensors.filter(s => s.temperature > 30);
// çµæœ: [{id:"B", temperature:35}, {id:"D", temperature:32}]


// ä¾‹3: æœ‰åŠ¹ãªãƒ‡ãƒ¼ã‚¿ã ã‘ã‚’æŠ½å‡ºï¼ˆnull, undefinedã‚’é™¤å¤–ï¼‰
const data = [10, null, 25, undefined, 30, 0];
const validData = data.filter(d => d !== null && d !== undefined);
// çµæœ: [10, 25, 30, 0]

// ã‚ˆã‚Šç°¡æ½”ã«ï¼ˆãŸã ã—0ã‚‚é™¤å¤–ã•ã‚Œã‚‹ã®ã§æ³¨æ„ï¼‰
const nonEmpty = data.filter(d => d);
// çµæœ: [10, 25, 30]  â€»0ã‚‚é™¤å¤–ã•ã‚Œã‚‹


// ä¾‹4: è¤‡æ•°æ¡ä»¶
const alerts = sensors.filter(s => 
    s.temperature > 25 && s.temperature < 35
);
// çµæœ: [{id:"C", temperature:28}, {id:"D", temperature:32}]</div>
        
        <h3>ğŸ¯ find() / findIndex() - è¦ç´ ã‚’æ¤œç´¢</h3>
        
        <div class="syntax-box">
            é…åˆ—.find(è¦ç´  => æ¡ä»¶)ã€€ã€€ã€€// è¦ç´ ã‚’è¿”ã™
            é…åˆ—.findIndex(è¦ç´  => æ¡ä»¶)  // ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã‚’è¿”ã™
        </div>
        
        <div class="js-code" data-copy="true">// find(): æ¡ä»¶ã«åˆã†æœ€åˆã®è¦ç´ ã‚’å–å¾—ï¼ˆ1ã¤ã ã‘ï¼‰

const sensors = [
    { id: "A", temperature: 25 },
    { id: "B", temperature: 35 },
    { id: "C", temperature: 28 }
];

// ä¾‹1: IDã§æ¤œç´¢
const sensorB = sensors.find(s => s.id === "B");
// çµæœ: {id: "B", temperature: 35}

// ä¾‹2: æ¡ä»¶ã§æ¤œç´¢ï¼ˆæœ€åˆã«ãƒãƒƒãƒã—ãŸã‚‚ã®ï¼‰
const hotSensor = sensors.find(s => s.temperature > 30);
// çµæœ: {id: "B", temperature: 35}

// ä¾‹3: è¦‹ã¤ã‹ã‚‰ãªã„å ´åˆ
const notFound = sensors.find(s => s.id === "Z");
// çµæœ: undefined


// findIndex(): ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ï¼ˆä½ç½®ï¼‰ã‚’å–å¾—
const index = sensors.findIndex(s => s.id === "B");
// çµæœ: 1

const notFoundIndex = sensors.findIndex(s => s.id === "Z");
// çµæœ: -1ï¼ˆè¦‹ã¤ã‹ã‚‰ãªã„å ´åˆï¼‰</div>
        
        <h3>ğŸ¯ reduce() - é…åˆ—ã‚’é›†ç´„</h3>
        
        <div class="syntax-box">
            é…åˆ—.reduce((ç´¯ç©å€¤, ç¾åœ¨å€¤) => å‡¦ç†, åˆæœŸå€¤)
        </div>
        
        <div class="js-code" data-copy="true">// reduce(): é…åˆ—ã‚’1ã¤ã®å€¤ã«ã¾ã¨ã‚ã‚‹

// ä¾‹1: åˆè¨ˆã‚’è¨ˆç®—
const numbers = [10, 20, 30, 40];
const sum = numbers.reduce((total, n) => total + n, 0);
// çµæœ: 100

// å‡¦ç†ã®æµã‚Œ:
// total=0,  n=10 â†’ 0+10=10
// total=10, n=20 â†’ 10+20=30
// total=30, n=30 â†’ 30+30=60
// total=60, n=40 â†’ 60+40=100


// ä¾‹2: æœ€å¤§å€¤ã‚’æ±‚ã‚ã‚‹
const max = numbers.reduce((a, b) => a > b ? a : b);
// çµæœ: 40


// ä¾‹3: ã‚»ãƒ³ã‚µãƒ¼ãƒ‡ãƒ¼ã‚¿ã®å¹³å‡æ¸©åº¦
const sensors = [
    { id: "A", temperature: 25 },
    { id: "B", temperature: 30 },
    { id: "C", temperature: 28 }
];

const avgTemp = sensors.reduce((sum, s) => sum + s.temperature, 0) 
                / sensors.length;
// çµæœ: 27.666...


// ä¾‹4: ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã«å¤‰æ›ï¼ˆIDã‚’ã‚­ãƒ¼ã«ã—ãŸè¾æ›¸ï¼‰
const sensorMap = sensors.reduce((obj, s) => {
    obj[s.id] = s.temperature;
    return obj;
}, {});
// çµæœ: { A: 25, B: 30, C: 28 }


// ä¾‹5: ã‚°ãƒ«ãƒ¼ãƒ—åŒ–
const data = [
    { type: "æ¸©åº¦", value: 25 },
    { type: "æ¹¿åº¦", value: 60 },
    { type: "æ¸©åº¦", value: 28 },
    { type: "æ¹¿åº¦", value: 55 }
];

const grouped = data.reduce((groups, item) => {
    const key = item.type;
    if (!groups[key]) groups[key] = [];
    groups[key].push(item.value);
    return groups;
}, {});
// çµæœ: { "æ¸©åº¦": [25, 28], "æ¹¿åº¦": [60, 55] }</div>
        
        <h3>ğŸ¯ ãã®ä»–ã®é…åˆ—ãƒ¡ã‚½ãƒƒãƒ‰</h3>
        
        <div class="js-code" data-copy="true">// ===== some() / every(): æ¡ä»¶ãƒã‚§ãƒƒã‚¯ =====
const numbers = [1, 2, 3, 4, 5];

// some(): 1ã¤ã§ã‚‚æ¡ä»¶ã‚’æº€ãŸã›ã°true
const hasLarge = numbers.some(n => n > 4);   // true
const hasNeg = numbers.some(n => n < 0);     // false

// every(): å…¨ã¦æ¡ä»¶ã‚’æº€ãŸã›ã°true
const allPositive = numbers.every(n => n > 0);  // true
const allLarge = numbers.every(n => n > 3);     // false


// ===== includes(): è¦ç´ ã®å­˜åœ¨ç¢ºèª =====
const fruits = ["apple", "orange", "banana"];
fruits.includes("orange");  // true
fruits.includes("grape");   // false


// ===== indexOf(): ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹å–å¾— =====
fruits.indexOf("orange");   // 1
fruits.indexOf("grape");    // -1ï¼ˆè¦‹ã¤ã‹ã‚‰ãªã„ï¼‰


// ===== sort(): ä¸¦ã³æ›¿ãˆ =====
const nums = [3, 1, 4, 1, 5];

// æ˜‡é †ï¼ˆæ•°å€¤ã®å ´åˆã¯æ¯”è¼ƒé–¢æ•°ãŒå¿…è¦ï¼‰
const asc = [...nums].sort((a, b) => a - b);  // [1, 1, 3, 4, 5]

// é™é †
const desc = [...nums].sort((a, b) => b - a); // [5, 4, 3, 1, 1]

// ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆé…åˆ—ã®ã‚½ãƒ¼ãƒˆ
const sensors = [
    { id: "B", temp: 30 },
    { id: "A", temp: 25 },
    { id: "C", temp: 28 }
];
const sorted = [...sensors].sort((a, b) => a.temp - b.temp);
// æ¸©åº¦ã®æ˜‡é †: [{id:"A",...}, {id:"C",...}, {id:"B",...}]


// ===== slice(): éƒ¨åˆ†é…åˆ—ã‚’å–å¾—ï¼ˆå…ƒé…åˆ—ã¯å¤‰æ›´ã—ãªã„ï¼‰=====
const arr = [0, 1, 2, 3, 4];
arr.slice(1, 3);    // [1, 2]  ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹1ã‹ã‚‰3ã®æ‰‹å‰ã¾ã§
arr.slice(2);       // [2, 3, 4]  ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹2ã‹ã‚‰æœ€å¾Œã¾ã§
arr.slice(-2);      // [3, 4]  æœ€å¾Œã‹ã‚‰2ã¤


// ===== forEach(): å„è¦ç´ ã«å‡¦ç†ï¼ˆæˆ»ã‚Šå€¤ãªã—ï¼‰=====
const values = [1, 2, 3];
values.forEach((v, i) => {
    node.warn(`ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹${i}: ${v}`);
});


// ===== join(): é…åˆ—ã‚’æ–‡å­—åˆ—ã«çµåˆ =====
const words = ["Hello", "World"];
words.join(" ");    // "Hello World"
words.join(", ");   // "Hello, World"
words.join("");     // "HelloWorld"</div>
        
        <div class="warning">
            <p><strong>âš ï¸ sort() ã®æ³¨æ„ç‚¹:</strong></p>
            <p><code>sort()</code> ã¯<strong>å…ƒã®é…åˆ—ã‚’å¤‰æ›´</strong>ã—ã¾ã™ã€‚å…ƒã®é…åˆ—ã‚’æ®‹ã—ãŸã„å ´åˆã¯ã€å…ˆã«ã‚³ãƒ”ãƒ¼ï¼ˆ<code>[...é…åˆ—]</code> ã‚„ <code>slice()</code>ï¼‰ã—ã¦ã‹ã‚‰ã‚½ãƒ¼ãƒˆã—ã¦ãã ã•ã„ã€‚</p>
        </div>
        
        <h2>ğŸ“ 3. æ–‡å­—åˆ—æ“ä½œãƒ¡ã‚½ãƒƒãƒ‰</h2>
        
        <p>ã‚»ãƒ³ã‚µãƒ¼IDã€ãƒ­ã‚°ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã€ãƒ•ã‚¡ã‚¤ãƒ«åãªã©ã€æ–‡å­—åˆ—å‡¦ç†ã‚‚ã‚ˆãä½¿ã„ã¾ã™ã€‚</p>
        
        <div class="feature-grid">
            <div class="feature-card">
                <h4><span class="method-badge badge-string">split()</span></h4>
                <p>æ–‡å­—åˆ—ã‚’åˆ†å‰²ã—ã¦é…åˆ—ã«</p>
                <div class="code-block">"a,b,c".split(",")
â†’ ["a", "b", "c"]</div>
            </div>
            
            <div class="feature-card">
                <h4><span class="method-badge badge-string">replace()</span></h4>
                <p>æ–‡å­—åˆ—ã‚’ç½®æ›</p>
                <div class="code-block">"Hello".replace("l","L")
â†’ "HeLlo"</div>
            </div>
            
            <div class="feature-card">
                <h4><span class="method-badge badge-string">trim()</span></h4>
                <p>å‰å¾Œã®ç©ºç™½ã‚’é™¤å»</p>
                <div class="code-block">"  abc  ".trim()
â†’ "abc"</div>
            </div>
            
            <div class="feature-card">
                <h4><span class="method-badge badge-string">substring()</span></h4>
                <p>éƒ¨åˆ†æ–‡å­—åˆ—ã‚’å–å¾—</p>
                <div class="code-block">"Hello".substring(0,2)
â†’ "He"</div>
            </div>
        </div>
        
        <div class="js-code" data-copy="true">// ===== split(): æ–‡å­—åˆ—ã‚’é…åˆ—ã«åˆ†å‰² =====
const csv = "apple,orange,banana";
const fruits = csv.split(",");
// çµæœ: ["apple", "orange", "banana"]

const path = "/home/user/data/sensor.json";
const parts = path.split("/");
// çµæœ: ["", "home", "user", "data", "sensor.json"]

const filename = parts[parts.length - 1];  // "sensor.json"


// ===== replace() / replaceAll(): ç½®æ› =====
const text = "Hello World";

// æœ€åˆã®ä¸€è‡´ã ã‘ç½®æ›
text.replace("o", "0");       // "Hell0 World"

// å…¨ã¦ç½®æ›ï¼ˆæ­£è¦è¡¨ç¾ã‚’ä½¿ç”¨ï¼‰
text.replace(/o/g, "0");      // "Hell0 W0rld"

// replaceAllï¼ˆES2021ï¼‰
text.replaceAll("o", "0");    // "Hell0 W0rld"

// æ­£è¦è¡¨ç¾ã§ãƒ‘ã‚¿ãƒ¼ãƒ³ç½®æ›
const log = "Error: 404 Not Found";
log.replace(/\d+/, "XXX");    // "Error: XXX Not Found"


// ===== trim() / trimStart() / trimEnd(): ç©ºç™½é™¤å» =====
const padded = "  Hello World  ";
padded.trim();        // "Hello World"
padded.trimStart();   // "Hello World  "
padded.trimEnd();     // "  Hello World"


// ===== substring() / slice(): éƒ¨åˆ†æ–‡å­—åˆ— =====
const str = "Hello World";

str.substring(0, 5);  // "Hello"
str.substring(6);     // "World"

str.slice(0, 5);      // "Hello"
str.slice(-5);        // "World"ï¼ˆå¾Œã‚ã‹ã‚‰5æ–‡å­—ï¼‰


// ===== toLowerCase() / toUpperCase(): å¤§æ–‡å­—å°æ–‡å­— =====
"Hello".toLowerCase();  // "hello"
"Hello".toUpperCase();  // "HELLO"


// ===== includes() / startsWith() / endsWith(): æ¤œç´¢ =====
const message = "Error: Connection failed";

message.includes("Error");      // true
message.startsWith("Error");    // true
message.endsWith("failed");     // true
message.startsWith("Warning");  // false


// ===== padStart() / padEnd(): ãƒ‘ãƒ‡ã‚£ãƒ³ã‚° =====
const num = "7";
num.padStart(3, "0");   // "007"
num.padEnd(3, "0");     // "700"

// æ—¥æ™‚ã®ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã«ä¾¿åˆ©
const hour = 9;
String(hour).padStart(2, "0");  // "09"


// ===== repeat(): ç¹°ã‚Šè¿”ã— =====
"ab".repeat(3);  // "ababab"
"-".repeat(20);  // "--------------------"</div>
        
        <h2>ğŸ—‚ï¸ 4. ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆæ“ä½œ</h2>
        
        <p>Node-REDã§ã¯ <code>msg</code> ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’é »ç¹ã«æ“ä½œã—ã¾ã™ã€‚ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®æ“ä½œæ–¹æ³•ã‚’è¦šãˆã¾ã—ã‚‡ã†ã€‚</p>
        
        <div class="js-code" data-copy="true">// ===== Object.keys() / values() / entries() =====
const sensor = {
    id: "A",
    temperature: 25,
    humidity: 60
};

// ã‚­ãƒ¼ä¸€è¦§
Object.keys(sensor);     // ["id", "temperature", "humidity"]

// å€¤ä¸€è¦§
Object.values(sensor);   // ["A", 25, 60]

// ã‚­ãƒ¼ã¨å€¤ã®ãƒšã‚¢
Object.entries(sensor);  // [["id","A"], ["temperature",25], ["humidity",60]]

// æ´»ç”¨ä¾‹: ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’ãƒ«ãƒ¼ãƒ—å‡¦ç†
Object.entries(sensor).forEach(([key, value]) => {
    node.warn(`${key}: ${value}`);
});


// ===== ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰æ§‹æ–‡ {...obj}: ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®ã‚³ãƒ”ãƒ¼ãƒ»ãƒãƒ¼ã‚¸ =====

// ã‚·ãƒ£ãƒ­ãƒ¼ã‚³ãƒ”ãƒ¼ï¼ˆæµ…ã„ã‚³ãƒ”ãƒ¼ï¼‰
const copy = { ...sensor };

// ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã‚’è¿½åŠ 
const extended = { ...sensor, status: "active" };
// {id:"A", temperature:25, humidity:60, status:"active"}

// ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã‚’ä¸Šæ›¸ã
const updated = { ...sensor, temperature: 30 };
// {id:"A", temperature:30, humidity:60}

// è¤‡æ•°ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’ãƒãƒ¼ã‚¸
const defaults = { timeout: 5000, retry: 3 };
const custom = { timeout: 10000 };
const config = { ...defaults, ...custom };
// {timeout: 10000, retry: 3}  â† å¾Œã‹ã‚‰æ›¸ã„ãŸæ–¹ãŒå„ªå…ˆ


// ===== åˆ†å‰²ä»£å…¥: ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‹ã‚‰å€¤ã‚’å–ã‚Šå‡ºã™ =====
const data = { name: "ã‚»ãƒ³ã‚µãƒ¼A", value: 25, unit: "â„ƒ" };

// å¾“æ¥ã®æ›¸ãæ–¹
const name1 = data.name;
const value1 = data.value;

// åˆ†å‰²ä»£å…¥ï¼ˆç°¡æ½”ï¼‰
const { name, value, unit } = data;
// name="ã‚»ãƒ³ã‚µãƒ¼A", value=25, unit="â„ƒ"

// åˆ¥åã‚’ä»˜ã‘ã‚‹
const { name: sensorName, value: temp } = data;
// sensorName="ã‚»ãƒ³ã‚µãƒ¼A", temp=25

// ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤
const { name: n, status = "unknown" } = data;
// n="ã‚»ãƒ³ã‚µãƒ¼A", status="unknown"ï¼ˆdataã«statusãŒãªã„ãŸã‚ï¼‰


// ===== msg ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã§ã®æ´»ç”¨ä¾‹ =====
// å…¥åŠ›
// msg = { payload: { temp: 25, humid: 60 }, topic: "sensor" }

// åˆ†å‰²ä»£å…¥ã§å–ã‚Šå‡ºã—
const { payload, topic } = msg;
const { temp, humid } = payload;

// æ–°ã—ã„msgã‚’ä½œæˆï¼ˆå…ƒã®ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã‚’ç¶­æŒã—ã¤ã¤æ›´æ–°ï¼‰
msg = {
    ...msg,
    payload: {
        ...msg.payload,
        status: temp > 30 ? "alert" : "normal"
    }
};


// ===== ã‚ªãƒ—ã‚·ãƒ§ãƒŠãƒ«ãƒã‚§ãƒ¼ãƒ³ (?.) : å®‰å…¨ãªã‚¢ã‚¯ã‚»ã‚¹ =====
const response = {
    data: {
        sensors: [{ id: "A", value: 25 }]
    }
};

// å¾“æ¥ï¼ˆã‚¨ãƒ©ãƒ¼ã«ãªã‚‹å¯èƒ½æ€§ï¼‰
// const val = response.data.sensors[0].value;

// å®‰å…¨ãªã‚¢ã‚¯ã‚»ã‚¹
const val = response?.data?.sensors?.[0]?.value;  // 25

// é€”ä¸­ãŒundefinedã§ã‚‚ã‚¨ãƒ©ãƒ¼ã«ãªã‚‰ãªã„
const missing = response?.unknown?.property;  // undefined


// ===== Nullåˆä½“æ¼”ç®—å­ (??) : ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ =====
const input = null;
const value2 = input ?? "ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ";  // "ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ"

// || ã¨ã®é•ã„
const zero = 0;
zero || 10;    // 10ï¼ˆ0ã¯falsyãªã®ã§ï¼‰
zero ?? 10;    // 0ï¼ˆnullã¨undefinedã®ã¿ç½®æ›ï¼‰

// å®Ÿç”¨ä¾‹
const timeout = msg.payload.timeout ?? 5000;
const name2 = msg.payload.name ?? "åç§°æœªè¨­å®š";</div>
        
        <h2>ğŸ”¢ 5. æ•°å€¤æ“ä½œ</h2>
        
        <div class="js-code" data-copy="true">// ===== Math ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ =====

// ä¸¸ã‚å‡¦ç†
Math.round(4.5);    // 5ï¼ˆå››æ¨äº”å…¥ï¼‰
Math.floor(4.9);    // 4ï¼ˆåˆ‡ã‚Šæ¨ã¦ï¼‰
Math.ceil(4.1);     // 5ï¼ˆåˆ‡ã‚Šä¸Šã’ï¼‰
Math.trunc(4.9);    // 4ï¼ˆå°æ•°éƒ¨ã‚’é™¤å»ï¼‰

// æœ€å¤§ãƒ»æœ€å°
Math.max(1, 5, 3);          // 5
Math.min(1, 5, 3);          // 1
Math.max(...[1, 5, 3]);     // é…åˆ—ã‹ã‚‰æœ€å¤§å€¤

// çµ¶å¯¾å€¤
Math.abs(-5);       // 5

// ã¹ãä¹—ãƒ»å¹³æ–¹æ ¹
Math.pow(2, 3);     // 8ï¼ˆ2ã®3ä¹—ï¼‰
Math.sqrt(16);      // 4ï¼ˆå¹³æ–¹æ ¹ï¼‰

// ä¹±æ•°
Math.random();              // 0ä»¥ä¸Š1æœªæº€ã®ä¹±æ•°
Math.floor(Math.random() * 100);  // 0ã€œ99ã®æ•´æ•°


// ===== æ•°å€¤å¤‰æ› =====
Number("123");       // 123
Number("123.45");    // 123.45
Number("abc");       // NaN

parseInt("123");     // 123
parseInt("123.45");  // 123ï¼ˆæ•´æ•°éƒ¨åˆ†ã®ã¿ï¼‰
parseInt("123abc");  // 123ï¼ˆæ•°å€¤éƒ¨åˆ†ã¾ã§ï¼‰

parseFloat("123.45");  // 123.45


// ===== å°æ•°ç‚¹ä»¥ä¸‹ã®æ¡æ•°åˆ¶å¾¡ =====
const num = 3.14159;

num.toFixed(2);      // "3.14"ï¼ˆæ–‡å­—åˆ—ã‚’è¿”ã™ï¼‰
Number(num.toFixed(2));  // 3.14ï¼ˆæ•°å€¤ã«å¤‰æ›ï¼‰

// æ³¨æ„: toFixedã¯å››æ¨äº”å…¥ã™ã‚‹
(2.345).toFixed(2);  // "2.35"
(2.344).toFixed(2);  // "2.34"


// ===== NaN / Infinity ã®ãƒã‚§ãƒƒã‚¯ =====
isNaN(NaN);          // true
isNaN("abc");        // trueï¼ˆæ•°å€¤ã«å¤‰æ›ã§ããªã„ï¼‰
isNaN(123);          // false

Number.isNaN(NaN);   // trueï¼ˆã‚ˆã‚Šå³å¯†ï¼‰
Number.isNaN("abc"); // false

isFinite(100);       // true
isFinite(Infinity);  // false
isFinite(NaN);       // false</div>
        
        <h2>ğŸ“… 6. æ—¥ä»˜æ“ä½œ</h2>
        
        <div class="js-code" data-copy="true">// ===== Date ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ =====

// ç¾åœ¨æ—¥æ™‚
const now = new Date();

// ç‰¹å®šã®æ—¥æ™‚ã‚’ä½œæˆ
const date1 = new Date("2024-01-15");
const date2 = new Date("2024-01-15T10:30:00");
const date3 = new Date(2024, 0, 15, 10, 30, 0);  // æœˆã¯0å§‹ã¾ã‚Š


// ===== æ—¥æ™‚ã®å–å¾— =====
now.getFullYear();   // 2024
now.getMonth();      // 0ã€œ11ï¼ˆ0=1æœˆï¼‰
now.getDate();       // 1ã€œ31ï¼ˆæ—¥ï¼‰
now.getDay();        // 0ã€œ6ï¼ˆ0=æ—¥æ›œï¼‰
now.getHours();      // 0ã€œ23
now.getMinutes();    // 0ã€œ59
now.getSeconds();    // 0ã€œ59
now.getMilliseconds(); // 0ã€œ999
now.getTime();       // UNIXã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ—ï¼ˆãƒŸãƒªç§’ï¼‰


// ===== æ—¥æ™‚ã®ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ =====

// ISOå½¢å¼
now.toISOString();   // "2024-01-15T01:30:00.000Z"

// ãƒ­ãƒ¼ã‚«ãƒ«å½¢å¼
now.toLocaleString("ja-JP");  // "2024/1/15 10:30:00"
now.toLocaleDateString("ja-JP");  // "2024/1/15"
now.toLocaleTimeString("ja-JP");  // "10:30:00"

// ã‚«ã‚¹ã‚¿ãƒ ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ
const year = now.getFullYear();
const month = String(now.getMonth() + 1).padStart(2, "0");
const day = String(now.getDate()).padStart(2, "0");
const hours = String(now.getHours()).padStart(2, "0");
const minutes = String(now.getMinutes()).padStart(2, "0");

const formatted = `${year}-${month}-${day} ${hours}:${minutes}`;
// "2024-01-15 10:30"


// ===== ã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ— =====

// ç¾åœ¨ã®ã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ—ï¼ˆãƒŸãƒªç§’ï¼‰
Date.now();  // 1705285800000

// ç§’ã«å¤‰æ›
Math.floor(Date.now() / 1000);

// ã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ—ã‹ã‚‰æ—¥æ™‚ã‚’ä½œæˆ
const fromTimestamp = new Date(1705285800000);


// ===== æ—¥æ™‚ã®è¨ˆç®— =====

// 1æ™‚é–“å¾Œ
const oneHourLater = new Date(now.getTime() + 60 * 60 * 1000);

// 1æ—¥å¾Œ
const oneDayLater = new Date(now.getTime() + 24 * 60 * 60 * 1000);

// 2ã¤ã®æ—¥æ™‚ã®å·®ï¼ˆãƒŸãƒªç§’ï¼‰
const diff = date2.getTime() - date1.getTime();
const diffHours = diff / (1000 * 60 * 60);  // æ™‚é–“ã«å¤‰æ›
const diffDays = diff / (1000 * 60 * 60 * 24);  // æ—¥æ•°ã«å¤‰æ›</div>
        
        <h2>âœ¨ 7. ä¾¿åˆ©ãªæ§‹æ–‡</h2>
        
        <h3>ğŸ”¤ ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆãƒªãƒ†ãƒ©ãƒ«</h3>
        
        <div class="js-code" data-copy="true">// ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆãƒªãƒ†ãƒ©ãƒ«: ãƒãƒƒã‚¯ã‚¯ã‚©ãƒ¼ãƒˆ(`)ã§å›²ã‚€

const name = "ã‚»ãƒ³ã‚µãƒ¼A";
const temp = 25.5;

// å¾“æ¥ã®æ–‡å­—åˆ—é€£çµ
const msg1 = "æ¸©åº¦: " + name + " = " + temp + "â„ƒ";

// ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆãƒªãƒ†ãƒ©ãƒ«ï¼ˆæ¨å¥¨ï¼‰
const msg2 = `æ¸©åº¦: ${name} = ${temp}â„ƒ`;

// å¼ã‚‚åŸ‹ã‚è¾¼ã‚ã‚‹
const status = `çŠ¶æ…‹: ${temp > 30 ? "é«˜æ¸©" : "æ­£å¸¸"}`;

// è¤‡æ•°è¡Œã‚‚ç°¡å˜
const html = `
<div>
    <h1>${name}</h1>
    <p>æ¸©åº¦: ${temp}â„ƒ</p>
</div>
`;


// Node-REDã§ã®æ´»ç”¨ä¾‹
msg.payload = `
ã‚»ãƒ³ã‚µãƒ¼ID: ${msg.topic}
æ¸¬å®šå€¤: ${msg.payload.value}
æ™‚åˆ»: ${new Date().toLocaleString("ja-JP")}
`.trim();</div>
        
        <h3>â“ ä¸‰é …æ¼”ç®—å­</h3>
        
        <div class="js-code" data-copy="true">// ä¸‰é …æ¼”ç®—å­: æ¡ä»¶ ? çœŸã®å€¤ : å½ã®å€¤

const temp = 32;

// ifæ–‡ã§æ›¸ãå ´åˆ
let status1;
if (temp > 30) {
    status1 = "é«˜æ¸©";
} else {
    status1 = "æ­£å¸¸";
}

// ä¸‰é …æ¼”ç®—å­ã§æ›¸ãå ´åˆï¼ˆ1è¡Œã§æ¸ˆã‚€ï¼‰
const status2 = temp > 30 ? "é«˜æ¸©" : "æ­£å¸¸";


// ãƒã‚¹ãƒˆï¼ˆå…¥ã‚Œå­ï¼‰ã‚‚å¯èƒ½ï¼ˆã‚„ã‚Šã™ãæ³¨æ„ï¼‰
const level = temp > 35 ? "å±é™º" 
            : temp > 30 ? "è­¦å‘Š" 
            : temp > 20 ? "æ­£å¸¸" 
            : "ä½æ¸©";


// å®Ÿç”¨ä¾‹: ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤
const timeout = msg.payload.timeout ? msg.payload.timeout : 5000;

// ã‚ˆã‚Šç°¡æ½”ã«ï¼ˆNullåˆä½“æ¼”ç®—å­ï¼‰
const timeout2 = msg.payload.timeout ?? 5000;</div>
        
        <h3>ğŸ”€ æ¡ä»¶åˆ†å²ã®çŸ­ç¸®å½¢</h3>
        
        <div class="js-code" data-copy="true">// çŸ­çµ¡è©•ä¾¡ï¼ˆã‚·ãƒ§ãƒ¼ãƒˆã‚µãƒ¼ã‚­ãƒƒãƒˆï¼‰

// && : å·¦ãŒtrueãªã‚‰å³ã‚’è¿”ã™
const isActive = true;
isActive && console.log("ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ã§ã™");  // å®Ÿè¡Œã•ã‚Œã‚‹

// || : å·¦ãŒfalsyãªã‚‰å³ã‚’è¿”ã™ï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ã«ä½¿ãˆã‚‹ï¼‰
const name = msg.payload.name || "åç§°æœªè¨­å®š";

// ?? : å·¦ãŒnull/undefinedãªã‚‰å³ã‚’è¿”ã™ï¼ˆã‚ˆã‚Šå®‰å…¨ï¼‰
const count = msg.payload.count ?? 0;  // 0ã‚‚ãã®ã¾ã¾ä½¿ã‚ã‚Œã‚‹


// æ—©æœŸãƒªã‚¿ãƒ¼ãƒ³
function processData(data) {
    // ãƒ‡ãƒ¼ã‚¿ãŒãªã‘ã‚Œã°æ—©æœŸçµ‚äº†
    if (!data) return null;
    
    // ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Œã°å‡¦ç†ã‚’ç¶šè¡Œ
    return data.map(d => d * 2);
}


// Node-REDã§ã®æ—©æœŸãƒªã‚¿ãƒ¼ãƒ³
if (!msg.payload) {
    return null;  // å‡¦ç†ã‚’ä¸­æ–­ï¼ˆæ¬¡ã®ãƒãƒ¼ãƒ‰ã«é€ã‚‰ãªã„ï¼‰
}

// ã“ã“ã‹ã‚‰é€šå¸¸å‡¦ç†
msg.payload = msg.payload.toUpperCase();
return msg;</div>
        
        <h3>ğŸ›¡ï¸ ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ï¼ˆtry-catchï¼‰</h3>
        
        <div class="js-code" data-copy="true">// try-catch: ã‚¨ãƒ©ãƒ¼ã‚’æ•æ‰ã—ã¦å‡¦ç†

try {
    // ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã™ã‚‹å¯èƒ½æ€§ã®ã‚ã‚‹å‡¦ç†
    const data = JSON.parse(msg.payload);
    msg.payload = data;
} catch (error) {
    // ã‚¨ãƒ©ãƒ¼ç™ºç”Ÿæ™‚ã®å‡¦ç†
    node.error("JSONãƒ‘ãƒ¼ã‚¹ã‚¨ãƒ©ãƒ¼: " + error.message, msg);
    msg.payload = { error: error.message };
}

return msg;


// å®Ÿç”¨ä¾‹: å®‰å…¨ãªãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã‚¢ã‚¯ã‚»ã‚¹
let value;
try {
    value = msg.payload.data.sensors[0].value;
} catch (e) {
    value = null;  // ã‚¢ã‚¯ã‚»ã‚¹ã§ããªã‘ã‚Œã°null
}

// ã¾ãŸã¯ã€ã‚ªãƒ—ã‚·ãƒ§ãƒŠãƒ«ãƒã‚§ãƒ¼ãƒ³ã‚’ä½¿ã†ï¼ˆã‚ˆã‚Šã‚·ãƒ³ãƒ—ãƒ«ï¼‰
const value2 = msg?.payload?.data?.sensors?.[0]?.value ?? null;</div>
        
        <h2>ğŸ¯ 8. Node-REDå®Ÿè·µä¾‹</h2>
        
        <h3>ğŸ“Š ã‚»ãƒ³ã‚µãƒ¼ãƒ‡ãƒ¼ã‚¿ã®é›†è¨ˆ</h3>
        
        <div class="node-example">
            <span class="node node-inject">Inject</span>
            <span class="arrow">â†’</span>
            <span class="node node-function">Function</span>
            <span class="arrow">â†’</span>
            <span class="node node-debug">Debug</span>
        </div>
        
        <div class="js-code" data-copy="true">// ã‚»ãƒ³ã‚µãƒ¼ãƒ‡ãƒ¼ã‚¿ã®é›†è¨ˆå‡¦ç†

const sensors = msg.payload;
// å…¥åŠ›ä¾‹: [
//   { id: "A", temperature: 25, humidity: 60 },
//   { id: "B", temperature: 32, humidity: 55 },
//   { id: "C", temperature: 28, humidity: 70 }
// ]

// æ¸©åº¦ã®çµ±è¨ˆã‚’è¨ˆç®—
const temps = sensors.map(s => s.temperature);
const avgTemp = temps.reduce((a, b) => a + b, 0) / temps.length;
const maxTemp = Math.max(...temps);
const minTemp = Math.min(...temps);

// é«˜æ¸©ã‚»ãƒ³ã‚µãƒ¼ã‚’æŠ½å‡º
const hotSensors = sensors
    .filter(s => s.temperature > 30)
    .map(s => s.id);

// çµæœã‚’æ•´å½¢
msg.payload = {
    timestamp: new Date().toISOString(),
    statistics: {
        average: Number(avgTemp.toFixed(1)),
        max: maxTemp,
        min: minTemp
    },
    alerts: hotSensors,
    alertCount: hotSensors.length
};

return msg;</div>
        
        <h3>ğŸ“ ãƒ­ã‚°ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®æ•´å½¢</h3>
        
        <div class="js-code" data-copy="true">// ãƒ­ã‚°ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®æ•´å½¢

const { topic, payload } = msg;
const timestamp = new Date().toLocaleString("ja-JP");

// ã‚»ãƒ³ã‚µãƒ¼IDã‚’æŠ½å‡ºï¼ˆä¾‹: "sensors/floor1/temp" â†’ "floor1"ï¼‰
const parts = topic.split("/");
const location = parts[1] || "unknown";

// ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚’åˆ¤å®š
const status = payload > 30 ? "ALERT" : "OK";

// æ•´å½¢ã•ã‚ŒãŸãƒ­ã‚°ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’ä½œæˆ
msg.payload = `[${timestamp}] [${status}] ${location}: ${payload}â„ƒ`;

// ã¾ãŸã¯æ§‹é€ åŒ–ãƒ­ã‚°
msg.payload = {
    timestamp,
    level: status === "ALERT" ? "warn" : "info",
    location,
    value: payload,
    message: `${location}ã®æ¸©åº¦ã¯${payload}â„ƒã§ã™`
};

return msg;</div>
        
        <h2>ğŸ‹ï¸ 9. å®Ÿè·µæ¼”ç¿’</h2>
        
        <div class="exercise">
            <h3>æ¼”ç¿’1: é…åˆ—ã®ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°ã¨å¤‰æ›<span class="difficulty difficulty-easy">åˆç´š</span></h3>
            
            <p><strong>ğŸ“ èª²é¡Œ:</strong></p>
            <p>ã‚»ãƒ³ã‚µãƒ¼ãƒ‡ãƒ¼ã‚¿é…åˆ—ã‹ã‚‰ã€æ¸©åº¦30åº¦ä»¥ä¸Šã®ã‚»ãƒ³ã‚µãƒ¼IDã ã‘ã‚’æŠ½å‡ºã—ã¦ãã ã•ã„ã€‚</p>
            
            <p><strong>ğŸ¯ è¦æ±‚ä»•æ§˜:</strong></p>
            <ul>
                <li>å…¥åŠ›: [{id:"A",temp:25}, {id:"B",temp:35}, {id:"C",temp:32}, {id:"D",temp:28}]</li>
                <li>å‡ºåŠ›: ["B", "C"]</li>
                <li>filter() ã¨ map() ã‚’ä½¿ç”¨</li>
            </ul>
            
            <details>
                <summary>ğŸ’¡ ãƒ’ãƒ³ãƒˆ</summary>
                <p>ãƒ¡ã‚½ãƒƒãƒ‰ãƒã‚§ãƒ¼ãƒ³ã§æ›¸ãã¨ç°¡æ½”ã§ã™:</p>
                <div class="code-block">é…åˆ—
    .filter(æ¡ä»¶)
    .map(å¤‰æ›)</div>
            </details>
            
            <details>
                <summary>âœ… è§£ç­”ä¾‹ãƒ•ãƒ­ãƒ¼</summary>
                <div class="flow-json">[
    {
        "id": "ex1_inject",
        "type": "inject",
        "name": "ã‚»ãƒ³ã‚µãƒ¼ãƒ‡ãƒ¼ã‚¿",
        "props": [{"p": "payload"}],
        "repeat": "",
        "crontab": "",
        "once": false,
        "topic": "",
        "payload": "[{\"id\":\"A\",\"temp\":25},{\"id\":\"B\",\"temp\":35},{\"id\":\"C\",\"temp\":32},{\"id\":\"D\",\"temp\":28}]",
        "payloadType": "json",
        "x": 150,
        "y": 100,
        "wires": [["ex1_function"]]
    },
    {
        "id": "ex1_function",
        "type": "function",
        "name": "é«˜æ¸©ã‚»ãƒ³ã‚µãƒ¼æŠ½å‡º",
        "func": "const sensors = msg.payload;\n\n// filter: 30åº¦ä»¥ä¸Šã‚’æŠ½å‡º\n// map: IDã ã‘ã‚’å–ã‚Šå‡ºã™\nconst hotSensorIds = sensors\n    .filter(s => s.temp >= 30)\n    .map(s => s.id);\n\nmsg.payload = hotSensorIds;\nreturn msg;",
        "outputs": 1,
        "x": 380,
        "y": 100,
        "wires": [["ex1_debug"]]
    },
    {
        "id": "ex1_debug",
        "type": "debug",
        "name": "çµæœ",
        "active": true,
        "tosidebar": true,
        "complete": "payload",
        "targetType": "msg",
        "x": 570,
        "y": 100,
        "wires": []
    }
]</div>
            </details>
        </div>
        
        <div class="exercise">
            <h3>æ¼”ç¿’2: æ–‡å­—åˆ—ã®è§£æ<span class="difficulty difficulty-medium">ä¸­ç´š</span></h3>
            
            <p><strong>ğŸ“ èª²é¡Œ:</strong></p>
            <p>MQTTãƒˆãƒ”ãƒƒã‚¯æ–‡å­—åˆ—ã‚’è§£æã—ã¦ã€æ§‹é€ åŒ–ãƒ‡ãƒ¼ã‚¿ã«å¤‰æ›ã—ã¦ãã ã•ã„ã€‚</p>
            
            <p><strong>ğŸ¯ è¦æ±‚ä»•æ§˜:</strong></p>
            <ul>
                <li>å…¥åŠ›ãƒˆãƒ”ãƒƒã‚¯: "factory/floor2/machine_A/temperature"</li>
                <li>å‡ºåŠ›: {factory: "factory", floor: "floor2", machine: "machine_A", sensor: "temperature"}</li>
                <li>split() ã¨ åˆ†å‰²ä»£å…¥ã‚’ä½¿ç”¨</li>
            </ul>
            
            <details>
                <summary>ğŸ’¡ ãƒ’ãƒ³ãƒˆ</summary>
                <p>é…åˆ—ã®åˆ†å‰²ä»£å…¥ã‚’ä½¿ã„ã¾ã™:</p>
                <div class="code-block">const [a, b, c, d] = "a/b/c/d".split("/");</div>
            </details>
            
            <details>
                <summary>âœ… è§£ç­”ä¾‹ãƒ•ãƒ­ãƒ¼</summary>
                <div class="flow-json">[
    {
        "id": "ex2_inject",
        "type": "inject",
        "name": "MQTTãƒˆãƒ”ãƒƒã‚¯",
        "props": [{"p": "topic"}],
        "repeat": "",
        "crontab": "",
        "once": false,
        "topic": "factory/floor2/machine_A/temperature",
        "x": 150,
        "y": 100,
        "wires": [["ex2_function"]]
    },
    {
        "id": "ex2_function",
        "type": "function",
        "name": "ãƒˆãƒ”ãƒƒã‚¯è§£æ",
        "func": "const topic = msg.topic;\n\n// ã‚¹ãƒ©ãƒƒã‚·ãƒ¥ã§åˆ†å‰²\nconst parts = topic.split(\"/\");\n\n// åˆ†å‰²ä»£å…¥ã§å„éƒ¨åˆ†ã‚’å–å¾—\nconst [factory, floor, machine, sensor] = parts;\n\nmsg.payload = {\n    factory,\n    floor,\n    machine,\n    sensor\n};\n\nreturn msg;",
        "outputs": 1,
        "x": 360,
        "y": 100,
        "wires": [["ex2_debug"]]
    },
    {
        "id": "ex2_debug",
        "type": "debug",
        "name": "çµæœ",
        "active": true,
        "tosidebar": true,
        "complete": "payload",
        "targetType": "msg",
        "x": 530,
        "y": 100,
        "wires": []
    }
]</div>
            </details>
        </div>
        
        <div class="exercise">
            <h3>æ¼”ç¿’3: ãƒ‡ãƒ¼ã‚¿ã®é›†ç´„<span class="difficulty difficulty-medium">ä¸­ç´š</span></h3>
            
            <p><strong>ğŸ“ èª²é¡Œ:</strong></p>
            <p>ã‚»ãƒ³ã‚µãƒ¼ãƒ‡ãƒ¼ã‚¿ã®é…åˆ—ã‹ã‚‰ã€å¹³å‡ãƒ»æœ€å¤§ãƒ»æœ€å°å€¤ã‚’è¨ˆç®—ã—ã¦ãã ã•ã„ã€‚</p>
            
            <p><strong>ğŸ¯ è¦æ±‚ä»•æ§˜:</strong></p>
            <ul>
                <li>å…¥åŠ›: [23, 28, 31, 25, 29, 27]</li>
                <li>å‡ºåŠ›: {average: 27.2, max: 31, min: 23, count: 6}</li>
                <li>reduce(), Math.max(), Math.min() ã‚’ä½¿ç”¨</li>
            </ul>
            
            <details>
                <summary>ğŸ’¡ ãƒ’ãƒ³ãƒˆ</summary>
                <div class="code-block">// åˆè¨ˆ
const sum = arr.reduce((a, b) => a + b, 0);

// é…åˆ—ã‹ã‚‰æœ€å¤§å€¤
Math.max(...arr);</div>
            </details>
            
            <details>
                <summary>âœ… è§£ç­”ä¾‹ãƒ•ãƒ­ãƒ¼</summary>
                <div class="flow-json">[
    {
        "id": "ex3_inject",
        "type": "inject",
        "name": "æ¸©åº¦ãƒ‡ãƒ¼ã‚¿",
        "props": [{"p": "payload"}],
        "repeat": "",
        "crontab": "",
        "once": false,
        "topic": "",
        "payload": "[23, 28, 31, 25, 29, 27]",
        "payloadType": "json",
        "x": 140,
        "y": 100,
        "wires": [["ex3_function"]]
    },
    {
        "id": "ex3_function",
        "type": "function",
        "name": "çµ±è¨ˆè¨ˆç®—",
        "func": "const values = msg.payload;\n\n// åˆè¨ˆã‚’è¨ˆç®—\nconst sum = values.reduce((a, b) => a + b, 0);\n\n// çµ±è¨ˆå€¤ã‚’è¨ˆç®—\nconst stats = {\n    average: Number((sum / values.length).toFixed(1)),\n    max: Math.max(...values),\n    min: Math.min(...values),\n    count: values.length\n};\n\nmsg.payload = stats;\nreturn msg;",
        "outputs": 1,
        "x": 340,
        "y": 100,
        "wires": [["ex3_debug"]]
    },
    {
        "id": "ex3_debug",
        "type": "debug",
        "name": "çµæœ",
        "active": true,
        "tosidebar": true,
        "complete": "payload",
        "targetType": "msg",
        "x": 510,
        "y": 100,
        "wires": []
    }
]</div>
            </details>
        </div>
        
        <div class="exercise">
            <h3>æ¼”ç¿’4: ãƒ‡ãƒ¼ã‚¿ã®ã‚°ãƒ«ãƒ¼ãƒ—åŒ–<span class="difficulty difficulty-hard">ä¸Šç´š</span></h3>
            
            <p><strong>ğŸ“ èª²é¡Œ:</strong></p>
            <p>ã‚»ãƒ³ã‚µãƒ¼ãƒ‡ãƒ¼ã‚¿ã‚’ã‚¿ã‚¤ãƒ—åˆ¥ã«ã‚°ãƒ«ãƒ¼ãƒ—åŒ–ã—ã€å„ã‚¿ã‚¤ãƒ—ã®å¹³å‡å€¤ã‚’è¨ˆç®—ã—ã¦ãã ã•ã„ã€‚</p>
            
            <p><strong>ğŸ¯ è¦æ±‚ä»•æ§˜:</strong></p>
            <ul>
                <li>å…¥åŠ›: [{type:"æ¸©åº¦",value:25}, {type:"æ¹¿åº¦",value:60}, {type:"æ¸©åº¦",value:28}, {type:"æ¹¿åº¦",value:55}]</li>
                <li>å‡ºåŠ›: {æ¸©åº¦: {values:[25,28], average:26.5}, æ¹¿åº¦: {values:[60,55], average:57.5}}</li>
                <li>reduce() ã‚’ä½¿ç”¨ã—ã¦ã‚°ãƒ«ãƒ¼ãƒ—åŒ–</li>
            </ul>
            
            <details>
                <summary>ğŸ’¡ ãƒ’ãƒ³ãƒˆ</summary>
                <div class="code-block">// reduce ã§ã‚°ãƒ«ãƒ¼ãƒ—åŒ–
const grouped = data.reduce((acc, item) => {
    const key = item.type;
    if (!acc[key]) acc[key] = [];
    acc[key].push(item.value);
    return acc;
}, {});</div>
            </details>
            
            <details>
                <summary>âœ… è§£ç­”ä¾‹ãƒ•ãƒ­ãƒ¼</summary>
                <div class="flow-json">[
    {
        "id": "ex4_inject",
        "type": "inject",
        "name": "ã‚»ãƒ³ã‚µãƒ¼ãƒ‡ãƒ¼ã‚¿",
        "props": [{"p": "payload"}],
        "repeat": "",
        "crontab": "",
        "once": false,
        "topic": "",
        "payload": "[{\"type\":\"æ¸©åº¦\",\"value\":25},{\"type\":\"æ¹¿åº¦\",\"value\":60},{\"type\":\"æ¸©åº¦\",\"value\":28},{\"type\":\"æ¹¿åº¦\",\"value\":55}]",
        "payloadType": "json",
        "x": 150,
        "y": 100,
        "wires": [["ex4_function"]]
    },
    {
        "id": "ex4_function",
        "type": "function",
        "name": "ã‚°ãƒ«ãƒ¼ãƒ—åŒ–ã¨é›†è¨ˆ",
        "func": "const data = msg.payload;\n\n// ã‚¿ã‚¤ãƒ—åˆ¥ã«ã‚°ãƒ«ãƒ¼ãƒ—åŒ–\nconst grouped = data.reduce((acc, item) => {\n    const key = item.type;\n    if (!acc[key]) {\n        acc[key] = { values: [] };\n    }\n    acc[key].values.push(item.value);\n    return acc;\n}, {});\n\n// å„ã‚°ãƒ«ãƒ¼ãƒ—ã®å¹³å‡ã‚’è¨ˆç®—\nObject.keys(grouped).forEach(key => {\n    const values = grouped[key].values;\n    const sum = values.reduce((a, b) => a + b, 0);\n    grouped[key].average = sum / values.length;\n});\n\nmsg.payload = grouped;\nreturn msg;",
        "outputs": 1,
        "x": 380,
        "y": 100,
        "wires": [["ex4_debug"]]
    },
    {
        "id": "ex4_debug",
        "type": "debug",
        "name": "çµæœ",
        "active": true,
        "tosidebar": true,
        "complete": "payload",
        "targetType": "msg",
        "x": 570,
        "y": 100,
        "wires": []
    }
]</div>
            </details>
        </div>
        
        <h2>ğŸ“ 10. ã¾ã¨ã‚</h2>
        
        <div class="important">
            <h3>é‡è¦ãƒã‚¤ãƒ³ãƒˆ</h3>
            <ul>
                <li>âœ… <strong>å¤‰æ•°å®šç¾©</strong>: åŸºæœ¬ã¯ <code>const</code>ã€å¤‰æ›´ã™ã‚‹å ´åˆã®ã¿ <code>let</code></li>
                <li>âœ… <strong>é…åˆ—æ“ä½œ</strong>: <code>map</code>, <code>filter</code>, <code>find</code>, <code>reduce</code> ã‚’ä½¿ã„ã“ãªã™</li>
                <li>âœ… <strong>æ–‡å­—åˆ—æ“ä½œ</strong>: <code>split</code>, <code>replace</code>, <code>trim</code> ã§æ–‡å­—åˆ—ã‚’åŠ å·¥</li>
                <li>âœ… <strong>ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ</strong>: ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰æ§‹æ–‡ <code>{...obj}</code> ã¨åˆ†å‰²ä»£å…¥ã§åŠ¹ç‡çš„ã«æ“ä½œ</li>
                <li>âœ… <strong>å®‰å…¨ãªã‚¢ã‚¯ã‚»ã‚¹</strong>: <code>?.</code>ï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒŠãƒ«ãƒã‚§ãƒ¼ãƒ³ï¼‰ã¨ <code>??</code>ï¼ˆNullåˆä½“ï¼‰</li>
                <li>âœ… <strong>ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆãƒªãƒ†ãƒ©ãƒ«</strong>: ãƒãƒƒã‚¯ã‚¯ã‚©ãƒ¼ãƒˆã§æ–‡å­—åˆ—ã‚’ç°¡æ½”ã«çµ„ã¿ç«‹ã¦</li>
            </ul>
        </div>
        
        <div class="warning">
            <h3>âš ï¸ ã‚ˆãã‚ã‚‹é–“é•ã„</h3>
            <ul>
                <li><strong>sort()ã§å…ƒé…åˆ—ã‚’å£Šã™</strong>: <code>[...arr].sort()</code> ã§ã‚³ãƒ”ãƒ¼ã—ã¦ã‹ã‚‰ã‚½ãƒ¼ãƒˆ</li>
                <li><strong>map()ã®æˆ»ã‚Šå€¤ã‚’å¿˜ã‚Œã‚‹</strong>: ã‚¢ãƒ­ãƒ¼é–¢æ•°ã§ <code>{}</code> ã‚’ä½¿ã†å ´åˆã¯ <code>return</code> ãŒå¿…è¦</li>
                <li><strong>getMonth()ãŒ0å§‹ã¾ã‚Š</strong>: 1æœˆã¯0ã€12æœˆã¯11</li>
                <li><strong>toFixed()ã¯æ–‡å­—åˆ—ã‚’è¿”ã™</strong>: æ•°å€¤ãŒå¿…è¦ãªã‚‰ <code>Number()</code> ã§å¤‰æ›</li>
                <li><strong>||ã§ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤</strong>: 0ã‚„ç©ºæ–‡å­—ã‚‚falsyãªã®ã§ <code>??</code> ã‚’ä½¿ã†</li>
            </ul>
        </div>
        
        <div class="tip">
            <h3>ğŸ“š æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—</h3>
            <p>ã“ã‚Œã‚‰ã®åŸºç¤ã‚’ãƒã‚¹ã‚¿ãƒ¼ã—ãŸã‚‰ã€ä»¥ä¸‹ã‚‚å­¦ã‚“ã§ã¿ã¾ã—ã‚‡ã†:</p>
            <ul>
                <li><strong>éåŒæœŸå‡¦ç†</strong>: Promise, async/await</li>
                <li><strong>æ­£è¦è¡¨ç¾</strong>: è¤‡é›‘ãªãƒ‘ã‚¿ãƒ¼ãƒ³ãƒãƒƒãƒãƒ³ã‚°</li>
                <li><strong>ã‚¯ãƒ©ã‚¹</strong>: ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆæŒ‡å‘ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°</li>
                <li><strong>ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«</strong>: ã‚³ãƒ¼ãƒ‰ã®åˆ†å‰²ã¨å†åˆ©ç”¨</li>
            </ul>
        </div>
        
        <h2>ğŸ”§ 11. ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°</h2>
        
        <table>
            <tr>
                <th>å•é¡Œ</th>
                <th>åŸå› </th>
                <th>è§£æ±ºæ–¹æ³•</th>
            </tr>
            <tr>
                <td>Cannot read property of undefined</td>
                <td>å­˜åœ¨ã—ãªã„ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã¸ã®ã‚¢ã‚¯ã‚»ã‚¹</td>
                <td>ã‚ªãƒ—ã‚·ãƒ§ãƒŠãƒ«ãƒã‚§ãƒ¼ãƒ³ <code>?.</code> ã‚’ä½¿ç”¨</td>
            </tr>
            <tr>
                <td>map is not a function</td>
                <td>é…åˆ—ã§ãªã„å€¤ã«map()ã‚’ä½¿ç”¨</td>
                <td><code>Array.isArray()</code> ã§ãƒã‚§ãƒƒã‚¯</td>
            </tr>
            <tr>
                <td>é…åˆ—ãŒå¤‰ã‚ã£ã¦ã—ã¾ã£ãŸ</td>
                <td>sort()ãªã©ãŒå…ƒé…åˆ—ã‚’å¤‰æ›´</td>
                <td><code>[...arr]</code> ã§ã‚³ãƒ”ãƒ¼ã—ã¦ã‹ã‚‰æ“ä½œ</td>
            </tr>
            <tr>
                <td>NaN ãŒå‡ºã‚‹</td>
                <td>æ•°å€¤å¤‰æ›ã®å¤±æ•—</td>
                <td><code>Number()</code> ã®çµæœã‚’ <code>isNaN()</code> ã§ãƒã‚§ãƒƒã‚¯</td>
            </tr>
            <tr>
                <td>æ—¥ä»˜ãŒãšã‚Œã‚‹</td>
                <td>ã‚¿ã‚¤ãƒ ã‚¾ãƒ¼ãƒ³ã®å•é¡Œ</td>
                <td><code>toISOString()</code> ã§UTCã€<code>toLocaleString()</code> ã§ãƒ­ãƒ¼ã‚«ãƒ«</td>
            </tr>
            <tr>
                <td>0ãŒãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ã«ãªã‚‹</td>
                <td><code>||</code> ã§0ãŒfalsyã¨ã—ã¦æ‰±ã‚ã‚Œã‚‹</td>
                <td><code>??</code>ï¼ˆNullåˆä½“æ¼”ç®—å­ï¼‰ã‚’ä½¿ç”¨</td>
            </tr>
        </table>
        
        <h2>ğŸ”— 12. è¿½åŠ ãƒªã‚½ãƒ¼ã‚¹</h2>
        
        <ul>
            <li><a href="https://developer.mozilla.org/ja/docs/Web/JavaScript/Reference/Global_Objects/Array" target="_blank">MDN: é…åˆ—ãƒ¡ã‚½ãƒƒãƒ‰ä¸€è¦§</a></li>
            <li><a href="https://developer.mozilla.org/ja/docs/Web/JavaScript/Reference/Global_Objects/String" target="_blank">MDN: æ–‡å­—åˆ—ãƒ¡ã‚½ãƒƒãƒ‰ä¸€è¦§</a></li>
            <li><a href="https://developer.mozilla.org/ja/docs/Web/JavaScript/Reference/Global_Objects/Object" target="_blank">MDN: Objectãƒ¡ã‚½ãƒƒãƒ‰ä¸€è¦§</a></li>
            <li><a href="https://nodered.org/docs/user-guide/writing-functions" target="_blank">Node-RED: Functionãƒãƒ¼ãƒ‰ã®æ›¸ãæ–¹</a></li>
            <li><a href="https://jsprimer.net/" target="_blank">JavaScript Primerï¼ˆæ—¥æœ¬èªï¼‰</a></li>
        </ul>
        
        <hr>
        
        <p style="text-align: center; color: #999; margin-top: 40px;">
            <small>ã“ã®ã‚¬ã‚¤ãƒ‰ãŒå½¹ã«ç«‹ã¡ã¾ã—ãŸã‚‰ã€å®Ÿéš›ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã§ç·´ç¿’ã—ã¦ã¿ã¦ãã ã•ã„!<br>
            ã“ã‚Œã‚‰ã®ãƒ¡ã‚½ãƒƒãƒ‰ã‚’ä½¿ã„ã“ãªã›ã°ã€Functionãƒãƒ¼ãƒ‰ã§ã®å‡¦ç†ãŒæ ¼æ®µã«æ¥½ã«ãªã‚Šã¾ã™ã€‚</small>
        </p>
    </div>
    
    <script>
        // ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿æ™‚ã«ã‚³ãƒ”ãƒ¼ãƒœã‚¿ãƒ³ã‚’è¿½åŠ 
        document.addEventListener('DOMContentLoaded', function() {
            var codeBlocks = document.querySelectorAll('.flow-json, .js-code[data-copy="true"]');
            
            codeBlocks.forEach(function(block) {
                var button = document.createElement('button');
                button.className = 'copy-button';
                button.innerHTML = '<svg viewBox="0 0 24 24"><path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"/></svg>ã‚³ãƒ”ãƒ¼';
                
                button.addEventListener('click', function() {
                    var code = block.textContent.replace(/ã‚³ãƒ”ãƒ¼(ã—ã¾ã—ãŸ!)?$/, '').trim();
                    
                    if (block.classList.contains('js-code')) {
                        code = block.innerText.replace(/ã‚³ãƒ”ãƒ¼(ã—ã¾ã—ãŸ!)?$/, '').trim();
                    }
                    
                    navigator.clipboard.writeText(code).then(function() {
                        button.innerHTML = '<svg viewBox="0 0 24 24"><path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"/></svg>ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸ!';
                        button.classList.add('copied');
                        
                        setTimeout(function() {
                            button.innerHTML = '<svg viewBox="0 0 24 24"><path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"/></svg>ã‚³ãƒ”ãƒ¼';
                            button.classList.remove('copied');
                        }, 2000);
                    }).catch(function(err) {
                        console.error('ã‚³ãƒ”ãƒ¼ã«å¤±æ•—ã—ã¾ã—ãŸ:', err);
                    });
                });
                
                block.style.position = 'relative';
                block.appendChild(button);
            });
        });
    </script>
</body>
</html>
