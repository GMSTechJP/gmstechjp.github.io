<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Node-RED WebSocket ãƒãƒ¼ãƒ‰ã‚¬ã‚¤ãƒ‰</title>
    <style>
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; line-height: 1.8; max-width: 1000px; margin: 0 auto; padding: 20px; background-color: #f5f5f5; color: #333; }
        h1 { color: #b92d5d; border-bottom: 3px solid #b92d5d; padding-bottom: 10px; }
        h2 { color: #d33682; margin-top: 40px; border-left: 5px solid #d33682; padding-left: 15px; }
        h3 { color: #555; margin-top: 25px; }
        h4 { color: #666; margin-top: 20px; }
        .container { background-color: white; padding: 30px; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); margin-bottom: 20px; }
        .node-example { background-color: #2d3133; padding: 20px; border-radius: 5px; margin: 20px 0; color: white; font-family: 'Courier New', monospace; display: flex; align-items: center; flex-wrap: wrap; gap: 5px; }
        .node { display: inline-block; padding: 8px 15px; border-radius: 4px; margin: 5px; font-weight: bold; font-size: 14px; }
        .node-inject { background-color: #3fadb5; color: white; }
        .node-debug { background-color: #87a48d; color: white; }
        .node-function { background-color: #e8a658; color: white; }
        .node-change { background-color: #e7a070; color: white; }
        .node-switch { background-color: #e2d96e; color: #333; }
        .node-websocket-in { background-color: #c9b6d5; color: #333; }
        .node-websocket-out { background-color: #c9b6d5; color: #333; }
        .node-catch { background-color: #e8967a; color: white; }
        .arrow { color: #999; font-size: 20px; margin: 0 10px; }
        .arrow-double { color: #4caf50; font-size: 20px; margin: 0 10px; }
        .important { background-color: #fce4ec; border-left: 4px solid #b92d5d; padding: 15px; margin: 20px 0; border-radius: 0 5px 5px 0; }
        .tip { background-color: #e8f5e9; border-left: 4px solid #4caf50; padding: 15px; margin: 20px 0; border-radius: 0 5px 5px 0; }
        .warning { background-color: #fff3e0; border-left: 4px solid #ff9800; padding: 15px; margin: 20px 0; border-radius: 0 5px 5px 0; }
        .code-block { background-color: #2d3133; color: #f8f8f2; padding: 15px; border-radius: 5px; margin: 15px 0; overflow-x: auto; font-family: 'Courier New', Consolas, monospace; font-size: 14px; white-space: pre; }
        .flow-json { background-color: #1a1a2e; color: #a6e22e; padding: 15px; border-radius: 5px; font-family: 'Courier New', Consolas, monospace; font-size: 12px; overflow-x: auto; white-space: pre; position: relative; max-height: 400px; overflow-y: auto; }
        table { width: 100%; border-collapse: collapse; margin: 20px 0; }
        th, td { border: 1px solid #ddd; padding: 12px; text-align: left; }
        th { background-color: #b92d5d; color: white; }
        tr:nth-child(even) { background-color: #f9f9f9; }
        .exercise { background-color: #e3f2fd; padding: 20px; border-radius: 8px; margin: 20px 0; border: 2px solid #2196f3; }
        .exercise h3 { color: #1976d2; margin-top: 0; }
        .difficulty { display: inline-block; padding: 3px 10px; border-radius: 12px; font-size: 12px; font-weight: bold; margin-left: 10px; }
        .difficulty-easy { background-color: #c8e6c9; color: #2e7d32; }
        .difficulty-medium { background-color: #fff9c4; color: #f57f17; }
        .difficulty-hard { background-color: #ffcdd2; color: #c62828; }
        details { background-color: #f5f5f5; padding: 10px 15px; border-radius: 5px; margin: 10px 0; }
        details summary { cursor: pointer; font-weight: bold; color: #1976d2; }
        details[open] summary { margin-bottom: 10px; }
        .toc { background-color: #fafafa; border: 1px solid #ddd; border-radius: 8px; padding: 20px; margin: 20px 0; }
        .toc h3 { margin-top: 0; color: #b92d5d; }
        .toc ul { list-style: none; padding-left: 0; }
        .toc li { padding: 5px 0; }
        .toc a { color: #1976d2; text-decoration: none; }
        .toc a:hover { text-decoration: underline; }
        .copy-btn { position: absolute; top: 5px; right: 5px; background-color: #666; color: white; border: none; padding: 5px 10px; border-radius: 3px; cursor: pointer; font-size: 12px; }
        .copy-btn:hover { background-color: #888; }
        .node-compare { display: flex; gap: 20px; flex-wrap: wrap; margin: 20px 0; }
        .node-card { background: #f9f9f9; border: 1px solid #ddd; border-radius: 8px; padding: 15px; flex: 1; min-width: 280px; }
        .node-card h4 { margin-top: 0; color: #b92d5d; }
        .compare-box { display: flex; gap: 20px; flex-wrap: wrap; margin: 20px 0; }
        .compare-item { flex: 1; min-width: 200px; background: #f9f9f9; padding: 15px; border-radius: 8px; border: 2px solid #ddd; }
        .compare-item h4 { margin-top: 0; }
        .compare-item.http { border-color: #2196f3; }
        .compare-item.websocket { border-color: #4caf50; }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ”Œ Node-RED WebSocket ãƒãƒ¼ãƒ‰å®Œå…¨ã‚¬ã‚¤ãƒ‰</h1>
        
        <div class="toc">
            <h3>ğŸ“š ç›®æ¬¡</h3>
            <ul>
                <li><a href="#section1">1. æ¦‚è¦</a></li>
                <li><a href="#section2">2. WebSocketè¨­å®šãƒãƒ¼ãƒ‰</a></li>
                <li><a href="#section3">3. WebSocket In / Out ãƒãƒ¼ãƒ‰</a></li>
                <li><a href="#section4">4. å®Ÿç”¨çš„ãªä½¿ç”¨ãƒ‘ã‚¿ãƒ¼ãƒ³</a></li>                <li><a href="#section5">5. æ¼”ç¿’å•é¡Œ</a></li>
                <li><a href="#section6">6. ã¾ã¨ã‚</a></li>
                <li><a href="#section7">7. ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°</a></li>
                <li><a href="#section8">8. å®Ÿå‹™æ´»ç”¨ä¾‹</a></li>
            </ul>
        </div>
        
        <h2 id="section1">ğŸ“– 1. æ¦‚è¦</h2>
        
        <p>WebSocket ãƒãƒ¼ãƒ‰ã¯ã€<strong>åŒæ–¹å‘ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ é€šä¿¡</strong>ã‚’å®Ÿç¾ã™ã‚‹ãŸã‚ã®ãƒãƒ¼ãƒ‰ã§ã™ã€‚HTTPã¨ç•°ãªã‚Šã€ä¸€åº¦æ¥ç¶šã‚’ç¢ºç«‹ã™ã‚‹ã¨ã€ã‚µãƒ¼ãƒãƒ¼ã‹ã‚‰ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã¸ãƒ—ãƒƒã‚·ãƒ¥é€ä¿¡ãŒå¯èƒ½ã«ãªã‚Šã¾ã™ã€‚</p>
        
        <h3>HTTP vs WebSocket</h3>
        <div class="compare-box">
            <div class="compare-item http">
                <h4>ğŸ”„ HTTPï¼ˆãƒªã‚¯ã‚¨ã‚¹ãƒˆ-ãƒ¬ã‚¹ãƒãƒ³ã‚¹ï¼‰</h4>
                <p>ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆãŒæ¯å›ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’é€ä¿¡</p>
                <ul>
                    <li>ãƒªã‚¯ã‚¨ã‚¹ãƒˆ â†’ ãƒ¬ã‚¹ãƒãƒ³ã‚¹ â†’ æ¥ç¶šçµ‚äº†</li>
                    <li>ã‚µãƒ¼ãƒãƒ¼ã‹ã‚‰ãƒ—ãƒƒã‚·ãƒ¥ä¸å¯</li>
                    <li>ã‚ªãƒ¼ãƒãƒ¼ãƒ˜ãƒƒãƒ‰ãŒå¤§ãã„</li>
                </ul>
            </div>
            <div class="compare-item websocket">
                <h4>âš¡ WebSocketï¼ˆåŒæ–¹å‘é€šä¿¡ï¼‰</h4>
                <p>ä¸€åº¦æ¥ç¶šã—ãŸã‚‰ç¶­æŒ</p>
                <ul>
                    <li>æ¥ç¶šç¢ºç«‹ â†’ åŒæ–¹å‘é€šä¿¡ â†’ åˆ‡æ–­</li>
                    <li>ã‚µãƒ¼ãƒãƒ¼ã‹ã‚‰ãƒ—ãƒƒã‚·ãƒ¥å¯èƒ½</li>
                    <li>ä½ã‚ªãƒ¼ãƒãƒ¼ãƒ˜ãƒƒãƒ‰</li>
                </ul>
            </div>
        </div>
        
        <p>ğŸ“ <strong>é›»è©±ã«ä¾‹ãˆã‚‹ã¨</strong>ï¼šHTTPã¯ã€Œæ¯å›é›»è©±ã‚’ã‹ã‘ç›´ã™ã€ã€WebSocketã¯ã€Œé›»è©±ã‚’ã¤ãªãã£ã±ãªã—ã«ã—ã¦ãŠãã€ã‚¤ãƒ¡ãƒ¼ã‚¸ã§ã™ã€‚ã¤ãªãã£ã±ãªã—ãªã®ã§ã€ç›¸æ‰‹ã‹ã‚‰ã‚‚è‡ªç”±ã«è©±ã—ã‹ã‘ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚</p>
        
        <div class="node-compare">
            <div class="node-card">
                <h4>ğŸ“¥ WebSocket In</h4>
                <div class="node-example" style="justify-content: center;">
                    <span class="node node-websocket-in">WebSocket In</span>
                </div>
                <p><strong>å½¹å‰²:</strong> WebSocketãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’å—ä¿¡</p>
                <ul>
                    <li>ã‚µãƒ¼ãƒãƒ¼ãƒ¢ãƒ¼ãƒ‰: ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‹ã‚‰ã®æ¥ç¶šå—ä»˜</li>
                    <li>ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆãƒ¢ãƒ¼ãƒ‰: ã‚µãƒ¼ãƒãƒ¼ã¸æ¥ç¶š</li>
                </ul>
            </div>
            
            <div class="node-card">
                <h4>ğŸ“¤ WebSocket Out</h4>
                <div class="node-example" style="justify-content: center;">
                    <span class="node node-websocket-out">WebSocket Out</span>
                </div>
                <p><strong>å½¹å‰²:</strong> WebSocketãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’é€ä¿¡</p>
                <ul>
                    <li>æ¥ç¶šä¸­ã®ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆå…¨å“¡ã«é€ä¿¡</li>
                    <li>ç‰¹å®šã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã«é€ä¿¡</li>
                </ul>
            </div>
        </div>
        
        <h2 id="section2">âš™ï¸ 2. WebSocketè¨­å®šãƒãƒ¼ãƒ‰</h2>
        
        <p>WebSocket In/Out ãƒãƒ¼ãƒ‰ã¯ã€<strong>è¨­å®šãƒãƒ¼ãƒ‰</strong>ï¼ˆWebSocket-listener ã¾ãŸã¯ WebSocket-clientï¼‰ã‚’å…±æœ‰ã—ã¾ã™ã€‚</p>
        
        <h3>ã‚µãƒ¼ãƒãƒ¼ãƒ¢ãƒ¼ãƒ‰ï¼ˆListenï¼‰</h3>
        <p>Node-REDãŒWebSocketã‚µãƒ¼ãƒãƒ¼ã¨ã—ã¦å‹•ä½œã—ã€ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‹ã‚‰ã®æ¥ç¶šã‚’å—ã‘ä»˜ã‘ã¾ã™ã€‚</p>
        <table>
            <tr><th>ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£</th><th>èª¬æ˜</th><th>ä¾‹</th></tr>
            <tr><td><strong>ç¨®é¡</strong></td><td>Listen atï¼ˆã‚µãƒ¼ãƒãƒ¼ï¼‰</td><td>-</td></tr>
            <tr><td><strong>ãƒ‘ã‚¹</strong></td><td>WebSocketã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ</td><td>/ws/chat</td></tr>
            <tr><td><strong>é€å—ä¿¡</strong></td><td>ãƒ‡ãƒ¼ã‚¿å½¢å¼</td><td>entire message / payload</td></tr>
        </table>
        
        <div class="code-block">// ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‹ã‚‰ã®æ¥ç¶šURL
ws://localhost:1880/ws/chat</div>
        
        <h3>ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆãƒ¢ãƒ¼ãƒ‰ï¼ˆConnectï¼‰</h3>
        <p>Node-REDãŒWebSocketã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã¨ã—ã¦ã€å¤–éƒ¨ã‚µãƒ¼ãƒãƒ¼ã«æ¥ç¶šã—ã¾ã™ã€‚</p>
        <table>
            <tr><th>ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£</th><th>èª¬æ˜</th><th>ä¾‹</th></tr>
            <tr><td><strong>ç¨®é¡</strong></td><td>Connect toï¼ˆã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆï¼‰</td><td>-</td></tr>
            <tr><td><strong>URL</strong></td><td>æ¥ç¶šå…ˆWebSocketã‚µãƒ¼ãƒãƒ¼</td><td>ws://example.com/socket</td></tr>
            <tr><td><strong>ãƒãƒ¼ãƒˆãƒ“ãƒ¼ãƒˆé€ä¿¡</strong></td><td>ã‚­ãƒ¼ãƒ—ã‚¢ãƒ©ã‚¤ãƒ–é€ä¿¡</td><td>25ç§’ã”ã¨</td></tr>
        </table>
        
        <h3>Send/Receive ã‚ªãƒ—ã‚·ãƒ§ãƒ³</h3>
        <table>
            <tr><th>ã‚ªãƒ—ã‚·ãƒ§ãƒ³</th><th>èª¬æ˜</th><th>ç”¨é€”</th></tr>
            <tr><td><strong>entire message</strong></td><td>msgå…¨ä½“ã‚’JSONåŒ–ã—ã¦é€å—ä¿¡</td><td>Node-REDé–“é€šä¿¡</td></tr>
            <tr><td><strong>payload only</strong></td><td>msg.payloadã®ã¿é€å—ä¿¡</td><td>ä¸€èˆ¬çš„ãªWebSocketé€šä¿¡</td></tr>
        </table>
        
        <h2 id="section3">âš™ï¸ 3. WebSocket In / Out ãƒãƒ¼ãƒ‰</h2>
        
        <h3>WebSocket In ãƒãƒ¼ãƒ‰</h3>
        <p>å—ä¿¡æ™‚ã«è¨­å®šã•ã‚Œã‚‹ msg ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ï¼š</p>
        <table>
            <tr><th>ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£</th><th>èª¬æ˜</th></tr>
            <tr><td><strong>msg.payload</strong></td><td>å—ä¿¡ãƒ‡ãƒ¼ã‚¿</td></tr>
            <tr><td><strong>msg._session</strong></td><td>ã‚»ãƒƒã‚·ãƒ§ãƒ³IDï¼ˆã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆè­˜åˆ¥ç”¨ï¼‰</td></tr>
        </table>
        
        <h3>WebSocket Out ãƒãƒ¼ãƒ‰</h3>
        <p>é€ä¿¡æ™‚ã«ä½¿ç”¨ã§ãã‚‹ msg ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ï¼š</p>
        <table>
            <tr><th>ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£</th><th>èª¬æ˜</th></tr>
            <tr><td><strong>msg.payload</strong></td><td>é€ä¿¡ãƒ‡ãƒ¼ã‚¿</td></tr>
            <tr><td><strong>msg._session</strong></td><td>ç‰¹å®šã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã«é€ä¿¡ï¼ˆçœç•¥æ™‚ã¯å…¨å“¡ï¼‰</td></tr>
        </table>
        
        <div class="tip">
            <p><strong>ğŸ’¡ ãƒã‚¤ãƒ³ãƒˆ:</strong></p>
            <ul>
                <li><code>msg._session</code> ã‚’æŒ‡å®šã™ã‚‹ã¨ç‰¹å®šã®ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã®ã¿ã«é€ä¿¡</li>
                <li><code>msg._session</code> ã‚’å‰Šé™¤ã™ã‚‹ã¨å…¨ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã«ãƒ–ãƒ­ãƒ¼ãƒ‰ã‚­ãƒ£ã‚¹ãƒˆ</li>
                <li>WebSocket In ã§å—ã‘å–ã£ãŸ msg ã‚’ãã®ã¾ã¾ WebSocket Out ã«æ¸¡ã™ã¨ã€é€ä¿¡å…ƒã«è¿”ä¿¡</li>
            </ul>
        </div>
        
        <h2 id="section4">ğŸ”§ 4. å®Ÿç”¨çš„ãªä½¿ç”¨ãƒ‘ã‚¿ãƒ¼ãƒ³</h2>
        <div class="important">
            <p><strong>ğŸ“¥ ã‚µãƒ³ãƒ—ãƒ«ãƒ•ãƒ­ãƒ¼ã®ã‚¤ãƒ³ãƒãƒ¼ãƒˆæ–¹æ³•:</strong></p>
            <ol>
                <li>ä¸‹ã®ã‚µãƒ³ãƒ—ãƒ«ãƒ•ãƒ­ãƒ¼JSONã‚’ã‚³ãƒ”ãƒ¼</li>
                <li>Node-REDã‚¨ãƒ‡ã‚£ã‚¿ã§ <strong>ãƒ¡ãƒ‹ãƒ¥ãƒ¼ â†’ èª­ã¿è¾¼ã¿</strong> ã‚’é¸æŠ</li>
                <li>JSONã‚’ãƒšãƒ¼ã‚¹ãƒˆã—ã¦ã€Œèª­ã¿è¾¼ã¿ã€ã‚’ã‚¯ãƒªãƒƒã‚¯</li>
            </ol>
            <p>ã“ã®ã‚µãƒ³ãƒ—ãƒ«ãƒ•ãƒ­ãƒ¼ã«ã¯ã€ä»¥ä¸‹ã§èª¬æ˜ã™ã‚‹ãƒ‘ã‚¿ãƒ¼ãƒ³ã®å®Ÿä¾‹ãŒå«ã¾ã‚Œã¦ã„ã¾ã™ã€‚</p>
        </div>

        
        <div class="warning">
            <p><strong>âš ï¸ ãƒ†ã‚¹ãƒˆæ–¹æ³•:</strong></p>
            <p>WebSocketã®ãƒ†ã‚¹ãƒˆã«ã¯ä»¥ä¸‹ã®ãƒ„ãƒ¼ãƒ«ãŒä¾¿åˆ©ã§ã™ï¼š</p>
            <ul>
                <li><strong>ãƒ–ãƒ©ã‚¦ã‚¶ã®é–‹ç™ºè€…ãƒ„ãƒ¼ãƒ«:</strong> Console ã‹ã‚‰ JavaScript ã§æ¥ç¶šãƒ†ã‚¹ãƒˆ</li>
                <li><strong>wscat:</strong> ã‚³ãƒãƒ³ãƒ‰ãƒ©ã‚¤ãƒ³ãƒ„ãƒ¼ãƒ«ï¼ˆ<code>npm install -g wscat</code>ï¼‰</li>
                <li><strong>Postman:</strong> WebSocketæ©Ÿèƒ½ã§ãƒ†ã‚¹ãƒˆ</li>
                <li><strong>Simple WebSocket Client:</strong> ãƒ–ãƒ©ã‚¦ã‚¶æ‹¡å¼µæ©Ÿèƒ½</li>
            </ul>
        </div>
        
        <h3>ãƒ–ãƒ©ã‚¦ã‚¶ã§ã®ãƒ†ã‚¹ãƒˆæ–¹æ³•</h3>
        <div class="code-block">// ãƒ–ãƒ©ã‚¦ã‚¶ã®é–‹ç™ºè€…ãƒ„ãƒ¼ãƒ« (Console) ã§å®Ÿè¡Œ
var ws = new WebSocket("ws://localhost:1880/ws/echo");

ws.onopen = function() {
    console.log("æ¥ç¶šæˆåŠŸ!");
    ws.send("Hello WebSocket!");
};

ws.onmessage = function(event) {
    console.log("å—ä¿¡:", event.data);
};

ws.onclose = function() {
    console.log("åˆ‡æ–­");
};

// ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸é€ä¿¡
ws.send("ãƒ†ã‚¹ãƒˆãƒ¡ãƒƒã‚»ãƒ¼ã‚¸");</div>
        
        <details>
            <summary>ğŸ“¥ ã‚µãƒ³ãƒ—ãƒ«ãƒ•ãƒ­ãƒ¼JSONï¼ˆã‚¯ãƒªãƒƒã‚¯ã§å±•é–‹ï¼‰</summary>
            <div class="flow-json">[
    {
        "id": "ws_sample_tab",
        "type": "tab",
        "label": "WebSocket ã‚µãƒ³ãƒ—ãƒ«",
        "disabled": false,
        "info": ""
    },
    {
        "id": "ws_listener_echo",
        "type": "websocket-listener",
        "path": "/ws/echo",
        "wholemsg": "false"
    },
    {
        "id": "ws_listener_chat",
        "type": "websocket-listener",
        "path": "/ws/chat",
        "wholemsg": "false"
    },
    {
        "id": "ws_comment1",
        "type": "comment",
        "z": "ws_sample_tab",
        "name": "â”â”â” ã‚¨ã‚³ãƒ¼ã‚µãƒ¼ãƒãƒ¼ï¼ˆå—ä¿¡â†’è¿”ä¿¡ï¼‰ â”â”â”",
        "info": "ws://localhost:1880/ws/echo",
        "x": 220,
        "y": 40,
        "wires": []
    },
    {
        "id": "ws_in_echo",
        "type": "websocket in",
        "z": "ws_sample_tab",
        "name": "WS Echo In",
        "server": "ws_listener_echo",
        "client": "",
        "x": 150,
        "y": 100,
        "wires": [["ws_func_echo", "ws_debug1"]]
    },
    {
        "id": "ws_func_echo",
        "type": "function",
        "z": "ws_sample_tab",
        "name": "ã‚¨ã‚³ãƒ¼å‡¦ç†",
        "func": "// å—ä¿¡ãƒ‡ãƒ¼ã‚¿ã«æ™‚åˆ»ã‚’è¿½åŠ ã—ã¦è¿”ä¿¡\nvar received = msg.payload;\n\nmsg.payload = {\n    type: \"echo\",\n    original: received,\n    timestamp: new Date().toISOString(),\n    message: \"ã‚ãªãŸã¯ã€Œ\" + received + \"ã€ã¨è¨€ã„ã¾ã—ãŸ\"\n};\n\n// JSONæ–‡å­—åˆ—ã«å¤‰æ›\nmsg.payload = JSON.stringify(msg.payload);\n\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 350,
        "y": 100,
        "wires": [["ws_out_echo"]]
    },
    {
        "id": "ws_out_echo",
        "type": "websocket out",
        "z": "ws_sample_tab",
        "name": "WS Echo Out",
        "server": "ws_listener_echo",
        "client": "",
        "x": 550,
        "y": 100,
        "wires": []
    },
    {
        "id": "ws_debug1",
        "type": "debug",
        "z": "ws_sample_tab",
        "name": "å—ä¿¡ãƒ­ã‚°",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": true,
        "complete": "payload",
        "targetType": "msg",
        "statusVal": "\"å—ä¿¡\"",
        "statusType": "str",
        "x": 350,
        "y": 140,
        "wires": []
    },
    {
        "id": "ws_comment2",
        "type": "comment",
        "z": "ws_sample_tab",
        "name": "â”â”â” ãƒ–ãƒ­ãƒ¼ãƒ‰ã‚­ãƒ£ã‚¹ãƒˆï¼ˆå…¨å“¡ã«é…ä¿¡ï¼‰ â”â”â”",
        "info": "ws://localhost:1880/ws/chat",
        "x": 220,
        "y": 220,
        "wires": []
    },
    {
        "id": "ws_in_chat",
        "type": "websocket in",
        "z": "ws_sample_tab",
        "name": "WS Chat In",
        "server": "ws_listener_chat",
        "client": "",
        "x": 150,
        "y": 280,
        "wires": [["ws_func_chat", "ws_debug2"]]
    },
    {
        "id": "ws_func_chat",
        "type": "function",
        "z": "ws_sample_tab",
        "name": "ãƒãƒ£ãƒƒãƒˆå‡¦ç†",
        "func": "// é€ä¿¡è€…ã®ã‚»ãƒƒã‚·ãƒ§ãƒ³IDã‚’ä¿å­˜\nvar senderSession = msg._session;\n\ntry {\n    var data = JSON.parse(msg.payload);\n} catch(e) {\n    var data = {name: \"åŒ¿å\", message: msg.payload};\n}\n\n// ãƒ–ãƒ­ãƒ¼ãƒ‰ã‚­ãƒ£ã‚¹ãƒˆç”¨ã«ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’æ•´å½¢\nmsg.payload = JSON.stringify({\n    type: \"chat\",\n    name: data.name || \"åŒ¿å\",\n    message: data.message || data,\n    timestamp: new Date().toISOString()\n});\n\n// _sessionã‚’å‰Šé™¤ã—ã¦å…¨å“¡ã«é€ä¿¡\ndelete msg._session;\n\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 350,
        "y": 280,
        "wires": [["ws_out_chat"]]
    },
    {
        "id": "ws_out_chat",
        "type": "websocket out",
        "z": "ws_sample_tab",
        "name": "WS Chat Out (å…¨å“¡)",
        "server": "ws_listener_chat",
        "client": "",
        "x": 580,
        "y": 280,
        "wires": []
    },
    {
        "id": "ws_debug2",
        "type": "debug",
        "z": "ws_sample_tab",
        "name": "ãƒãƒ£ãƒƒãƒˆãƒ­ã‚°",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": true,
        "complete": "payload",
        "targetType": "msg",
        "statusVal": "\"ãƒãƒ£ãƒƒãƒˆå—ä¿¡\"",
        "statusType": "str",
        "x": 370,
        "y": 320,
        "wires": []
    },
    {
        "id": "ws_comment3",
        "type": "comment",
        "z": "ws_sample_tab",
        "name": "â”â”â” ã‚µãƒ¼ãƒãƒ¼ã‹ã‚‰ã®ãƒ—ãƒƒã‚·ãƒ¥é…ä¿¡ â”â”â”",
        "info": "",
        "x": 210,
        "y": 400,
        "wires": []
    },
    {
        "id": "ws_inject_push",
        "type": "inject",
        "z": "ws_sample_tab",
        "name": "ãƒ—ãƒƒã‚·ãƒ¥é€ä¿¡",
        "props": [{"p": "payload"}],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "{\"type\":\"notification\",\"message\":\"ã‚µãƒ¼ãƒãƒ¼ã‹ã‚‰ã®ãŠçŸ¥ã‚‰ã›ã§ã™\"}",
        "payloadType": "json",
        "x": 160,
        "y": 460,
        "wires": [["ws_func_push"]]
    },
    {
        "id": "ws_inject_timer",
        "type": "inject",
        "z": "ws_sample_tab",
        "name": "5ç§’ã”ã¨ã«æ™‚åˆ»é…ä¿¡",
        "props": [{"p": "payload"}],
        "repeat": "5",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 180,
        "y": 520,
        "wires": [["ws_func_time"]]
    },
    {
        "id": "ws_func_push",
        "type": "function",
        "z": "ws_sample_tab",
        "name": "ãƒ—ãƒƒã‚·ãƒ¥æ•´å½¢",
        "func": "msg.payload = JSON.stringify(msg.payload);\n// _sessionãŒãªã„ã®ã§å…¨å“¡ã«é€ä¿¡\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 370,
        "y": 460,
        "wires": [["ws_out_chat"]]
    },
    {
        "id": "ws_func_time",
        "type": "function",
        "z": "ws_sample_tab",
        "name": "æ™‚åˆ»æ•´å½¢",
        "func": "msg.payload = JSON.stringify({\n    type: \"time\",\n    serverTime: new Date().toISOString()\n});\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 360,
        "y": 520,
        "wires": [["ws_out_chat"]]
    },
    {
        "id": "ws_comment4",
        "type": "comment",
        "z": "ws_sample_tab",
        "name": "â”â”â” ãƒ–ãƒ©ã‚¦ã‚¶ãƒ†ã‚¹ãƒˆç”¨HTMLãƒšãƒ¼ã‚¸ â”â”â”",
        "info": "http://localhost:1880/ws-test",
        "x": 220,
        "y": 600,
        "wires": []
    },
    {
        "id": "ws_http_in_test",
        "type": "http in",
        "z": "ws_sample_tab",
        "name": "GET /ws-test",
        "url": "/ws-test",
        "method": "get",
        "upload": false,
        "swaggerDoc": "",
        "x": 160,
        "y": 660,
        "wires": [["ws_template_test"]]
    },
    {
        "id": "ws_template_test",
        "type": "template",
        "z": "ws_sample_tab",
        "name": "ãƒ†ã‚¹ãƒˆãƒšãƒ¼ã‚¸HTML",
        "field": "payload",
        "fieldType": "msg",
        "format": "html",
        "syntax": "plain",
        "template": "<!DOCTYPE html>\n<html>\n<head>\n    <meta charset=\"UTF-8\">\n    <title>WebSocket ãƒ†ã‚¹ãƒˆ</title>\n    <style>\n        body { font-family: Arial, sans-serif; padding: 20px; background: #f0f0f0; }\n        .container { max-width: 600px; margin: 0 auto; background: white; padding: 20px; border-radius: 10px; }\n        h1 { color: #b92d5d; }\n        .status { padding: 10px; border-radius: 5px; margin: 10px 0; }\n        .connected { background: #c8e6c9; color: #2e7d32; }\n        .disconnected { background: #ffcdd2; color: #c62828; }\n        #messages { height: 200px; overflow-y: auto; border: 1px solid #ddd; padding: 10px; margin: 10px 0; background: #fafafa; }\n        .message { padding: 5px; border-bottom: 1px solid #eee; }\n        input, button { padding: 10px; margin: 5px 0; }\n        input { width: 70%; }\n        button { background: #b92d5d; color: white; border: none; cursor: pointer; border-radius: 5px; }\n        button:hover { background: #8e2347; }\n    </style>\n</head>\n<body>\n    <div class=\"container\">\n        <h1>ğŸ”Œ WebSocket ãƒ†ã‚¹ãƒˆ</h1>\n        \n        <div id=\"status\" class=\"status disconnected\">åˆ‡æ–­ä¸­</div>\n        \n        <div>\n            <button onclick=\"connectEcho()\">Echoã‚µãƒ¼ãƒãƒ¼ã«æ¥ç¶š</button>\n            <button onclick=\"connectChat()\">Chatã‚µãƒ¼ãƒãƒ¼ã«æ¥ç¶š</button>\n            <button onclick=\"disconnect()\">åˆ‡æ–­</button>\n        </div>\n        \n        <div id=\"messages\"></div>\n        \n        <div>\n            <input type=\"text\" id=\"messageInput\" placeholder=\"ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’å…¥åŠ›...\">\n            <button onclick=\"sendMessage()\">é€ä¿¡</button>\n        </div>\n    </div>\n    \n    <script>\n        var ws = null;\n        \n        function connectEcho() {\n            connect('ws://' + location.host + '/ws/echo');\n        }\n        \n        function connectChat() {\n            connect('ws://' + location.host + '/ws/chat');\n        }\n        \n        function connect(url) {\n            if (ws) ws.close();\n            \n            ws = new WebSocket(url);\n            \n            ws.onopen = function() {\n                document.getElementById('status').className = 'status connected';\n                document.getElementById('status').textContent = 'æ¥ç¶šä¸­: ' + url;\n                addMessage('ã‚·ã‚¹ãƒ†ãƒ ', 'æ¥ç¶šã—ã¾ã—ãŸ');\n            };\n            \n            ws.onmessage = function(event) {\n                try {\n                    var data = JSON.parse(event.data);\n                    addMessage('å—ä¿¡', JSON.stringify(data, null, 2));\n                } catch(e) {\n                    addMessage('å—ä¿¡', event.data);\n                }\n            };\n            \n            ws.onclose = function() {\n                document.getElementById('status').className = 'status disconnected';\n                document.getElementById('status').textContent = 'åˆ‡æ–­ä¸­';\n                addMessage('ã‚·ã‚¹ãƒ†ãƒ ', 'åˆ‡æ–­ã—ã¾ã—ãŸ');\n            };\n            \n            ws.onerror = function(error) {\n                addMessage('ã‚¨ãƒ©ãƒ¼', 'WebSocket ã‚¨ãƒ©ãƒ¼');\n            };\n        }\n        \n        function disconnect() {\n            if (ws) ws.close();\n        }\n        \n        function sendMessage() {\n            var input = document.getElementById('messageInput');\n            if (ws && ws.readyState === WebSocket.OPEN && input.value) {\n                ws.send(input.value);\n                addMessage('é€ä¿¡', input.value);\n                input.value = '';\n            }\n        }\n        \n        function addMessage(type, text) {\n            var messages = document.getElementById('messages');\n            var div = document.createElement('div');\n            div.className = 'message';\n            div.innerHTML = '<strong>' + type + ':</strong> <pre style=\"margin:0;white-space:pre-wrap;\">' + text + '</pre>';\n            messages.appendChild(div);\n            messages.scrollTop = messages.scrollHeight;\n        }\n        \n        document.getElementById('messageInput').addEventListener('keypress', function(e) {\n            if (e.key === 'Enter') sendMessage();\n        });\n    </script>\n</body>\n</html>",
        "output": "str",
        "x": 390,
        "y": 660,
        "wires": [["ws_http_response_test"]]
    },
    {
        "id": "ws_http_response_test",
        "type": "http response",
        "z": "ws_sample_tab",
        "name": "Response",
        "statusCode": "200",
        "headers": {"Content-Type": "text/html; charset=utf-8"},
        "x": 600,
        "y": 660,
        "wires": []
    }
]</div>
        </details>
        
        
        <h3>ä½¿ç”¨ãƒ‘ã‚¿ãƒ¼ãƒ³</h3>
        
        <h3>ãƒ‘ã‚¿ãƒ¼ãƒ³1: ã‚¨ã‚³ãƒ¼ã‚µãƒ¼ãƒãƒ¼ï¼ˆå—ä¿¡â†’è¿”ä¿¡ï¼‰</h3>
        <p>ã‚µãƒ³ãƒ—ãƒ«ãƒ•ãƒ­ãƒ¼ã®ã€Œã‚¨ã‚³ãƒ¼ã‚µãƒ¼ãƒãƒ¼ï¼ˆå—ä¿¡â†’è¿”ä¿¡ï¼‰ã€ã‚’å‚ç…§ã—ã¦ãã ã•ã„ã€‚</p>
        <div class="node-example">
            <span class="node node-websocket-in">WS In</span>
            <span class="arrow">â†’</span>
            <span class="node node-function">å‡¦ç†</span>
            <span class="arrow">â†’</span>
            <span class="node node-websocket-out">WS Out</span>
        </div>
        <p><strong>ãƒã‚¤ãƒ³ãƒˆ:</strong></p>
        <ul>
            <li>msg._session ãŒä¿æŒã•ã‚Œã¦ã„ã‚‹ã¨ã€é€ä¿¡å…ƒã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã«ã®ã¿è¿”ä¿¡</li>
            <li>å—ä¿¡ã—ãŸãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’åŠ å·¥ã—ã¦è¿”ä¿¡å¯èƒ½</li>
        </ul>
        
        <h3>ãƒ‘ã‚¿ãƒ¼ãƒ³2: ãƒ–ãƒ­ãƒ¼ãƒ‰ã‚­ãƒ£ã‚¹ãƒˆï¼ˆå…¨å“¡ã«é…ä¿¡ï¼‰</h3>
        <p>ã‚µãƒ³ãƒ—ãƒ«ãƒ•ãƒ­ãƒ¼ã®ã€Œãƒ–ãƒ­ãƒ¼ãƒ‰ã‚­ãƒ£ã‚¹ãƒˆï¼ˆå…¨å“¡ã«é…ä¿¡ï¼‰ã€ã‚’å‚ç…§ã—ã¦ãã ã•ã„ã€‚</p>
        <div class="node-example">
            <span class="node node-inject">ãƒ‡ãƒ¼ã‚¿ç”Ÿæˆ</span>
            <span class="arrow">â†’</span>
            <span class="node node-change">_sessionå‰Šé™¤</span>
            <span class="arrow">â†’</span>
            <span class="node node-websocket-out">WS Out</span>
        </div>
        <p><strong>ãƒã‚¤ãƒ³ãƒˆ:</strong></p>
        <ul>
            <li>msg._session ã‚’å‰Šé™¤ã™ã‚‹ã¨ã€æ¥ç¶šä¸­ã®å…¨ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã«é€ä¿¡</li>
            <li>ã‚»ãƒ³ã‚µãƒ¼ãƒ‡ãƒ¼ã‚¿ãªã©ã®ãƒ—ãƒƒã‚·ãƒ¥é…ä¿¡ã«æœ€é©</li>
        </ul>
        
        <h3>ãƒ‘ã‚¿ãƒ¼ãƒ³3: ã‚µãƒ¼ãƒãƒ¼ã‹ã‚‰ã®ãƒ—ãƒƒã‚·ãƒ¥é…ä¿¡</h3>
        <p>ã‚µãƒ³ãƒ—ãƒ«ãƒ•ãƒ­ãƒ¼ã®ã€Œã‚µãƒ¼ãƒãƒ¼ã‹ã‚‰ã®ãƒ—ãƒƒã‚·ãƒ¥é…ä¿¡ã€ã‚’å‚ç…§ã—ã¦ãã ã•ã„ã€‚</p>
        <div class="node-example">
            <span class="node node-inject">å®šæœŸå®Ÿè¡Œ</span>
            <span class="arrow">â†’</span>
            <span class="node node-function">ãƒ‡ãƒ¼ã‚¿ç”Ÿæˆ</span>
            <span class="arrow">â†’</span>
            <span class="node node-websocket-out">å…¨å“¡ã«é…ä¿¡</span>
        </div>
        <p><strong>ãƒã‚¤ãƒ³ãƒˆ:</strong></p>
        <ul>
            <li>Injectãƒãƒ¼ãƒ‰ã®repeatè¨­å®šã§å®šæœŸçš„ã«ãƒ‡ãƒ¼ã‚¿ã‚’é…ä¿¡</li>
            <li>ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ãƒ¢ãƒ‹ã‚¿ãƒªãƒ³ã‚°ã‚„ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰æ›´æ–°ã«æ´»ç”¨</li>
        </ul>
        
        <h3>ãƒ‘ã‚¿ãƒ¼ãƒ³4: ãƒ–ãƒ©ã‚¦ã‚¶ãƒ†ã‚¹ãƒˆç”¨HTMLãƒšãƒ¼ã‚¸</h3>
        <p>ã‚µãƒ³ãƒ—ãƒ«ãƒ•ãƒ­ãƒ¼ã®ã€Œãƒ–ãƒ©ã‚¦ã‚¶ãƒ†ã‚¹ãƒˆç”¨HTMLãƒšãƒ¼ã‚¸ã€ã‚’å‚ç…§ã—ã¦ãã ã•ã„ã€‚</p>
        <div class="node-example">
            <span class="node node-http-in">HTTP In</span>
            <span class="arrow">â†’</span>
            <span class="node node-template">ãƒ†ã‚¹ãƒˆHTML</span>
            <span class="arrow">â†’</span>
            <span class="node node-http-response">HTTP Response</span>
        </div>
        <p><strong>ãƒã‚¤ãƒ³ãƒˆ:</strong></p>
        <ul>
            <li>WebSocketæ¥ç¶šã‚’ãƒ†ã‚¹ãƒˆã™ã‚‹ãŸã‚ã®HTMLãƒšãƒ¼ã‚¸ã‚’æä¾›</li>
            <li>ãƒ–ãƒ©ã‚¦ã‚¶ã‹ã‚‰ /ws-test ã«ã‚¢ã‚¯ã‚»ã‚¹ã—ã¦ãƒ†ã‚¹ãƒˆå¯èƒ½</li>
            <li>JavaScript ã® WebSocket API ã§ã‚µãƒ¼ãƒãƒ¼ã«æ¥ç¶š</li>
        </ul>
        
        <h2 id="section5">ğŸ“ 5. æ¼”ç¿’å•é¡Œ</h2>
        
        <div class="exercise">
            <h3>æ¼”ç¿’1: ã‚·ãƒ³ãƒ—ãƒ«ãªã‚¨ã‚³ãƒ¼ã‚µãƒ¼ãƒãƒ¼ <span class="difficulty difficulty-easy">åˆç´š</span></h3>
            <p><strong>ğŸ“‹ èª²é¡Œ:</strong> å—ä¿¡ã—ãŸãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’ãã®ã¾ã¾é€ä¿¡å…ƒã«è¿”ã™ã‚¨ã‚³ãƒ¼ã‚µãƒ¼ãƒãƒ¼ã‚’ä½œæˆã—ã¦ãã ã•ã„ã€‚</p>
            
            <p><strong>ğŸ¯ è¦æ±‚ä»•æ§˜:</strong></p>
            <ul>
                <li>ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ: <code>/ws/myecho</code></li>
                <li>å—ä¿¡ã—ãŸãƒ‡ãƒ¼ã‚¿ã‚’ãã®ã¾ã¾è¿”ä¿¡</li>
            </ul>
            
            <details>
                <summary>ğŸ’¡ ãƒ’ãƒ³ãƒˆ</summary>
                <p><strong>WebSocket In ãƒãƒ¼ãƒ‰:</strong></p>
                <ul>
                    <li>Type: Listen at</li>
                    <li>Path: /ws/myecho</li>
                </ul>
                <p><strong>WebSocket Out ãƒãƒ¼ãƒ‰:</strong> åŒã˜è¨­å®šãƒãƒ¼ãƒ‰ã‚’é¸æŠ</p>
                <p>WebSocket In ã®å‡ºåŠ›ã‚’ç›´æ¥ WebSocket Out ã«æ¥ç¶šã™ã‚Œã°ã€msg._session ãŒä¿æŒã•ã‚Œã¦é€ä¿¡å…ƒã«è¿”ä¿¡ã•ã‚Œã¾ã™ã€‚</p>
            </details>
            
            <details>
                <summary>âœ… è§£ç­”ä¾‹ãƒ•ãƒ­ãƒ¼</summary>
                <div class="flow-json">[
    {"id": "ex1_tab", "type": "tab", "label": "æ¼”ç¿’1"},
    {"id": "ex1_ws_listener", "type": "websocket-listener", "path": "/ws/myecho", "wholemsg": "false"},
    {"id": "ex1_ws_in", "type": "websocket in", "z": "ex1_tab", "name": "WS In", "server": "ex1_ws_listener", "client": "", "x": 150, "y": 100, "wires": [["ex1_ws_out", "ex1_debug"]]},
    {"id": "ex1_ws_out", "type": "websocket out", "z": "ex1_tab", "name": "WS Out", "server": "ex1_ws_listener", "client": "", "x": 350, "y": 100, "wires": []},
    {"id": "ex1_debug", "type": "debug", "z": "ex1_tab", "name": "ãƒ­ã‚°", "active": true, "tosidebar": true, "console": false, "tostatus": true, "complete": "payload", "targetType": "msg", "statusVal": "\"å—ä¿¡\"", "statusType": "str", "x": 350, "y": 140, "wires": []}
]</div>
            </details>
        </div>
        
        <div class="exercise">
            <h3>æ¼”ç¿’2: æ™‚åˆ»ä»˜ããƒ¬ã‚¹ãƒãƒ³ã‚¹ <span class="difficulty difficulty-easy">åˆç´š</span></h3>
            <p><strong>ğŸ“‹ èª²é¡Œ:</strong> å—ä¿¡ã—ãŸãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã«ç¾åœ¨æ™‚åˆ»ã‚’è¿½åŠ ã—ã¦è¿”ä¿¡ã—ã¦ãã ã•ã„ã€‚</p>
            
            <p><strong>ğŸ¯ è¦æ±‚ä»•æ§˜:</strong></p>
            <ul>
                <li>å—ä¿¡: <code>"ã“ã‚“ã«ã¡ã¯"</code></li>
                <li>è¿”ä¿¡: <code>{"message": "ã“ã‚“ã«ã¡ã¯", "receivedAt": "2024-01-01T12:00:00.000Z"}</code></li>
            </ul>
            
            <details>
                <summary>ğŸ’¡ ãƒ’ãƒ³ãƒˆ</summary>
                <p><strong>Function ãƒãƒ¼ãƒ‰:</strong></p>
                <div class="code-block">msg.payload = JSON.stringify({
    message: msg.payload,
    receivedAt: new Date().toISOString()
});
return msg;</div>
            </details>
            
            <details>
                <summary>âœ… è§£ç­”ä¾‹ãƒ•ãƒ­ãƒ¼</summary>
                <div class="flow-json">[
    {"id": "ex2_tab", "type": "tab", "label": "æ¼”ç¿’2"},
    {"id": "ex2_ws_listener", "type": "websocket-listener", "path": "/ws/time", "wholemsg": "false"},
    {"id": "ex2_ws_in", "type": "websocket in", "z": "ex2_tab", "name": "WS In", "server": "ex2_ws_listener", "client": "", "x": 150, "y": 100, "wires": [["ex2_func"]]},
    {"id": "ex2_func", "type": "function", "z": "ex2_tab", "name": "æ™‚åˆ»è¿½åŠ ", "func": "msg.payload = JSON.stringify({\n    message: msg.payload,\n    receivedAt: new Date().toISOString()\n});\nreturn msg;", "outputs": 1, "timeout": 0, "noerr": 0, "initialize": "", "finalize": "", "libs": [], "x": 320, "y": 100, "wires": [["ex2_ws_out"]]},
    {"id": "ex2_ws_out", "type": "websocket out", "z": "ex2_tab", "name": "WS Out", "server": "ex2_ws_listener", "client": "", "x": 490, "y": 100, "wires": []}
]</div>
            </details>
        </div>
        
        <div class="exercise">
            <h3>æ¼”ç¿’3: ãƒ–ãƒ­ãƒ¼ãƒ‰ã‚­ãƒ£ã‚¹ãƒˆé…ä¿¡ <span class="difficulty difficulty-medium">ä¸­ç´š</span></h3>
            <p><strong>ğŸ“‹ èª²é¡Œ:</strong> Injectãƒãƒ¼ãƒ‰ã‹ã‚‰ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’é€ä¿¡ã™ã‚‹ã¨ã€æ¥ç¶šä¸­ã®å…¨ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã«é…ä¿¡ã•ã‚Œã‚‹ãƒ•ãƒ­ãƒ¼ã‚’ä½œæˆã—ã¦ãã ã•ã„ã€‚</p>
            
            <p><strong>ğŸ¯ è¦æ±‚ä»•æ§˜:</strong></p>
            <ul>
                <li>Injectãƒãƒ¼ãƒ‰ã§ãƒˆãƒªã‚¬ãƒ¼ï¼ˆæ‰‹å‹•ï¼‰</li>
                <li>é€ä¿¡ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸: <code>{"type": "broadcast", "content": "å…¨å“¡ã¸ã®ãŠçŸ¥ã‚‰ã›"}</code></li>
                <li>å…¨ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã«é…ä¿¡</li>
            </ul>
            
            <details>
                <summary>ğŸ’¡ ãƒ’ãƒ³ãƒˆ</summary>
                <p><strong>ãƒ–ãƒ­ãƒ¼ãƒ‰ã‚­ãƒ£ã‚¹ãƒˆã®ãƒã‚¤ãƒ³ãƒˆ:</strong></p>
                <ul>
                    <li>WebSocket Out ã«æ¸¡ã™ msg ã« <code>_session</code> ãŒãªã„ã¨å…¨å“¡ã«é€ä¿¡ã•ã‚Œã¾ã™</li>
                    <li>Inject ãƒãƒ¼ãƒ‰ã‹ã‚‰ç”Ÿæˆã—ãŸ msg ã«ã¯ _session ãŒãªã„ã®ã§ã€ãã®ã¾ã¾é€ä¿¡å¯èƒ½</li>
                </ul>
            </details>
            
            <details>
                <summary>âœ… è§£ç­”ä¾‹ãƒ•ãƒ­ãƒ¼</summary>
                <div class="flow-json">[
    {"id": "ex3_tab", "type": "tab", "label": "æ¼”ç¿’3"},
    {"id": "ex3_ws_listener", "type": "websocket-listener", "path": "/ws/broadcast", "wholemsg": "false"},
    {"id": "ex3_inject", "type": "inject", "z": "ex3_tab", "name": "ãƒ–ãƒ­ãƒ¼ãƒ‰ã‚­ãƒ£ã‚¹ãƒˆ", "props": [{"p": "payload"}], "repeat": "", "crontab": "", "once": false, "onceDelay": 0.1, "topic": "", "payload": "{\"type\":\"broadcast\",\"content\":\"å…¨å“¡ã¸ã®ãŠçŸ¥ã‚‰ã›\"}", "payloadType": "json", "x": 170, "y": 100, "wires": [["ex3_func"]]},
    {"id": "ex3_func", "type": "function", "z": "ex3_tab", "name": "JSONåŒ–", "func": "msg.payload = JSON.stringify(msg.payload);\nreturn msg;", "outputs": 1, "timeout": 0, "noerr": 0, "initialize": "", "finalize": "", "libs": [], "x": 350, "y": 100, "wires": [["ex3_ws_out"]]},
    {"id": "ex3_ws_out", "type": "websocket out", "z": "ex3_tab", "name": "WS Out (å…¨å“¡)", "server": "ex3_ws_listener", "client": "", "x": 540, "y": 100, "wires": []},
    {"id": "ex3_ws_in", "type": "websocket in", "z": "ex3_tab", "name": "WS In (æ¥ç¶šç¢ºèªç”¨)", "server": "ex3_ws_listener", "client": "", "x": 190, "y": 180, "wires": [["ex3_debug"]]},
    {"id": "ex3_debug", "type": "debug", "z": "ex3_tab", "name": "æ¥ç¶šãƒ­ã‚°", "active": true, "tosidebar": true, "console": false, "tostatus": true, "complete": "payload", "targetType": "msg", "statusVal": "\"ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆæ¥ç¶š\"", "statusType": "str", "x": 410, "y": 180, "wires": []}
]</div>
            </details>
        </div>
        
        <div class="exercise">
            <h3>æ¼”ç¿’4: ç°¡æ˜“ãƒãƒ£ãƒƒãƒˆã‚·ã‚¹ãƒ†ãƒ  <span class="difficulty difficulty-hard">ä¸Šç´š</span></h3>
            <p><strong>ğŸ“‹ èª²é¡Œ:</strong> è¤‡æ•°ã®ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆãŒå‚åŠ ã§ãã‚‹ãƒãƒ£ãƒƒãƒˆãƒ«ãƒ¼ãƒ ã‚’ä½œæˆã—ã¦ãã ã•ã„ã€‚</p>
            
            <p><strong>ğŸ¯ è¦æ±‚ä»•æ§˜:</strong></p>
            <ul>
                <li>ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‹ã‚‰ã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸å½¢å¼: <code>{"name": "ãƒ¦ãƒ¼ã‚¶ãƒ¼å", "message": "å†…å®¹"}</code></li>
                <li>å…¨å“¡ã«é…ä¿¡ã™ã‚‹å½¢å¼: <code>{"type": "chat", "name": "...", "message": "...", "timestamp": "..."}</code></li>
                <li>æ¥ç¶š/åˆ‡æ–­æ™‚ã‚‚é€šçŸ¥ï¼ˆä»»æ„ï¼‰</li>
            </ul>
            
            <details>
                <summary>ğŸ’¡ ãƒ’ãƒ³ãƒˆ</summary>
                <p><strong>å‡¦ç†ã®æµã‚Œ:</strong></p>
                <ol>
                    <li>WebSocket In ã§å—ä¿¡</li>
                    <li>Function ã§ JSON ãƒ‘ãƒ¼ã‚¹ï¼†æ•´å½¢</li>
                    <li><code>delete msg._session</code> ã§ãƒ–ãƒ­ãƒ¼ãƒ‰ã‚­ãƒ£ã‚¹ãƒˆæº–å‚™</li>
                    <li>WebSocket Out ã§å…¨å“¡ã«é€ä¿¡</li>
                </ol>
            </details>
            
            <details>
                <summary>âœ… è§£ç­”ä¾‹ãƒ•ãƒ­ãƒ¼</summary>
                <div class="flow-json">[
    {"id": "ex4_tab", "type": "tab", "label": "æ¼”ç¿’4"},
    {"id": "ex4_ws_listener", "type": "websocket-listener", "path": "/ws/chatroom", "wholemsg": "false"},
    {"id": "ex4_ws_in", "type": "websocket in", "z": "ex4_tab", "name": "WS Chat In", "server": "ex4_ws_listener", "client": "", "x": 160, "y": 100, "wires": [["ex4_func"]]},
    {"id": "ex4_func", "type": "function", "z": "ex4_tab", "name": "ãƒãƒ£ãƒƒãƒˆå‡¦ç†", "func": "try {\n    var data = JSON.parse(msg.payload);\n} catch(e) {\n    var data = {name: \"åŒ¿å\", message: msg.payload};\n}\n\nmsg.payload = JSON.stringify({\n    type: \"chat\",\n    name: data.name || \"åŒ¿å\",\n    message: data.message || \"\",\n    timestamp: new Date().toISOString()\n});\n\n// å…¨å“¡ã«é€ä¿¡ã™ã‚‹ãŸã‚ _session ã‚’å‰Šé™¤\ndelete msg._session;\n\nreturn msg;", "outputs": 1, "timeout": 0, "noerr": 0, "initialize": "", "finalize": "", "libs": [], "x": 360, "y": 100, "wires": [["ex4_ws_out", "ex4_debug"]]},
    {"id": "ex4_ws_out", "type": "websocket out", "z": "ex4_tab", "name": "WS Chat Out", "server": "ex4_ws_listener", "client": "", "x": 570, "y": 100, "wires": []},
    {"id": "ex4_debug", "type": "debug", "z": "ex4_tab", "name": "ãƒãƒ£ãƒƒãƒˆãƒ­ã‚°", "active": true, "tosidebar": true, "console": false, "tostatus": false, "complete": "payload", "targetType": "msg", "x": 570, "y": 140, "wires": []}
]</div>
            </details>
        </div>
        
        <h2 id="section6">âœ… 6. ã¾ã¨ã‚</h2>
        
        <div class="important">
            <p><strong>ğŸ¯ é‡è¦ãƒã‚¤ãƒ³ãƒˆ:</strong></p>
            <ul>
                <li><strong>åŒæ–¹å‘é€šä¿¡</strong>: ã‚µãƒ¼ãƒãƒ¼ã‹ã‚‰ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã¸ãƒ—ãƒƒã‚·ãƒ¥é€ä¿¡ãŒå¯èƒ½</li>
                <li><strong>ã‚µãƒ¼ãƒãƒ¼ãƒ¢ãƒ¼ãƒ‰</strong>: <code>ws://localhost:1880/path</code> ã§æ¥ç¶šå—ä»˜</li>
                <li><strong>ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆãƒ¢ãƒ¼ãƒ‰</strong>: å¤–éƒ¨WebSocketã‚µãƒ¼ãƒãƒ¼ã«æ¥ç¶š</li>
                <li><strong>msg._session</strong>: ã‚ã‚Šâ†’ç‰¹å®šã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã€ãªã—â†’å…¨å“¡ã«ãƒ–ãƒ­ãƒ¼ãƒ‰ã‚­ãƒ£ã‚¹ãƒˆ</li>
                <li><strong>ãƒ‡ãƒ¼ã‚¿å½¢å¼</strong>: JSONæ–‡å­—åˆ—ã§é€å—ä¿¡ãŒä¸€èˆ¬çš„</li>
            </ul>
        </div>
        
        <div class="warning">
            <p><strong>âš ï¸ æ³¨æ„äº‹é …:</strong></p>
            <ul>
                <li>WebSocketæ¥ç¶šã¯<strong>ã‚¹ãƒ†ãƒ¼ãƒˆãƒ•ãƒ«</strong>ï¼ˆçŠ¶æ…‹ã‚’æŒã¤ï¼‰ãªã®ã§ã€ã‚µãƒ¼ãƒãƒ¼å†èµ·å‹•æ™‚ã«åˆ‡æ–­ã•ã‚Œã‚‹</li>
                <li>ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆå´ã§<strong>å†æ¥ç¶šå‡¦ç†</strong>ã‚’å®Ÿè£…ã™ã‚‹ã“ã¨ã‚’æ¨å¥¨</li>
                <li>å¤§é‡ã®ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆæ¥ç¶šæ™‚ã¯<strong>ãƒ¡ãƒ¢ãƒªä½¿ç”¨é‡</strong>ã«æ³¨æ„</li>
                <li>å¤–éƒ¨å…¬é–‹æ™‚ã¯<strong>WSSï¼ˆWebSocket Secureï¼‰</strong>ã‚’ä½¿ç”¨</li>
            </ul>
        </div>
        
        <h2 id="section7">ğŸ”§ 7. ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°</h2>
        
        <table>
            <tr><th>ç—‡çŠ¶</th><th>åŸå› </th><th>è§£æ±ºæ–¹æ³•</th></tr>
            <tr>
                <td>æ¥ç¶šã§ããªã„</td>
                <td>URLãŒé–“é•ã£ã¦ã„ã‚‹</td>
                <td>ws://ï¼ˆhttpsãªã‚‰wss://ï¼‰ã‚’ç¢ºèª</td>
            </tr>
            <tr>
                <td>ã™ãåˆ‡æ–­ã•ã‚Œã‚‹</td>
                <td>ã‚µãƒ¼ãƒãƒ¼å´ã®å•é¡Œ</td>
                <td>Node-REDã®ãƒ­ã‚°ã‚’ç¢ºèª</td>
            </tr>
            <tr>
                <td>ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãŒå±Šã‹ãªã„</td>
                <td>è¨­å®šãƒãƒ¼ãƒ‰ãŒç•°ãªã‚‹</td>
                <td>In/Outã§åŒã˜è¨­å®šãƒãƒ¼ãƒ‰ã‚’ä½¿ç”¨</td>
            </tr>
            <tr>
                <td>å…¨å“¡ã«é€ä¿¡ã•ã‚Œãªã„</td>
                <td>_sessionãŒæ®‹ã£ã¦ã„ã‚‹</td>
                <td><code>delete msg._session</code></td>
            </tr>
            <tr>
                <td>JSONãƒ‘ãƒ¼ã‚¹ã‚¨ãƒ©ãƒ¼</td>
                <td>ãƒ‡ãƒ¼ã‚¿å½¢å¼ã®å•é¡Œ</td>
                <td>try-catchã§ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°</td>
            </tr>
        </table>
        
        <h2 id="section8">ğŸ­ 8. å®Ÿå‹™æ´»ç”¨ä¾‹</h2>
        
        <h3>ã‚±ãƒ¼ã‚¹1: ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ã‚»ãƒ³ã‚µãƒ¼ãƒ¢ãƒ‹ã‚¿ãƒªãƒ³ã‚°</h3>
        <p>Raspberry Pi ã‹ã‚‰ã®ã‚»ãƒ³ã‚µãƒ¼ãƒ‡ãƒ¼ã‚¿ã‚’WebSocketã§é…ä¿¡ã—ã€ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã§ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ è¡¨ç¤º</p>
        
        <h3>ã‚±ãƒ¼ã‚¹2: æ©Ÿå™¨ã®é éš”åˆ¶å¾¡</h3>
        <p>WebSocketçµŒç”±ã§ã‚³ãƒãƒ³ãƒ‰ã‚’å—ä¿¡ã—ã€GPIOã‚„ã‚¢ã‚¯ãƒãƒ¥ã‚¨ãƒ¼ã‚¿ãƒ¼ã‚’åˆ¶å¾¡</p>
        
        <h3>ã‚±ãƒ¼ã‚¹3: é€šçŸ¥ã‚·ã‚¹ãƒ†ãƒ </h3>
        <p>ã‚¢ãƒ©ãƒ¼ãƒˆã‚„è­¦å‘Šã‚’ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã«å³æ™‚ãƒ—ãƒƒã‚·ãƒ¥é…ä¿¡</p>
        
        <h3>ã‚±ãƒ¼ã‚¹4: è¤‡æ•°ãƒ‡ãƒã‚¤ã‚¹é–“ã®åŒæœŸ</h3>
        <p>è¤‡æ•°ã®Raspberry Pié–“ã§ãƒ‡ãƒ¼ã‚¿ã‚’åŒæœŸï¼ˆåˆ†æ•£ã‚»ãƒ³ã‚µãƒ¼ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ï¼‰</p>
        
        <p style="margin-top: 40px;"><a href="https://nodered.org/docs/user-guide/nodes#websocket" target="_blank">ğŸ“š Node-RED å…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ - WebSocket</a></p>
    </div>
    
    <script>
        document.querySelectorAll('.flow-json').forEach(function(block) {
            // ãƒœã‚¿ãƒ³ã‚’è¿½åŠ ã™ã‚‹å‰ã«JSONãƒ†ã‚­ã‚¹ãƒˆã‚’ä¿å­˜
            var jsonText = block.textContent;

            var btn = document.createElement('button');
            btn.className = 'copy-btn';
            btn.textContent = 'ã‚³ãƒ”ãƒ¼';
            btn.onclick = function() {
                navigator.clipboard.writeText(jsonText).then(function() {
                    btn.textContent = 'ã‚³ãƒ”ãƒ¼å®Œäº†!';
                    setTimeout(function() { btn.textContent = 'ã‚³ãƒ”ãƒ¼'; }, 2000);
                });
            };
            block.style.position = 'relative';
            block.appendChild(btn);
        });
    </script>
    <!-- ãƒ•ãƒ­ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ãƒ›ãƒ¼ãƒ ãƒœã‚¿ãƒ³ -->
    <a href="index.html" style="position: fixed; bottom: 20px; right: 20px; width: 56px; height: 56px; background: linear-gradient(135deg, #42b883 0%, #35495e 100%); color: white; border-radius: 50%; display: flex; align-items: center; justify-content: center; text-decoration: none; font-size: 24px; box-shadow: 0 4px 12px rgba(0,0,0,0.3); z-index: 1000; transition: transform 0.3s, box-shadow 0.3s;" onmouseover="this.style.transform='scale(1.1)'; this.style.boxShadow='0 6px 16px rgba(0,0,0,0.4)';" onmouseout="this.style.transform='scale(1)'; this.style.boxShadow='0 4px 12px rgba(0,0,0,0.3)';" title="ãƒˆãƒƒãƒ—ãƒšãƒ¼ã‚¸ã¸">ğŸ </a>
</body>
</html>
