<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Node-RED Functionãƒãƒ¼ãƒ‰ å®Œå…¨ã‚¬ã‚¤ãƒ‰</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.8;
            max-width: 1000px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
            color: #333;
        }
        
        h1 {
            color: #8f0000;
            border-bottom: 3px solid #8f0000;
            padding-bottom: 10px;
        }
        
        h2 {
            color: #c00000;
            margin-top: 30px;
            border-left: 5px solid #c00000;
            padding-left: 15px;
        }
        
        h3 {
            color: #555;
            margin-top: 25px;
        }
        
        .container {
            background-color: white;
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        
        .node-example {
            background-color: #2d3133;
            padding: 20px;
            border-radius: 5px;
            margin: 20px 0;
            color: white;
            font-family: 'Courier New', monospace;
        }
        
        .node {
            display: inline-block;
            padding: 8px 15px;
            border-radius: 4px;
            margin: 5px;
            font-weight: bold;
            font-size: 14px;
        }
        
        .node-inject {
            background-color: #3fadb5;
            color: white;
        }
        
        .node-function {
            background-color: #e6b0aa;
            color: #333;
        }
        
        .node-debug {
            background-color: #87a48d;
            color: white;
        }
        
        .node-change {
            background-color: #e7a070;
            color: white;
        }
        
        .arrow {
            color: #999;
            font-size: 20px;
            margin: 0 10px;
        }
        
        .important {
            background-color: #fff3cd;
            border-left: 4px solid #ffc107;
            padding: 15px;
            margin: 15px 0;
            border-radius: 4px;
        }
        
        .tip {
            background-color: #d1ecf1;
            border-left: 4px solid #17a2b8;
            padding: 15px;
            margin: 15px 0;
            border-radius: 4px;
        }
        
        .warning {
            background-color: #f8d7da;
            border-left: 4px solid #dc3545;
            padding: 15px;
            margin: 15px 0;
            border-radius: 4px;
        }
        
        .code-block {
            background-color: #f8f9fa;
            border: 1px solid #ddd;
            border-radius: 4px;
            padding: 15px;
            margin: 15px 0;
            overflow-x: auto;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            position: relative;
        }
        
        .copy-button {
            position: absolute;
            top: 8px;
            right: 8px;
            padding: 6px 12px;
            background-color: #007bff;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
            font-family: 'Segoe UI', sans-serif;
            transition: background-color 0.2s;
            z-index: 10;
        }
        
        .copy-button:hover {
            background-color: #0056b3;
        }
        
        .copy-button.copied {
            background-color: #28a745;
        }
        
        .exercise {
            background-color: #e8f5e9;
            border: 2px solid #4caf50;
            border-radius: 8px;
            padding: 20px;
            margin: 25px 0;
        }
        
        .exercise h3 {
            color: #2e7d32;
            margin-top: 0;
        }
        
        .difficulty {
            display: inline-block;
            padding: 5px 12px;
            border-radius: 15px;
            font-size: 12px;
            font-weight: bold;
            margin-left: 10px;
        }
        
        .difficulty-easy {
            background-color: #4caf50;
            color: white;
        }
        
        .difficulty-medium {
            background-color: #ff9800;
            color: white;
        }
        
        .difficulty-hard {
            background-color: #f44336;
            color: white;
        }
        
        ul, ol {
            padding-left: 25px;
        }
        
        li {
            margin: 8px 0;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
        }
        
        th, td {
            border: 1px solid #ddd;
            padding: 12px;
            text-align: left;
        }
        
        th {
            background-color: #8f0000;
            color: white;
        }
        
        tr:nth-child(even) {
            background-color: #f9f9f9;
        }
        
        .flow-json {
            background-color: #263238;
            color: #aed581;
            padding: 15px;
            border-radius: 5px;
            overflow-x: auto;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            max-height: 400px;
            overflow-y: auto;
            position: relative;
        }
        
        details {
            margin: 15px 0;
        }
        
        summary {
            cursor: pointer;
            padding: 10px;
            background-color: #6c757d;
            color: white;
            border-radius: 4px;
            font-weight: bold;
        }
        
        summary:hover {
            background-color: #5a6268;
        }
        
        .feature-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }
        
        .feature-card {
            background-color: #f8f9fa;
            border: 2px solid #dee2e6;
            border-radius: 8px;
            padding: 15px;
        }
        
        .feature-card h4 {
            color: #e6b0aa;
            margin-top: 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ’» Node-RED Functionãƒãƒ¼ãƒ‰ å®Œå…¨ã‚¬ã‚¤ãƒ‰</h1>
        
        <p>ã“ã®ã‚¬ã‚¤ãƒ‰ã§ã¯ã€Node-REDã®<strong>Functionãƒãƒ¼ãƒ‰</strong>ã«ã¤ã„ã¦ã€åˆå¿ƒè€…ã®æ–¹ã§ã‚‚ç†è§£ã§ãã‚‹ã‚ˆã†ã«è©³ã—ãèª¬æ˜ã—ã¾ã™ã€‚</p>
        
        <h2>ğŸ“š 1. Functionãƒãƒ¼ãƒ‰ã¨ã¯?</h2>
        
        <h3>ğŸ¤” ã€Œãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°ã€ã£ã¦ä½•?</h3>
        <p>Functionãƒãƒ¼ãƒ‰ã¯ã€<strong>JavaScriptã§ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã‚’æ›¸ã‘ã‚‹</strong>ãƒãƒ¼ãƒ‰ã§ã™ã€‚Changeãƒãƒ¼ãƒ‰ã‚„Switchãƒãƒ¼ãƒ‰ã§ã¯ã§ããªã„ã€è¤‡é›‘ãªå‡¦ç†ã‚’è‡ªç”±ã«æ›¸ãã“ã¨ãŒã§ãã¾ã™ã€‚</p>
        
        <div class="important">
            <strong>ğŸ’¡ æ—¥å¸¸ã®ä¾‹ã§è€ƒãˆã¦ã¿ã¾ã—ã‚‡ã†:</strong>
            <ul>
                <li>æ–™ç†ã®ãƒ¬ã‚·ãƒ” â†’ æ‰‹é †ã‚’æ›¸ã„ãŸã‚‚ã® = ãƒ—ãƒ­ã‚°ãƒ©ãƒ </li>
                <li>æ•°å­¦ã®è¨ˆç®— â†’ è¤‡é›‘ãªè¨ˆç®—å¼ = ãƒ—ãƒ­ã‚°ãƒ©ãƒ </li>
                <li>ã‚²ãƒ¼ãƒ ã®ãƒ«ãƒ¼ãƒ« â†’ æ¡ä»¶åˆ¤æ–­ã¨å‡¦ç† = ãƒ—ãƒ­ã‚°ãƒ©ãƒ </li>
            </ul>
            <p>Functionãƒãƒ¼ãƒ‰ã¯ã€ã“ã‚Œã‚‰ã®ã€Œæ‰‹é †ã€ã€Œè¨ˆç®—ã€ã€Œåˆ¤æ–­ã€ã‚’è‡ªç”±ã«æ›¸ã‘ã‚‹ãƒãƒ¼ãƒ‰ã§ã™!</p>
        </div>
        
        <h3>ğŸ¯ Functionãƒãƒ¼ãƒ‰ã®å½¹å‰²</h3>
        <p><strong>Functionãƒãƒ¼ãƒ‰</strong>ã¯ã€JavaScriptã‚³ãƒ¼ãƒ‰ã‚’ä½¿ã£ã¦ã€Changeãƒãƒ¼ãƒ‰ã‚„Switchãƒãƒ¼ãƒ‰ã§ã¯é›£ã—ã„å‡¦ç†ã‚’å®Ÿç¾ã—ã¾ã™ã€‚</p>
        
        <div class="tip">
            <strong>ğŸ³ æ–™ç†ã®ä¾‹:</strong><br>
            <br>
            <strong>Changeãƒãƒ¼ãƒ‰</strong> = æ±ºã¾ã£ãŸèª¿å‘³æ–™ã‚’å…¥ã‚Œã‚‹<br>
            â†’ã€Œå¡©ã‚’5gå…¥ã‚Œã‚‹ã€ãªã©ã€ã‚·ãƒ³ãƒ—ãƒ«ãªæ“ä½œ<br>
            <br>
            <strong>Functionãƒãƒ¼ãƒ‰</strong> = æ–™ç†äººãŒè‡ªç”±ã«æ–™ç†ã™ã‚‹<br>
            â†’ã€Œå‘³è¦‹ã—ãªãŒã‚‰èª¿æ•´ã€ã€Œè¤‡æ•°ã®å·¥ç¨‹ã‚’çµ„ã¿åˆã‚ã›ã€ãªã©ã€è¤‡é›‘ãªæ“ä½œ<br>
            <br>
            ã‚ˆã‚ŠæŸ”è»Ÿã§å¼·åŠ›ã§ã™ãŒã€JavaScriptã®çŸ¥è­˜ãŒå¿…è¦ã§ã™!
        </div>
        
        <h2>ğŸ” 2. ã‚µãƒ³ãƒ—ãƒ«ãƒ•ãƒ­ãƒ¼ã®è©³ã—ã„è§£èª¬</h2>
        
        <p>ã‚µãƒ³ãƒ—ãƒ«ãƒ•ãƒ­ãƒ¼ã«ã¯ã€Functionãƒãƒ¼ãƒ‰ã®<strong>7ã¤ã®ä¸»è¦ãªä½¿ã„æ–¹</strong>ãŒå«ã¾ã‚Œã¦ã„ã¾ã™:</p>
        
        <h3>ãƒ‘ã‚¿ãƒ¼ãƒ³1: ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’è¿”ã™</h3>
        <div class="node-example">
            <span class="node node-inject">inject<br>"World"</span>
            <span class="arrow">â†’</span>
            <span class="node node-function">function<br>"Hello, "+msg.payload+"!"</span>
            <span class="arrow">â†’</span>
            <span class="node node-debug">debug<br>"Hello, World!"</span>
        </div>
        <p>payloadã«æ–‡å­—åˆ—ã‚’è¿½åŠ ã—ã¦è¿”ã—ã¾ã™ã€‚</p>
        
        <h3>ãƒ‘ã‚¿ãƒ¼ãƒ³2: è¤‡æ•°ã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’è¿”ã™</h3>
        <div class="node-example">
            <span class="node node-inject">inject</span>
            <span class="arrow">â†’</span>
            <span class="node node-function">function<br>é…åˆ—ã‚’è¿”ã™</span>
            <span class="arrow">â†’</span>
            <span class="node node-debug">output1<br>(3å€‹)</span>
            <br><br>
            <span style="margin-left: 200px;">â†“</span>
            <br>
            <span style="margin-left: 170px;"><span class="node node-debug">output2<br>(1å€‹)</span></span>
        </div>
        <p>å‡ºåŠ›ãƒãƒ¼ãƒˆã”ã¨ã«ç•°ãªã‚‹ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’é€ä¿¡ã§ãã¾ã™ã€‚</p>
        
        <h3>ãƒ‘ã‚¿ãƒ¼ãƒ³3: éåŒæœŸã§ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸é€ä¿¡</h3>
        <div class="node-example">
            <span class="node node-inject">inject</span>
            <span class="arrow">â†’</span>
            <span class="node node-function">function<br>setTimeout 2ç§’</span>
            <span class="arrow">â†’</span>
            <span class="node node-debug">2ç§’å¾Œã«è¡¨ç¤º</span>
        </div>
        <p>setTimeoutã‚’ä½¿ã£ã¦ã€ä¸€å®šæ™‚é–“å¾Œã«ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’é€ä¿¡ã—ã¾ã™ã€‚</p>
        
        <h3>ãƒ‘ã‚¿ãƒ¼ãƒ³4: ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆå¤‰æ•°ã®ä½¿ç”¨</h3>
        <div class="node-example">
            <span class="node node-inject">inject</span>
            <span class="arrow">â†’</span>
            <span class="node node-function">function<br>flow.get/set</span>
            <span class="arrow">â†’</span>
            <span class="node node-debug">å¤‰æ•°ã‚’ä¿å­˜ãƒ»å–å¾—</span>
        </div>
        <p>flowå¤‰æ•°ã‚„globalå¤‰æ•°ã‚’ä½¿ã£ã¦ã€ãƒ‡ãƒ¼ã‚¿ã‚’ä¿å­˜ãƒ»å–å¾—ã—ã¾ã™ã€‚</p>
        
        <h3>ãƒ‘ã‚¿ãƒ¼ãƒ³5: ãƒãƒ¼ãƒ‰ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã®è¡¨ç¤º</h3>
        <div class="node-example">
            <span class="node node-inject">inject</span>
            <span class="arrow">â†’</span>
            <span class="node node-function">function<br>node.status()</span>
        </div>
        <p>ãƒãƒ¼ãƒ‰ã®ä¸‹ã«çŠ¶æ…‹ã‚’è¡¨ç¤ºã§ãã¾ã™(ä¾‹: å‡¦ç†ä¸­ã€å®Œäº†ã€ã‚¨ãƒ©ãƒ¼)ã€‚</p>
        
        <h3>ãƒ‘ã‚¿ãƒ¼ãƒ³6: å¤–éƒ¨ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã®ä½¿ç”¨</h3>
        <div class="node-example">
            <span class="node node-inject">inject</span>
            <span class="arrow">â†’</span>
            <span class="node node-function">function<br>os module</span>
            <span class="arrow">â†’</span>
            <span class="node node-debug">OSæƒ…å ±è¡¨ç¤º</span>
        </div>
        <p>å¤–éƒ¨ã®npmãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚’ä½¿ã£ã¦é«˜åº¦ãªå‡¦ç†ãŒã§ãã¾ã™ã€‚</p>
        
        <h3>ãƒ‘ã‚¿ãƒ¼ãƒ³7: Setup/Closeã‚³ãƒ¼ãƒ‰</h3>
        <div class="node-example">
            <span style="color: #aaa;">Setup: åˆæœŸåŒ–å‡¦ç†</span>
            <br>
            <span class="node node-inject">inject</span>
            <span class="arrow">â†’</span>
            <span class="node node-function">function<br>counter</span>
            <span class="arrow">â†’</span>
            <span class="node node-debug">ã‚«ã‚¦ãƒ³ãƒˆè¡¨ç¤º</span>
            <br>
            <span style="color: #aaa;">Close: çµ‚äº†å‡¦ç†</span>
        </div>
        <p>ãƒãƒ¼ãƒ‰èµ·å‹•æ™‚ã¨åœæ­¢æ™‚ã«ç‰¹åˆ¥ãªå‡¦ç†ã‚’å®Ÿè¡Œã§ãã¾ã™ã€‚</p>
        
        <h2>âš™ï¸ 3. Functionãƒãƒ¼ãƒ‰ã®åŸºæœ¬</h2>
        
        <h3>msgã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã¨ã¯</h3>
        
        <div class="important">
            <p><strong>msg</strong>ã¯ã€ãƒãƒ¼ãƒ‰é–“ã‚’æµã‚Œã‚‹ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã§ã™ã€‚</p>
            
            <p><strong>ä¸»ãªãƒ—ãƒ­ãƒ‘ãƒ†ã‚£:</strong></p>
            <ul>
                <li><code>msg.payload</code> â†’ ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®æœ¬ä½“(ãƒ‡ãƒ¼ã‚¿)</li>
                <li><code>msg.topic</code> â†’ ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®ãƒˆãƒ”ãƒƒã‚¯(ç¨®é¡)</li>
                <li><code>msg._msgid</code> â†’ ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®ä¸€æ„ãªID</li>
            </ul>
            
            <p><strong>åŸºæœ¬çš„ãªä½¿ã„æ–¹:</strong></p>
            <div class="code-block">
// payloadã‚’èª­ã¿å–ã‚‹
let value = msg.payload;

// payloadã‚’å¤‰æ›´ã™ã‚‹
msg.payload = "æ–°ã—ã„å€¤";

// æ–°ã—ã„ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã‚’è¿½åŠ 
msg.customProperty = "ã‚«ã‚¹ã‚¿ãƒ å€¤";

// ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’è¿”ã™(æ¬¡ã®ãƒãƒ¼ãƒ‰ã«é€ä¿¡)
return msg;
            </div>
        </div>
        
        <h3>returnã®ä½¿ã„æ–¹</h3>
        
        <table>
            <tr>
                <th>è¿”ã—æ–¹</th>
                <th>ã‚³ãƒ¼ãƒ‰ä¾‹</th>
                <th>èª¬æ˜</th>
            </tr>
            <tr>
                <td>1ã¤ã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸</td>
                <td><code>return msg;</code></td>
                <td>msgã‚’ãã®ã¾ã¾æ¬¡ã®ãƒãƒ¼ãƒ‰ã«é€ä¿¡</td>
            </tr>
            <tr>
                <td>ä½•ã‚‚é€ä¿¡ã—ãªã„</td>
                <td><code>return null;</code></td>
                <td>ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’ç ´æ£„(æ¬¡ã®ãƒãƒ¼ãƒ‰ã«é€ã‚‰ãªã„)</td>
            </tr>
            <tr>
                <td>è¤‡æ•°ã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸(1å‡ºåŠ›)</td>
                <td><code>return [msg1, msg2];</code></td>
                <td>åŒã˜å‡ºåŠ›ã‹ã‚‰2ã¤ã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’é€ä¿¡</td>
            </tr>
            <tr>
                <td>è¤‡æ•°ã®å‡ºåŠ›ã«é€ä¿¡</td>
                <td><code>return [msg1, msg2];</code></td>
                <td>å‡ºåŠ›1ã«msg1ã€å‡ºåŠ›2ã«msg2ã‚’é€ä¿¡</td>
            </tr>
        </table>
        
        <h3>ğŸ“‹ ã‚ˆãä½¿ã†JavaScriptæ§‹æ–‡</h3>
        
        <div class="feature-grid">
            <div class="feature-card">
                <h4>å¤‰æ•°ã®å®£è¨€</h4>
                <div class="code-block">
// å¤‰æ•°ã‚’å®£è¨€
let name = "å¤ªéƒ";
let age = 25;
const PI = 3.14; // å®šæ•°
                </div>
            </div>
            
            <div class="feature-card">
                <h4>æ¡ä»¶åˆ†å²</h4>
                <div class="code-block">
if (msg.payload > 10) {
    msg.payload = "å¤§ãã„";
} else {
    msg.payload = "å°ã•ã„";
}
                </div>
            </div>
            
            <div class="feature-card">
                <h4>ãƒ«ãƒ¼ãƒ—å‡¦ç†</h4>
                <div class="code-block">
// é…åˆ—ã‚’ãƒ«ãƒ¼ãƒ—
for (let i = 0; i < 5; i++) {
    // å‡¦ç†
}

// é…åˆ—ã®å„è¦ç´ ã‚’å‡¦ç†
arr.forEach(item => {
    // å‡¦ç†
});
                </div>
            </div>
            
            <div class="feature-card">
                <h4>é…åˆ—æ“ä½œ</h4>
                <div class="code-block">
// é…åˆ—ã®ä½œæˆ
let arr = [1, 2, 3, 4, 5];

// è¦ç´ ã®è¿½åŠ 
arr.push(6);

// è¦ç´ ã®å–å¾—
let first = arr[0];
                </div>
            </div>
            
            <div class="feature-card">
                <h4>ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆæ“ä½œ</h4>
                <div class="code-block">
// ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®ä½œæˆ
let obj = {
    name: "å¤ªéƒ",
    age: 25
};

// ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã®å–å¾—
let name = obj.name;
                </div>
            </div>
            
            <div class="feature-card">
                <h4>æ–‡å­—åˆ—æ“ä½œ</h4>
                <div class="code-block">
// æ–‡å­—åˆ—ã®çµåˆ
let str = "Hello, " + "World!";

// ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆæ–‡å­—åˆ—
let msg = `å€¤ã¯${value}ã§ã™`;
                </div>
            </div>
        </div>
        
        <h2>ğŸ’¡ 4. ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆå¤‰æ•°</h2>
        
        <h3>3ç¨®é¡ã®ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆ</h3>
        
        <table>
            <tr>
                <th>ç¨®é¡</th>
                <th>ã‚¹ã‚³ãƒ¼ãƒ—</th>
                <th>ä½¿ã„æ–¹</th>
            </tr>
            <tr>
                <td>flow</td>
                <td>åŒã˜ãƒ•ãƒ­ãƒ¼å†…ã§å…±æœ‰</td>
                <td><code>flow.get("key")</code><br><code>flow.set("key", value)</code></td>
            </tr>
            <tr>
                <td>global</td>
                <td>ã™ã¹ã¦ã®ãƒ•ãƒ­ãƒ¼ã§å…±æœ‰</td>
                <td><code>global.get("key")</code><br><code>global.set("key", value)</code></td>
            </tr>
            <tr>
                <td>context</td>
                <td>ãƒãƒ¼ãƒ‰å†…ã§ã®ã¿æœ‰åŠ¹</td>
                <td><code>context.get("key")</code><br><code>context.set("key", value)</code></td>
            </tr>
        </table>
        
        <div class="code-block">
// ã‚«ã‚¦ãƒ³ã‚¿ãƒ¼ã®ä¾‹
let count = flow.get('counter') || 0;  // å–å¾—(åˆå›ã¯0)
count = count + 1;                      // å¢—ã‚„ã™
flow.set('counter', count);             // ä¿å­˜
msg.payload = count;
return msg;
        </div>
        
        <h2>ğŸ“ 5. ç·´ç¿’å•é¡Œ</h2>
        
        <div class="exercise">
            <h3>ç·´ç¿’å•é¡Œ 1: æ¸©åº¦ã®åˆ¤å®š <span class="difficulty difficulty-easy">åˆç´š</span></h3>
            
            <h4>ğŸ¯ ç›®æ¨™</h4>
            <p>æ¸©åº¦ã®å€¤ã‚’å—ã‘å–ã‚Šã€30â„ƒä»¥ä¸Šãªã‚‰ã€Œæš‘ã„ã€ã€30â„ƒæœªæº€ãªã‚‰ã€Œæ¶¼ã—ã„ã€ã¨è¡¨ç¤ºã™ã‚‹</p>
            
            <h4>ğŸ“‹ è¦ä»¶</h4>
            <ol>
                <li>Injectãƒãƒ¼ãƒ‰ã§æ¸©åº¦(æ•°å€¤)ã‚’é€ä¿¡</li>
                <li>Functionãƒãƒ¼ãƒ‰ã§æ¸©åº¦ã‚’åˆ¤å®š</li>
                <li>Debugãƒãƒ¼ãƒ‰ã§çµæœã‚’è¡¨ç¤º</li>
            </ol>
            
            <h4>ğŸ’­ ãƒ’ãƒ³ãƒˆ</h4>
            
            <p><strong>ğŸ¯ Functionãƒãƒ¼ãƒ‰ã®ã‚³ãƒ¼ãƒ‰(è‡ªåˆ†ã§æ›¸ã„ã¦ã¿ã‚ˆã†):</strong></p>
            <ul>
                <li>msg.payloadã«æ¸©åº¦ãŒå…¥ã£ã¦ã„ã‚‹</li>
                <li>ifæ–‡ã§æ¡ä»¶åˆ†å²ã™ã‚‹</li>
                <li>msg.payloadã«çµæœã®æ–‡å­—åˆ—ã‚’è¨­å®š</li>
                <li>return msgã§è¿”ã™</li>
            </ul>
            
            <p><strong>ğŸ”¢ Injectãƒãƒ¼ãƒ‰ã®è¨­å®š(ãã®ã¾ã¾è¨­å®šã—ã¦ãã ã•ã„):</strong></p>
            <ul>
                <li>åå‰: <code>æ¸©åº¦35â„ƒ</code></li>
                <li>Payload: numberå‹ã§ <code>35</code></li>
            </ul>
            
            <p><strong>ğŸ”¢ ã‚‚ã†1ã¤Injectãƒãƒ¼ãƒ‰ã‚’ä½œæˆ:</strong></p>
            <ul>
                <li>åå‰: <code>æ¸©åº¦25â„ƒ</code></li>
                <li>Payload: numberå‹ã§ <code>25</code></li>
            </ul>
            
            <details>
                <summary>ğŸ“¦ è§£ç­”ãƒ•ãƒ­ãƒ¼ (ã‚¯ãƒªãƒƒã‚¯ã—ã¦è¡¨ç¤º)</summary>
                <div class="flow-json">
[
    {
        "id": "ex1_inject1",
        "type": "inject",
        "z": "exercise1",
        "name": "æ¸©åº¦35â„ƒ",
        "props": [
            {
                "p": "payload"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "35",
        "payloadType": "num",
        "x": 120,
        "y": 100,
        "wires": [
            ["ex1_function"]
        ]
    },
    {
        "id": "ex1_inject2",
        "type": "inject",
        "z": "exercise1",
        "name": "æ¸©åº¦25â„ƒ",
        "props": [
            {
                "p": "payload"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "25",
        "payloadType": "num",
        "x": 120,
        "y": 140,
        "wires": [
            ["ex1_function"]
        ]
    },
    {
        "id": "ex1_function",
        "type": "function",
        "z": "exercise1",
        "name": "æ¸©åº¦åˆ¤å®š",
        "func": "// æ¸©åº¦ã‚’å–å¾—\nlet temp = msg.payload;\n\n// æ¡ä»¶åˆ†å²\nif (temp >= 30) {\n    msg.payload = \"æš‘ã„(\" + temp + \"â„ƒ)\";\n} else {\n    msg.payload = \"æ¶¼ã—ã„(\" + temp + \"â„ƒ)\";\n}\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 300,
        "y": 120,
        "wires": [
            ["ex1_debug"]
        ]
    },
    {
        "id": "ex1_debug",
        "type": "debug",
        "z": "exercise1",
        "name": "",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "payload",
        "targetType": "msg",
        "x": 470,
        "y": 120,
        "wires": []
    }
]
                </div>
                <p><strong>âœ… å‹•ä½œç¢ºèª:</strong></p>
                <ul>
                    <li>ã€Œæ¸©åº¦35â„ƒã€ã‚’ã‚¯ãƒªãƒƒã‚¯ â†’ ã€Œæš‘ã„(35â„ƒ)ã€ã¨è¡¨ç¤º</li>
                    <li>ã€Œæ¸©åº¦25â„ƒã€ã‚’ã‚¯ãƒªãƒƒã‚¯ â†’ ã€Œæ¶¼ã—ã„(25â„ƒ)ã€ã¨è¡¨ç¤º</li>
                </ul>
                
                <p><strong>ğŸ“ è§£ç­”ã‚³ãƒ¼ãƒ‰:</strong></p>
                <div class="code-block">
// æ¸©åº¦ã‚’å–å¾—
let temp = msg.payload;

// æ¡ä»¶åˆ†å²
if (temp >= 30) {
    msg.payload = "æš‘ã„(" + temp + "â„ƒ)";
} else {
    msg.payload = "æ¶¼ã—ã„(" + temp + "â„ƒ)";
}

return msg;
                </div>
            </details>
        </div>
        
        <div class="exercise">
            <h3>ç·´ç¿’å•é¡Œ 2: é…åˆ—ã®åˆè¨ˆã¨å¹³å‡ <span class="difficulty difficulty-medium">ä¸­ç´š</span></h3>
            
            <h4>ğŸ¯ ç›®æ¨™</h4>
            <p>æ•°å€¤ã®é…åˆ—ã‚’å—ã‘å–ã‚Šã€åˆè¨ˆã¨å¹³å‡ã‚’è¨ˆç®—ã—ã¦è¿”ã™</p>
            
            <h4>ğŸ“‹ è¦ä»¶</h4>
            <ol>
                <li>Injectãƒãƒ¼ãƒ‰ã§æ•°å€¤ã®é…åˆ—ã‚’é€ä¿¡</li>
                <li>Functionãƒãƒ¼ãƒ‰ã§åˆè¨ˆã¨å¹³å‡ã‚’è¨ˆç®—</li>
                <li>çµæœã‚’ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã§è¿”ã™: <code>{sum: åˆè¨ˆ, avg: å¹³å‡}</code></li>
                <li>Debugãƒãƒ¼ãƒ‰ã§çµæœã‚’è¡¨ç¤º</li>
            </ol>
            
            <h4>ğŸ’­ ãƒ’ãƒ³ãƒˆ</h4>
            
            <p><strong>ğŸ¯ Functionãƒãƒ¼ãƒ‰ã®ã‚³ãƒ¼ãƒ‰(è‡ªåˆ†ã§æ›¸ã„ã¦ã¿ã‚ˆã†):</strong></p>
            <ul>
                <li>msg.payloadã«é…åˆ—ãŒå…¥ã£ã¦ã„ã‚‹</li>
                <li>forãƒ«ãƒ¼ãƒ—ã¾ãŸã¯forEachã§é…åˆ—ã‚’ãƒ«ãƒ¼ãƒ—</li>
                <li>åˆè¨ˆã‚’è¨ˆç®—ã—ã¦ã‹ã‚‰ã€é…åˆ—ã®é•·ã•ã§å‰²ã£ã¦å¹³å‡ã‚’æ±‚ã‚ã‚‹</li>
            </ul>
            
            <p><strong>ğŸ”¢ Injectãƒãƒ¼ãƒ‰ã®è¨­å®š(ãã®ã¾ã¾è¨­å®šã—ã¦ãã ã•ã„):</strong></p>
            <div class="important">
                <ul>
                    <li>Payload: JSONå‹ã‚’é¸æŠ</li>
                    <li>ä»¥ä¸‹ã®JSONã‚’å…¥åŠ›:</li>
                </ul>
                <div class="code-block">
[10, 20, 30, 40, 50]
                </div>
            </div>
            
            <details>
                <summary>ğŸ“¦ è§£ç­”ãƒ•ãƒ­ãƒ¼ (ã‚¯ãƒªãƒƒã‚¯ã—ã¦è¡¨ç¤º)</summary>
                <div class="flow-json">
[
    {
        "id": "ex2_inject",
        "type": "inject",
        "z": "exercise2",
        "name": "æ•°å€¤é…åˆ—",
        "props": [
            {
                "p": "payload"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "[10,20,30,40,50]",
        "payloadType": "json",
        "x": 120,
        "y": 100,
        "wires": [
            ["ex2_function"]
        ]
    },
    {
        "id": "ex2_function",
        "type": "function",
        "z": "exercise2",
        "name": "åˆè¨ˆã¨å¹³å‡",
        "func": "// é…åˆ—ã‚’å–å¾—\nlet numbers = msg.payload;\n\n// åˆè¨ˆã‚’è¨ˆç®—\nlet sum = 0;\nfor (let i = 0; i < numbers.length; i++) {\n    sum = sum + numbers[i];\n}\n\n// å¹³å‡ã‚’è¨ˆç®—\nlet avg = sum / numbers.length;\n\n// çµæœã‚’ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã§è¿”ã™\nmsg.payload = {\n    sum: sum,\n    avg: avg,\n    count: numbers.length\n};\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 290,
        "y": 100,
        "wires": [
            ["ex2_debug"]
        ]
    },
    {
        "id": "ex2_debug",
        "type": "debug",
        "z": "exercise2",
        "name": "",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "payload",
        "targetType": "msg",
        "x": 450,
        "y": 100,
        "wires": []
    }
]
                </div>
                <p><strong>âœ… å‹•ä½œç¢ºèª:</strong></p>
                <ul>
                    <li>Injectã‚’ã‚¯ãƒªãƒƒã‚¯</li>
                    <li>çµæœ: <code>{sum: 150, avg: 30, count: 5}</code> ãŒè¡¨ç¤ºã•ã‚Œã‚‹</li>
                </ul>
                
                <p><strong>ğŸ“ è§£ç­”ã‚³ãƒ¼ãƒ‰:</strong></p>
                <div class="code-block">
// é…åˆ—ã‚’å–å¾—
let numbers = msg.payload;

// åˆè¨ˆã‚’è¨ˆç®—
let sum = 0;
for (let i = 0; i < numbers.length; i++) {
    sum = sum + numbers[i];
}

// å¹³å‡ã‚’è¨ˆç®—
let avg = sum / numbers.length;

// çµæœã‚’ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã§è¿”ã™
msg.payload = {
    sum: sum,
    avg: avg,
    count: numbers.length
};

return msg;
                </div>
            </details>
        </div>
        
        <div class="exercise">
            <h3>ç·´ç¿’å•é¡Œ 3: ã‚¢ã‚¯ã‚»ã‚¹ã‚«ã‚¦ãƒ³ã‚¿ãƒ¼ <span class="difficulty difficulty-medium">ä¸­ç´š</span></h3>
            
            <h4>ğŸ¯ ç›®æ¨™</h4>
            <p>flowå¤‰æ•°ã‚’ä½¿ã£ã¦ã€ã‚¢ã‚¯ã‚»ã‚¹å›æ•°ã‚’ã‚«ã‚¦ãƒ³ãƒˆã™ã‚‹</p>
            
            <h4>ğŸ“‹ è¦ä»¶</h4>
            <ol>
                <li>ã€Œã‚¢ã‚¯ã‚»ã‚¹ã€ãƒœã‚¿ãƒ³: ã‚¯ãƒªãƒƒã‚¯ã™ã‚‹ãŸã³ã«ã‚«ã‚¦ãƒ³ãƒˆãŒ1å¢—ãˆã‚‹</li>
                <li>ã€Œãƒªã‚»ãƒƒãƒˆã€ãƒœã‚¿ãƒ³: ã‚«ã‚¦ãƒ³ãƒˆã‚’0ã«æˆ»ã™</li>
                <li>ã€Œç¢ºèªã€ãƒœã‚¿ãƒ³: ç¾åœ¨ã®ã‚«ã‚¦ãƒ³ãƒˆã‚’è¡¨ç¤º</li>
                <li>flowå¤‰æ•° "accessCount" ã‚’ä½¿ç”¨</li>
            </ol>
            
            <h4>ğŸ’­ ãƒ’ãƒ³ãƒˆ</h4>
            
            <p><strong>ğŸ¯ Functionãƒãƒ¼ãƒ‰ã®ã‚³ãƒ¼ãƒ‰(è‡ªåˆ†ã§æ›¸ã„ã¦ã¿ã‚ˆã†):</strong></p>
            <ul>
                <li>flow.get() ã§å€¤ã‚’å–å¾—</li>
                <li>flow.set() ã§å€¤ã‚’ä¿å­˜</li>
                <li>åˆå›ã¯å€¤ãŒãªã„ã®ã§ã€|| 0 ã§ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ã‚’è¨­å®š</li>
            </ul>
            
            <p><strong>ğŸ”¢ Injectãƒãƒ¼ãƒ‰ã®è¨­å®š:</strong></p>
            <ul>
                <li>3ã¤ã®Injectãƒãƒ¼ãƒ‰ã‚’ä½œæˆ</li>
                <li>åå‰: ã€Œã‚¢ã‚¯ã‚»ã‚¹ã€ã€Œãƒªã‚»ãƒƒãƒˆã€ã€Œç¢ºèªã€</li>
                <li>Payloadã¯ä½•ã§ã‚‚OK(ä½¿ç”¨ã—ãªã„)</li>
            </ul>
            
            <details>
                <summary>ğŸ“¦ è§£ç­”ãƒ•ãƒ­ãƒ¼ (ã‚¯ãƒªãƒƒã‚¯ã—ã¦è¡¨ç¤º)</summary>
                <div class="flow-json">
[
    {
        "id": "ex3_inject_access",
        "type": "inject",
        "z": "exercise3",
        "name": "ã‚¢ã‚¯ã‚»ã‚¹",
        "props": [
            {
                "p": "payload"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 120,
        "y": 100,
        "wires": [
            ["ex3_function_access"]
        ]
    },
    {
        "id": "ex3_inject_reset",
        "type": "inject",
        "z": "exercise3",
        "name": "ãƒªã‚»ãƒƒãƒˆ",
        "props": [
            {
                "p": "payload"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 120,
        "y": 140,
        "wires": [
            ["ex3_function_reset"]
        ]
    },
    {
        "id": "ex3_inject_check",
        "type": "inject",
        "z": "exercise3",
        "name": "ç¢ºèª",
        "props": [
            {
                "p": "payload"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 110,
        "y": 180,
        "wires": [
            ["ex3_function_check"]
        ]
    },
    {
        "id": "ex3_function_access",
        "type": "function",
        "z": "exercise3",
        "name": "ã‚«ã‚¦ãƒ³ãƒˆ+1",
        "func": "// ç¾åœ¨ã®ã‚«ã‚¦ãƒ³ãƒˆã‚’å–å¾—(åˆå›ã¯0)\nlet count = flow.get('accessCount') || 0;\n\n// ã‚«ã‚¦ãƒ³ãƒˆã‚’1å¢—ã‚„ã™\ncount = count + 1;\n\n// ä¿å­˜\nflow.set('accessCount', count);\n\n// çµæœã‚’è¿”ã™\nmsg.payload = \"ã‚¢ã‚¯ã‚»ã‚¹å›æ•°: \" + count;\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 290,
        "y": 100,
        "wires": [
            ["ex3_debug"]
        ]
    },
    {
        "id": "ex3_function_reset",
        "type": "function",
        "z": "exercise3",
        "name": "ã‚«ã‚¦ãƒ³ãƒˆãƒªã‚»ãƒƒãƒˆ",
        "func": "// ã‚«ã‚¦ãƒ³ãƒˆã‚’0ã«ãƒªã‚»ãƒƒãƒˆ\nflow.set('accessCount', 0);\n\n// çµæœã‚’è¿”ã™\nmsg.payload = \"ã‚«ã‚¦ãƒ³ãƒˆã‚’ãƒªã‚»ãƒƒãƒˆã—ã¾ã—ãŸ\";\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 300,
        "y": 140,
        "wires": [
            ["ex3_debug"]
        ]
    },
    {
        "id": "ex3_function_check",
        "type": "function",
        "z": "exercise3",
        "name": "ã‚«ã‚¦ãƒ³ãƒˆç¢ºèª",
        "func": "// ç¾åœ¨ã®ã‚«ã‚¦ãƒ³ãƒˆã‚’å–å¾—\nlet count = flow.get('accessCount') || 0;\n\n// çµæœã‚’è¿”ã™\nmsg.payload = \"ç¾åœ¨ã®ã‚¢ã‚¯ã‚»ã‚¹å›æ•°: \" + count;\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 290,
        "y": 180,
        "wires": [
            ["ex3_debug"]
        ]
    },
    {
        "id": "ex3_debug",
        "type": "debug",
        "z": "exercise3",
        "name": "",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "payload",
        "targetType": "msg",
        "x": 490,
        "y": 140,
        "wires": []
    }
]
                </div>
                <p><strong>âœ… å‹•ä½œç¢ºèª:</strong></p>
                <ul>
                    <li>ã€Œã‚¢ã‚¯ã‚»ã‚¹ã€ã‚’ä½•åº¦ã‹ã‚¯ãƒªãƒƒã‚¯ â†’ ã€Œã‚¢ã‚¯ã‚»ã‚¹å›æ•°: 1ã€ã€Œã‚¢ã‚¯ã‚»ã‚¹å›æ•°: 2ã€...</li>
                    <li>ã€Œç¢ºèªã€ã‚’ã‚¯ãƒªãƒƒã‚¯ â†’ ã€Œç¾åœ¨ã®ã‚¢ã‚¯ã‚»ã‚¹å›æ•°: Xã€</li>
                    <li>ã€Œãƒªã‚»ãƒƒãƒˆã€ã‚’ã‚¯ãƒªãƒƒã‚¯ â†’ ã€Œã‚«ã‚¦ãƒ³ãƒˆã‚’ãƒªã‚»ãƒƒãƒˆã—ã¾ã—ãŸã€</li>
                    <li>ã€Œç¢ºèªã€ã‚’ã‚¯ãƒªãƒƒã‚¯ â†’ ã€Œç¾åœ¨ã®ã‚¢ã‚¯ã‚»ã‚¹å›æ•°: 0ã€</li>
                </ul>
                
                <p><strong>ğŸ“ è§£ç­”ã‚³ãƒ¼ãƒ‰(ã‚¢ã‚¯ã‚»ã‚¹):</strong></p>
                <div class="code-block">
// ç¾åœ¨ã®ã‚«ã‚¦ãƒ³ãƒˆã‚’å–å¾—(åˆå›ã¯0)
let count = flow.get('accessCount') || 0;

// ã‚«ã‚¦ãƒ³ãƒˆã‚’1å¢—ã‚„ã™
count = count + 1;

// ä¿å­˜
flow.set('accessCount', count);

// çµæœã‚’è¿”ã™
msg.payload = "ã‚¢ã‚¯ã‚»ã‚¹å›æ•°: " + count;
return msg;
                </div>
            </details>
        </div>
        
        <div class="exercise">
            <h3>ç·´ç¿’å•é¡Œ 4: ã‚»ãƒ³ã‚µãƒ¼ãƒ‡ãƒ¼ã‚¿ã®ç•°å¸¸æ¤œçŸ¥ <span class="difficulty difficulty-hard">ä¸Šç´š</span></h3>
            
            <h4>ğŸ¯ ç›®æ¨™</h4>
            <p>æ¸©åº¦ã‚»ãƒ³ã‚µãƒ¼ã®ãƒ‡ãƒ¼ã‚¿ã‚’ç›£è¦–ã—ã€ç•°å¸¸å€¤(5â„ƒä»¥ä¸‹ã¾ãŸã¯40â„ƒä»¥ä¸Š)ã‚’æ¤œå‡ºã—ã¦è­¦å‘Šã‚’å‡ºã™</p>
            
            <h4>ğŸ“‹ ã‚·ãƒŠãƒªã‚ª</h4>
            <p>æ¸©åº¦ã‚»ãƒ³ã‚µãƒ¼ã‹ã‚‰å®šæœŸçš„ã«ãƒ‡ãƒ¼ã‚¿ãŒé€ã‚‰ã‚Œã¦ãã¾ã™ã€‚æ­£å¸¸ç¯„å›²(5-40â„ƒ)ã‚’å¤–ã‚ŒãŸå ´åˆã€è­¦å‘Šãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’å‡ºåŠ›ã—ã€ç•°å¸¸å›æ•°ã‚’ã‚«ã‚¦ãƒ³ãƒˆã—ã¾ã™ã€‚</p>
            
            <h4>ğŸ“‹ è¦ä»¶</h4>
            <ol>
                <li>Injectãƒãƒ¼ãƒ‰ã§ãƒ©ãƒ³ãƒ€ãƒ ãªæ¸©åº¦ãƒ‡ãƒ¼ã‚¿ã‚’é€ä¿¡(0-50â„ƒ)</li>
                <li>Functionãƒãƒ¼ãƒ‰ã§ä»¥ä¸‹ã®å‡¦ç†:
                    <ul>
                        <li>æ¸©åº¦ãŒæ­£å¸¸ç¯„å›²å†…ã‹ãƒã‚§ãƒƒã‚¯</li>
                        <li>ç•°å¸¸ã®å ´åˆã€è­¦å‘Šãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’ä½œæˆ</li>
                        <li>ç•°å¸¸å›æ•°ã‚’flowå¤‰æ•°ã§ã‚«ã‚¦ãƒ³ãƒˆ</li>
                        <li>æ­£å¸¸å€¤ã¨ç•°å¸¸å€¤ã‚’åˆ¥ã®å‡ºåŠ›ãƒãƒ¼ãƒˆã‹ã‚‰é€ä¿¡(outputs: 2)</li>
                    </ul>
                </li>
                <li>2ã¤ã®Debugãƒãƒ¼ãƒ‰ã§æ­£å¸¸å€¤ã¨ç•°å¸¸å€¤ã‚’åˆ¥ã€…ã«è¡¨ç¤º</li>
            </ol>
            
            <h4>ğŸ’­ ãƒ’ãƒ³ãƒˆ</h4>
            
            <p><strong>ğŸ¯ Functionãƒãƒ¼ãƒ‰ã®ã‚³ãƒ¼ãƒ‰(è‡ªåˆ†ã§æ›¸ã„ã¦ã¿ã‚ˆã†):</strong></p>
            <ul>
                <li>è¤‡æ•°ã®å‡ºåŠ›ãƒãƒ¼ãƒˆã‚’ä½¿ã†ã«ã¯ã€é…åˆ—ã§è¿”ã™</li>
                <li><code>return [æ­£å¸¸ç”¨msg, ç•°å¸¸ç”¨msg];</code></li>
                <li>é€ä¿¡ã—ãªã„æ–¹ã¯<code>null</code>ã«ã™ã‚‹</li>
            </ul>
            
            <p><strong>ğŸ”¢ Injectãƒãƒ¼ãƒ‰ã®è¨­å®š(ãã®ã¾ã¾è¨­å®šã—ã¦ãã ã•ã„):</strong></p>
            <div class="important">
                <ul>
                    <li>åå‰: <code>æ¸©åº¦ã‚»ãƒ³ã‚µãƒ¼</code></li>
                    <li>Repeat: interval - 2 seconds</li>
                    <li>Payload: JSONataå¼</li>
                    <li>å€¤: <code>$round($random() * 50)</code></li>
                    <li>â€» ã“ã‚Œã¯0-50â„ƒã®ç¯„å›²ã§ãƒ©ãƒ³ãƒ€ãƒ ãªæ¸©åº¦ã‚’ç”Ÿæˆã—ã¾ã™</li>
                </ul>
            </div>
            
            <p><strong>âš™ï¸ Functionãƒãƒ¼ãƒ‰ã®è¨­å®š:</strong></p>
            <ul>
                <li>Outputs: <code>2</code> ã«è¨­å®š(2ã¤ã®å‡ºåŠ›ãƒãƒ¼ãƒˆ)</li>
            </ul>
            
            <details>
                <summary>ğŸ“¦ è§£ç­”ãƒ•ãƒ­ãƒ¼ (ã‚¯ãƒªãƒƒã‚¯ã—ã¦è¡¨ç¤º)</summary>
                <div class="flow-json">
[
    {
        "id": "ex4_inject",
        "type": "inject",
        "z": "exercise4",
        "name": "æ¸©åº¦ã‚»ãƒ³ã‚µãƒ¼",
        "props": [
            {
                "p": "payload"
            }
        ],
        "repeat": "2",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "$round($random() * 50)",
        "payloadType": "jsonata",
        "x": 140,
        "y": 100,
        "wires": [
            ["ex4_function"]
        ]
    },
    {
        "id": "ex4_function",
        "type": "function",
        "z": "exercise4",
        "name": "ç•°å¸¸æ¤œçŸ¥",
        "func": "// æ¸©åº¦ã‚’å–å¾—\nlet temp = msg.payload;\n\n// æ­£å¸¸ç¯„å›²ã®å®šç¾©\nconst MIN_TEMP = 5;\nconst MAX_TEMP = 40;\n\n// ç•°å¸¸å›æ•°ã‚’å–å¾—\nlet errorCount = flow.get('errorCount') || 0;\n\n// æ¸©åº¦ã‚’ãƒã‚§ãƒƒã‚¯\nif (temp < MIN_TEMP || temp > MAX_TEMP) {\n    // ç•°å¸¸ã®å ´åˆ\n    errorCount = errorCount + 1;\n    flow.set('errorCount', errorCount);\n    \n    // ç•°å¸¸ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’ä½œæˆ\n    let alertMsg = {\n        payload: {\n            temperature: temp,\n            status: \"ç•°å¸¸\",\n            reason: temp < MIN_TEMP ? \"ä½æ¸©\" : \"é«˜æ¸©\",\n            errorCount: errorCount,\n            timestamp: new Date().toLocaleString('ja-JP')\n        }\n    };\n    \n    // å‡ºåŠ›1: null (æ­£å¸¸ç”¨ãªã®ã§é€ä¿¡ã—ãªã„)\n    // å‡ºåŠ›2: ç•°å¸¸ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸\n    return [null, alertMsg];\n    \n} else {\n    // æ­£å¸¸ã®å ´åˆ\n    let normalMsg = {\n        payload: {\n            temperature: temp,\n            status: \"æ­£å¸¸\",\n            timestamp: new Date().toLocaleString('ja-JP')\n        }\n    };\n    \n    // å‡ºåŠ›1: æ­£å¸¸ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸\n    // å‡ºåŠ›2: null (ç•°å¸¸ç”¨ãªã®ã§é€ä¿¡ã—ãªã„)\n    return [normalMsg, null];\n}",
        "outputs": 2,
        "noerr": 0,
        "x": 320,
        "y": 100,
        "wires": [
            ["ex4_debug_normal"],
            ["ex4_debug_alert"]
        ]
    },
    {
        "id": "ex4_debug_normal",
        "type": "debug",
        "z": "exercise4",
        "name": "âœ… æ­£å¸¸å€¤",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "payload",
        "targetType": "msg",
        "x": 500,
        "y": 80,
        "wires": []
    },
    {
        "id": "ex4_debug_alert",
        "type": "debug",
        "z": "exercise4",
        "name": "âš ï¸ ç•°å¸¸å€¤",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "payload",
        "targetType": "msg",
        "x": 500,
        "y": 120,
        "wires": []
    }
]
                </div>
                <p><strong>âœ… å‹•ä½œç¢ºèª:</strong></p>
                <ul>
                    <li>ãƒ•ãƒ­ãƒ¼ã‚’ãƒ‡ãƒ—ãƒ­ã‚¤ã™ã‚‹ã¨ã€2ç§’ã”ã¨ã«è‡ªå‹•å®Ÿè¡Œã•ã‚Œã‚‹</li>
                    <li>æ­£å¸¸å€¤(5-40â„ƒ): ã€Œâœ… æ­£å¸¸å€¤ã€ã«è¡¨ç¤º</li>
                    <li>ç•°å¸¸å€¤(5â„ƒæœªæº€ã¾ãŸã¯40â„ƒè¶…): ã€Œâš ï¸ ç•°å¸¸å€¤ã€ã«è¡¨ç¤º</li>
                    <li>ç•°å¸¸å€¤ã«ã¯ç´¯ç©ã‚¨ãƒ©ãƒ¼å›æ•°ã‚‚è¡¨ç¤ºã•ã‚Œã‚‹</li>
                </ul>
                
                <p><strong>ğŸ“ è§£ç­”ã‚³ãƒ¼ãƒ‰:</strong></p>
                <div class="code-block">
// æ¸©åº¦ã‚’å–å¾—
let temp = msg.payload;

// æ­£å¸¸ç¯„å›²ã®å®šç¾©
const MIN_TEMP = 5;
const MAX_TEMP = 40;

// ç•°å¸¸å›æ•°ã‚’å–å¾—
let errorCount = flow.get('errorCount') || 0;

// æ¸©åº¦ã‚’ãƒã‚§ãƒƒã‚¯
if (temp < MIN_TEMP || temp > MAX_TEMP) {
    // ç•°å¸¸ã®å ´åˆ
    errorCount = errorCount + 1;
    flow.set('errorCount', errorCount);
    
    // ç•°å¸¸ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’ä½œæˆ
    let alertMsg = {
        payload: {
            temperature: temp,
            status: "ç•°å¸¸",
            reason: temp < MIN_TEMP ? "ä½æ¸©" : "é«˜æ¸©",
            errorCount: errorCount,
            timestamp: new Date().toLocaleString('ja-JP')
        }
    };
    
    // å‡ºåŠ›1: null (æ­£å¸¸ç”¨ãªã®ã§é€ä¿¡ã—ãªã„)
    // å‡ºåŠ›2: ç•°å¸¸ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸
    return [null, alertMsg];
    
} else {
    // æ­£å¸¸ã®å ´åˆ
    let normalMsg = {
        payload: {
            temperature: temp,
            status: "æ­£å¸¸",
            timestamp: new Date().toLocaleString('ja-JP')
        }
    };
    
    // å‡ºåŠ›1: æ­£å¸¸ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸
    // å‡ºåŠ›2: null (ç•°å¸¸ç”¨ãªã®ã§é€ä¿¡ã—ãªã„)
    return [normalMsg, null];
}
                </div>
            </details>
        </div>
        
        <h2>ğŸ“ 6. ã¾ã¨ã‚</h2>
        
        <div class="important">
            <h3>Functionãƒãƒ¼ãƒ‰ã®é‡è¦ãƒã‚¤ãƒ³ãƒˆ</h3>
            <ul>
                <li>âœ… <strong>JavaScriptãŒä½¿ãˆã‚‹</strong>: è¤‡é›‘ãªå‡¦ç†ã‚’è‡ªç”±ã«è¨˜è¿°</li>
                <li>âœ… <strong>msgã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ</strong>: msg.payloadã§ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—ãƒ»è¨­å®š</li>
                <li>âœ… <strong>return</strong>: ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’è¿”ã—ã¦æ¬¡ã®ãƒãƒ¼ãƒ‰ã«é€ä¿¡</li>
                <li>âœ… <strong>ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆå¤‰æ•°</strong>: flow/global/contextã§ãƒ‡ãƒ¼ã‚¿ã‚’ä¿å­˜</li>
                <li>âœ… <strong>è¤‡æ•°å‡ºåŠ›</strong>: é…åˆ—ã§è¿”ã™ã¨è¤‡æ•°ã®å‡ºåŠ›ãƒãƒ¼ãƒˆã‹ã‚‰é€ä¿¡å¯èƒ½</li>
            </ul>
        </div>
        
        <div class="warning">
            <h3>âš ï¸ æ³¨æ„äº‹é …</h3>
            <ul>
                <li><strong>ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°</strong>: try-catchæ–‡ã§ã‚¨ãƒ©ãƒ¼ã‚’é©åˆ‡ã«å‡¦ç†ã—ã‚ˆã†</li>
                <li><strong>ç„¡é™ãƒ«ãƒ¼ãƒ—</strong>: whileæ–‡ãªã©ã§ç„¡é™ãƒ«ãƒ¼ãƒ—ã‚’ä½œã‚‰ãªã„ã‚ˆã†æ³¨æ„</li>
                <li><strong>ãƒ¡ãƒ¢ãƒªãƒªãƒ¼ã‚¯</strong>: å¤§é‡ã®ãƒ‡ãƒ¼ã‚¿ã‚’contextå¤‰æ•°ã«ä¿å­˜ã—ã™ããªã„</li>
                <li><strong>éåŒæœŸå‡¦ç†</strong>: setTimeoutãªã©ã‚’ä½¿ã†å ´åˆã¯ã€node.send()ã‚’ä½¿ã†</li>
            </ul>
        </div>
        
        <div class="tip">
            <h3>ğŸ“š æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—</h3>
            <p>Functionãƒãƒ¼ãƒ‰ã‚’ãƒã‚¹ã‚¿ãƒ¼ã—ãŸã‚‰ã€ä»¥ä¸‹ã‚‚å­¦ã‚“ã§ã¿ã¾ã—ã‚‡ã†:</p>
            <ul>
                <li><strong>JSONata</strong>: ã‚ˆã‚Šç°¡æ½”ã«ãƒ‡ãƒ¼ã‚¿å¤‰æ›ã§ãã‚‹</li>
                <li><strong>Promiseã¨éåŒæœŸå‡¦ç†</strong>: async/awaitã®ä½¿ã„æ–¹</li>
                <li><strong>å¤–éƒ¨ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«</strong>: npmãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã®æ´»ç”¨</li>
                <li><strong>ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°</strong>: try-catchã¨Catchãƒãƒ¼ãƒ‰ã®é€£æº</li>
            </ul>
        </div>
        
        <h2>ğŸ”§ 7. ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°</h2>
        
        <h3>ã‚ˆãã‚ã‚‹å•é¡Œã¨è§£æ±ºæ–¹æ³•</h3>
        
        <table>
            <tr>
                <th>å•é¡Œ</th>
                <th>åŸå› </th>
                <th>è§£æ±ºæ–¹æ³•</th>
            </tr>
            <tr>
                <td>ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãŒé€ä¿¡ã•ã‚Œãªã„</td>
                <td>returnã‚’å¿˜ã‚Œã¦ã„ã‚‹</td>
                <td>é–¢æ•°ã®æœ€å¾Œã«<code>return msg;</code>ã‚’è¿½åŠ </td>
            </tr>
            <tr>
                <td>ã‚¨ãƒ©ãƒ¼ãŒè¡¨ç¤ºã•ã‚Œã‚‹</td>
                <td>æ§‹æ–‡ã‚¨ãƒ©ãƒ¼</td>
                <td>ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’ç¢ºèªã—ã€ã‚³ãƒ¼ãƒ‰ã‚’ä¿®æ­£</td>
            </tr>
            <tr>
                <td>å¤‰æ•°ãŒä¿å­˜ã•ã‚Œãªã„</td>
                <td>flow.set()ã‚’å¿˜ã‚Œã¦ã„ã‚‹</td>
                <td>å€¤ã‚’å¤‰æ›´ã—ãŸã‚‰å¿…ãšflow.set()ã§ä¿å­˜</td>
            </tr>
            <tr>
                <td>è¤‡æ•°å‡ºåŠ›ãŒæ©Ÿèƒ½ã—ãªã„</td>
                <td>Outputsã®è¨­å®šãŒ1ã®ã¾ã¾</td>
                <td>Functionãƒãƒ¼ãƒ‰ã®è¨­å®šã§Outputsã‚’2ä»¥ä¸Šã«</td>
            </tr>
        </table>
        
        <h2>ğŸ“– 8. ã‚ˆãä½¿ã†JavaScripté–¢æ•°</h2>
        
        <h3>é…åˆ—æ“ä½œ</h3>
        
        <table>
            <tr>
                <th>é–¢æ•°</th>
                <th>èª¬æ˜</th>
                <th>ä¾‹</th>
            </tr>
            <tr>
                <td>push()</td>
                <td>æœ«å°¾ã«è¿½åŠ </td>
                <td><code>arr.push(item)</code></td>
            </tr>
            <tr>
                <td>pop()</td>
                <td>æœ«å°¾ã‚’å‰Šé™¤</td>
                <td><code>arr.pop()</code></td>
            </tr>
            <tr>
                <td>forEach()</td>
                <td>å„è¦ç´ ã‚’å‡¦ç†</td>
                <td><code>arr.forEach(item => {...})</code></td>
            </tr>
            <tr>
                <td>map()</td>
                <td>å„è¦ç´ ã‚’å¤‰æ›</td>
                <td><code>arr.map(x => x * 2)</code></td>
            </tr>
            <tr>
                <td>filter()</td>
                <td>æ¡ä»¶ã«åˆã†è¦ç´ ã‚’æŠ½å‡º</td>
                <td><code>arr.filter(x => x > 10)</code></td>
            </tr>
        </table>
        
        <h3>æ–‡å­—åˆ—æ“ä½œ</h3>
        
        <table>
            <tr>
                <th>é–¢æ•°</th>
                <th>èª¬æ˜</th>
                <th>ä¾‹</th>
            </tr>
            <tr>
                <td>split()</td>
                <td>æ–‡å­—åˆ—ã‚’åˆ†å‰²</td>
                <td><code>"a,b,c".split(",")</code> â†’ ["a","b","c"]</td>
            </tr>
            <tr>
                <td>join()</td>
                <td>é…åˆ—ã‚’çµåˆ</td>
                <td><code>["a","b"].join(",")</code> â†’ "a,b"</td>
            </tr>
            <tr>
                <td>toUpperCase()</td>
                <td>å¤§æ–‡å­—ã«å¤‰æ›</td>
                <td><code>"hello".toUpperCase()</code> â†’ "HELLO"</td>
            </tr>
            <tr>
                <td>substring()</td>
                <td>éƒ¨åˆ†æ–‡å­—åˆ—ã‚’å–å¾—</td>
                <td><code>"hello".substring(0, 3)</code> â†’ "hel"</td>
            </tr>
        </table>
        
        <h2>ğŸ”— 9. è¿½åŠ ãƒªã‚½ãƒ¼ã‚¹</h2>
        
        <ul>
            <li><a href="https://nodered.org/docs/user-guide/writing-functions" target="_blank">Node-REDå…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ: Functionãƒãƒ¼ãƒ‰</a></li>
            <li><a href="https://developer.mozilla.org/ja/docs/Web/JavaScript" target="_blank">MDN Web Docs: JavaScript</a></li>
            <li><a href="https://cookbook.nodered.org/" target="_blank">Node-RED Cookbook: ãƒ‘ã‚¿ãƒ¼ãƒ³é›†</a></li>
        </ul>
        
        <hr>
        
        <p style="text-align: center; color: #999; margin-top: 40px;">
            <small>ã“ã®ã‚¬ã‚¤ãƒ‰ãŒå½¹ã«ç«‹ã¡ã¾ã—ãŸã‚‰ã€å®Ÿéš›ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã§ç·´ç¿’ã—ã¦ã¿ã¦ãã ã•ã„!<br>
            Functionãƒãƒ¼ãƒ‰ã¯Node-REDã®æœ€ã‚‚å¼·åŠ›ã§æŸ”è»Ÿãªãƒãƒ¼ãƒ‰ã§ã™ã€‚</small>
        </p>
    </div>
    
    <script>
        // ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿æ™‚ã«ã‚³ãƒ”ãƒ¼ãƒœã‚¿ãƒ³ã‚’è¿½åŠ 
        document.addEventListener('DOMContentLoaded', function() {
            // ã™ã¹ã¦ã®.code-blockã¨.flow-jsonã«ã‚³ãƒ”ãƒ¼ãƒœã‚¿ãƒ³ã‚’è¿½åŠ 
            const codeBlocks = document.querySelectorAll('.code-block, .flow-json');
            
            codeBlocks.forEach(function(block) {
                // ã‚³ãƒ”ãƒ¼ãƒœã‚¿ãƒ³ã‚’ä½œæˆ
                const button = document.createElement('button');
                button.className = 'copy-button';
                button.textContent = 'ã‚³ãƒ”ãƒ¼';
                
                // ã‚¯ãƒªãƒƒã‚¯ã‚¤ãƒ™ãƒ³ãƒˆã‚’è¿½åŠ 
                button.addEventListener('click', function() {
                    // ã‚³ãƒ¼ãƒ‰ãƒ–ãƒ­ãƒƒã‚¯ã®ãƒ†ã‚­ã‚¹ãƒˆã‚’å–å¾—
                    const code = block.textContent.replace('ã‚³ãƒ”ãƒ¼', '').trim();
                    
                    // ã‚¯ãƒªãƒƒãƒ—ãƒœãƒ¼ãƒ‰ã«ã‚³ãƒ”ãƒ¼
                    navigator.clipboard.writeText(code).then(function() {
                        // æˆåŠŸæ™‚ã®è¦–è¦šçš„ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯
                        button.textContent = 'ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸ!';
                        button.classList.add('copied');
                        
                        // 2ç§’å¾Œã«å…ƒã«æˆ»ã™
                        setTimeout(function() {
                            button.textContent = 'ã‚³ãƒ”ãƒ¼';
                            button.classList.remove('copied');
                        }, 2000);
                    }).catch(function(err) {
                        console.error('ã‚³ãƒ”ãƒ¼ã«å¤±æ•—ã—ã¾ã—ãŸ:', err);
                        button.textContent = 'ã‚¨ãƒ©ãƒ¼';
                        setTimeout(function() {
                            button.textContent = 'ã‚³ãƒ”ãƒ¼';
                        }, 2000);
                    });
                });
                
                // ãƒœã‚¿ãƒ³ã‚’ã‚³ãƒ¼ãƒ‰ãƒ–ãƒ­ãƒƒã‚¯ã«è¿½åŠ 
                block.style.position = 'relative';
                block.appendChild(button);
            });
        });
    </script>
</body>
</html>